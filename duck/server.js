var LZString=function() {function o(o, r)
	{
		if (!t[o]) {
			t[o]={};
			for (var n=0;n<o.length;n++)
				t[o][o.charAt(n)]=n}return t[o][r]
	}var r=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",t={},i={compressToBase64:function(o) {
			if (null==o)
				return"";var r=i._compress(o,6,function(o) {return n.charAt(o)});switch(r.length%4){default:
			case 0:return r;
			case 1:return r+"===";
			case 2:return r+"==";
			case 3:return r+"="}},decompressFromBase64:function(r) {return null==r?"":""==r?null:i._decompress(r.length,32,function(e) {return o(n,r.charAt(e))})},compressToUTF16:function(o) {return null==o?"":i._compress(o,15,function(o) {return r(o+32)})+" "},decompressFromUTF16:function(o) {return null==o?"":""==o?null:i._decompress(o.length,16384,function(r) {return o.charCodeAt(r)-32})},compressToUint8Array:function(o) {
			for (var r=i.compress(o),n=new Uint8Array(2*r.length),e=0,t=r.length;t>e;e++) {
				var s=r.charCodeAt(e);n[2*e]=s>>>8,n[2*e+1]=s%256}return n},decompressFromUint8Array:function(o) {
			if (null===o||void 0===o)
				return i.decompress(o);
			for (var n=new Array(o.length/2),e=0,t=n.length;t>e;e++)
				n[e]=256*o[2*e]+o[2*e+1];var s=[];return n.forEach(function(o) {s.push(r(o))}),i.decompress(s.join(""))},compressToEncodedURIComponent:function(o) {return null==o?"":i._compress(o,6,function(o) {return e.charAt(o)})},decompressFromEncodedURIComponent:function(r) {return null==r?"":""==r?null:(r=r.replace(/ /g,"+"),i._decompress(r.length,32,function(n){return o(e,r.charAt(n))}))},compress:function(o){return i._compress(o,16,function(o){return r(o)})},_compress:function(o,r,n){if(null==o)return"";var e,t,i,s={},p={},u="",c="",a="",l=2,f=3,h=2,d=[],m=0,v=0;for(i=0;i<o.length;i+=1)if(u=o.charAt(i),Object.prototype.hasOwnProperty.call(s,u)||(s[u]=f++,p[u]=!0),c=a+u,Object.prototype.hasOwnProperty.call(s,c))a=c;else{if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;h>e;e++)m<<=1,v==r-1?(v=0,d.push(n(m)),m=0):v++;for(t=a.charCodeAt(0),e=0;8>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}else{for(t=1,e=0;h>e;e++)m=m<<1|t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t=0;for(t=a.charCodeAt(0),e=0;16>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete p[a]}else for(t=s[a],e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;l--,0==l&&(l=Math.pow(2,h),h++),s[c]=f++,a=String(u)}if(""!==a){if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;h>e;e++)m<<=1,v==r-1?(v=0,d.push(n(m)),m=0):v++;for(t=a.charCodeAt(0),e=0;8>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}else{for(t=1,e=0;h>e;e++)m=m<<1|t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t=0;for(t=a.charCodeAt(0),e=0;16>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete p[a]}else for(t=s[a],e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;l--,0==l&&(l=Math.pow(2,h),h++)}for(t=2,e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;for(;;){if(m<<=1,v==r-1){d.push(n(m));break}v++}return d.join("")},decompress:function(o){return null==o?"":""==o?null:i._decompress(o.length,32768,function(r){return o.charCodeAt(r)})},_decompress:function(o,n,e){var t,i,s,p,u,c,a,l,f=[],h=4,d=4,m=3,v="",w=[],A={val:e(0),position:n,index:1};for(i=0;3>i;i+=1)f[i]=i;for(p=0,c=Math.pow(2,2),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;switch(t=p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;l=r(p);break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;l=r(p);break;case 2:return""}for(f[3]=l,s=l,w.push(l);;){if(A.index>o)return"";for(p=0,c=Math.pow(2,m),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;switch(l=p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;f[d++]=r(p),l=d-1,h--;break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;f[d++]=r(p),l=d-1,h--;break;case 2:return w.join("")}if(0==h&&(h=Math.pow(2,m),m++),f[l])v=f[l];else{if(l!==d)return null;v=s+s.charAt(0)}w.push(v),f[d++]=s+v.charAt(0),h--,s=v,0==h&&(h=Math.pow(2,m),m++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module&&(module.exports=LZString);!function(n){"use strict";function t(n,t){var r=(65535&n)+(65535&t);return(n>>16)+(t>>16)+(r>>16)<<16|65535&r}function r(n,t){return n<<t|n>>>32-t}function e(n,e,o,u,c,f){return t(r(t(t(e,n),t(u,f)),c),o)}function o(n,t,r,o,u,c,f){return e(t&r|~t&o,n,t,u,c,f)}function u(n,t,r,o,u,c,f){return e(t&o|r&~o,n,t,u,c,f)}function c(n,t,r,o,u,c,f){return e(t^r^o,n,t,u,c,f)}function f(n,t,r,o,u,c,f){return e(r^(t|~o),n,t,u,c,f)}function i(n,r){n[r>>5]|=128<<r%32,n[14+(r+64>>>9<<4)]=r;var e,i,a,d,h,l=1732584193,g=-271733879,v=-1732584194,m=271733878;for(e=0;e<n.length;e+=16)i=l,a=g,d=v,h=m,g=f(g=f(g=f(g=f(g=c(g=c(g=c(g=c(g=u(g=u(g=u(g=u(g=o(g=o(g=o(g=o(g,v=o(v,m=o(m,l=o(l,g,v,m,n[e],7,-680876936),g,v,n[e+1],12,-389564586),l,g,n[e+2],17,606105819),m,l,n[e+3],22,-1044525330),v=o(v,m=o(m,l=o(l,g,v,m,n[e+4],7,-176418897),g,v,n[e+5],12,1200080426),l,g,n[e+6],17,-1473231341),m,l,n[e+7],22,-45705983),v=o(v,m=o(m,l=o(l,g,v,m,n[e+8],7,1770035416),g,v,n[e+9],12,-1958414417),l,g,n[e+10],17,-42063),m,l,n[e+11],22,-1990404162),v=o(v,m=o(m,l=o(l,g,v,m,n[e+12],7,1804603682),g,v,n[e+13],12,-40341101),l,g,n[e+14],17,-1502002290),m,l,n[e+15],22,1236535329),v=u(v,m=u(m,l=u(l,g,v,m,n[e+1],5,-165796510),g,v,n[e+6],9,-1069501632),l,g,n[e+11],14,643717713),m,l,n[e],20,-373897302),v=u(v,m=u(m,l=u(l,g,v,m,n[e+5],5,-701558691),g,v,n[e+10],9,38016083),l,g,n[e+15],14,-660478335),m,l,n[e+4],20,-405537848),v=u(v,m=u(m,l=u(l,g,v,m,n[e+9],5,568446438),g,v,n[e+14],9,-1019803690),l,g,n[e+3],14,-187363961),m,l,n[e+8],20,1163531501),v=u(v,m=u(m,l=u(l,g,v,m,n[e+13],5,-1444681467),g,v,n[e+2],9,-51403784),l,g,n[e+7],14,1735328473),m,l,n[e+12],20,-1926607734),v=c(v,m=c(m,l=c(l,g,v,m,n[e+5],4,-378558),g,v,n[e+8],11,-2022574463),l,g,n[e+11],16,1839030562),m,l,n[e+14],23,-35309556),v=c(v,m=c(m,l=c(l,g,v,m,n[e+1],4,-1530992060),g,v,n[e+4],11,1272893353),l,g,n[e+7],16,-155497632),m,l,n[e+10],23,-1094730640),v=c(v,m=c(m,l=c(l,g,v,m,n[e+13],4,681279174),g,v,n[e],11,-358537222),l,g,n[e+3],16,-722521979),m,l,n[e+6],23,76029189),v=c(v,m=c(m,l=c(l,g,v,m,n[e+9],4,-640364487),g,v,n[e+12],11,-421815835),l,g,n[e+15],16,530742520),m,l,n[e+2],23,-995338651),v=f(v,m=f(m,l=f(l,g,v,m,n[e],6,-198630844),g,v,n[e+7],10,1126891415),l,g,n[e+14],15,-1416354905),m,l,n[e+5],21,-57434055),v=f(v,m=f(m,l=f(l,g,v,m,n[e+12],6,1700485571),g,v,n[e+3],10,-1894986606),l,g,n[e+10],15,-1051523),m,l,n[e+1],21,-2054922799),v=f(v,m=f(m,l=f(l,g,v,m,n[e+8],6,1873313359),g,v,n[e+15],10,-30611744),l,g,n[e+6],15,-1560198380),m,l,n[e+13],21,1309151649),v=f(v,m=f(m,l=f(l,g,v,m,n[e+4],6,-145523070),g,v,n[e+11],10,-1120210379),l,g,n[e+2],15,718787259),m,l,n[e+9],21,-343485551),l=t(l,i),g=t(g,a),v=t(v,d),m=t(m,h);return[l,g,v,m]}function a(n){var t,r="",e=32*n.length;for(t=0;t<e;t+=8)r+=String.fromCharCode(n[t>>5]>>>t%32&255);return r}function d(n){var t,r=[];for(r[(n.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var e=8*n.length;for(t=0;t<e;t+=8)r[t>>5]|=(255&n.charCodeAt(t/8))<<t%32;return r}function h(n){return a(i(d(n),8*n.length))}function l(n,t){var r,e,o=d(n),u=[],c=[];for(u[15]=c[15]=void 0,o.length>16&&(o=i(o,8*n.length)),r=0;r<16;r+=1)u[r]=909522486^o[r],c[r]=1549556828^o[r];return e=i(u.concat(d(t)),512+8*t.length),a(i(c.concat(e),640))}function g(n){var t,r,e="";for(r=0;r<n.length;r+=1)t=n.charCodeAt(r),e+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return e}function v(n){return unescape(encodeURIComponent(n))}function m(n){return h(v(n))}function p(n){return g(m(n))}function s(n,t){return l(v(n),v(t))}function C(n,t){return g(s(n,t))}function A(n,t,r){return t?r?s(t,n):C(t,n):r?m(n):p(n)}"function"==typeof define&&define.amd?define(function(){return A}):"object"==typeof module&&module.exports?module.exports=A:n.md5=A}(this);!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.io=e():t.io=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t,e){"object"===("undefined"==typeof t?"undefined":o(t))&&(e=t,t=void 0),e=e||{};var n,r=i(t),s=r.source,u=r.id,h=r.path,f=p[u]&&h in p[u].nsps,l=e.forceNew||e["force new connection"]||!1===e.multiplex||f;return l?(c("ignoring socket cache for %s",s),n=a(s,e)):(p[u]||(c("new io instance for %s",s),p[u]=a(s,e)),n=p[u]),r.query&&!e.query&&(e.query=r.query),n.socket(r.path,e)}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=n(1),s=n(7),a=n(12),c=n(3)("socket.io-client");t.exports=e=r;var p=e.managers={};e.protocol=s.protocol,e.connect=r,e.Manager=n(12),e.Socket=n(36)},function(t,e,n){"use strict";function r(t,e){var n=t;e=e||"undefined"!=typeof location&&location,null==t&&(t=e.protocol+"//"+e.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?e.protocol+t:e.host+t),/^(https?|wss?):\/\//.test(t)||(i("protocol-less url %s",t),t="undefined"!=typeof e?e.protocol+"//"+t:"https://"+t),i("parse %s",t),n=o(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";var r=n.host.indexOf(":")!==-1,s=r?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port,n.href=n.protocol+"://"+s+(e&&e.port===n.port?"":":"+n.port),n}var o=n(2),i=n(3)("socket.io-client:url");t.exports=r},function(t,e){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(t){var e=t,o=t.indexOf("["),i=t.indexOf("]");o!=-1&&i!=-1&&(t=t.substring(0,o)+t.substring(o,i).replace(/:/g,";")+t.substring(i,t.length));for(var s=n.exec(t||""),a={},c=14;c--;)a[r[c]]=s[c]||"";return o!=-1&&i!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(t,e,n){(function(r){function o(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function i(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),n){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var o=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(o++,"%c"===t&&(i=o))}),t.splice(i,0,r)}}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(n){}}function c(){var t;try{t=e.storage.debug}catch(n){}return!t&&"undefined"!=typeof r&&"env"in r&&(t=r.env.DEBUG),t}function p(){try{return window.localStorage}catch(t){}}e=t.exports=n(5),e.log=s,e.formatArgs=i,e.save=a,e.load=c,e.useColors=o,e.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:p(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},e.enable(c())}).call(e,n(4))},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(u===setTimeout)return setTimeout(t,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(t,0);try{return u(t,0)}catch(e){try{return u.call(null,t,0)}catch(e){return u.call(this,t,0)}}}function i(t){if(h===clearTimeout)return clearTimeout(t);if((h===r||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function s(){y&&l&&(y=!1,l.length?d=l.concat(d):m=-1,d.length&&a())}function a(){if(!y){var t=o(s);y=!0;for(var e=d.length;e;){for(l=d,d=[];++m<e;)l&&l[m].run();m=-1,e=d.length}l=null,y=!1,i(t)}}function c(t,e){this.fun=t,this.array=e}function p(){}var u,h,f=t.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(t){u=n}try{h="function"==typeof clearTimeout?clearTimeout:r}catch(t){h=r}}();var l,d=[],y=!1,m=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];d.push(new c(t,e)),1!==d.length||y||o(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=p,f.addListener=p,f.once=p,f.off=p,f.removeListener=p,f.removeAllListeners=p,f.emit=p,f.prependListener=p,f.prependOnceListener=p,f.listeners=function(t){return[]},f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(t,e,n){function r(t){var n,r=0;for(n in t)r=(r<<5)-r+t.charCodeAt(n),r|=0;return e.colors[Math.abs(r)%e.colors.length]}function o(t){function n(){if(n.enabled){var t=n,r=+new Date,i=r-(o||r);t.diff=i,t.prev=o,t.curr=r,o=r;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var o=e.formatters[r];if("function"==typeof o){var i=s[c];n=o.call(t,i),s.splice(c,1),c--}return n}),e.formatArgs.call(t,s);var p=n.log||e.log||console.log.bind(console);p.apply(t,s)}}var o;return n.namespace=t,n.enabled=e.enabled(t),n.useColors=e.useColors(),n.color=r(t),n.destroy=i,"function"==typeof e.init&&e.init(n),e.instances.push(n),n}function i(){var t=e.instances.indexOf(this);return t!==-1&&(e.instances.splice(t,1),!0)}function s(t){e.save(t),e.names=[],e.skips=[];var n,r=("string"==typeof t?t:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&(t=r[n].replace(/\*/g,".*?"),"-"===t[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(n=0;n<e.instances.length;n++){var i=e.instances[n];i.enabled=e.enabled(i.namespace)}}function a(){e.enable("")}function c(t){if("*"===t[t.length-1])return!0;var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1}function p(t){return t instanceof Error?t.stack||t.message:t}e=t.exports=o.debug=o["default"]=o,e.coerce=p,e.disable=a,e.enable=s,e.enabled=c,e.humanize=n(6),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,e){function n(t){if(t=String(t),!(t.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*u;case"days":case"day":case"d":return n*p;case"hours":case"hour":case"hrs":case"hr":case"h":return n*c;case"minutes":case"minute":case"mins":case"min":case"m":return n*a;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function r(t){return t>=p?Math.round(t/p)+"d":t>=c?Math.round(t/c)+"h":t>=a?Math.round(t/a)+"m":t>=s?Math.round(t/s)+"s":t+"ms"}function o(t){return i(t,p,"day")||i(t,c,"hour")||i(t,a,"minute")||i(t,s,"second")||t+" ms"}function i(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}var s=1e3,a=60*s,c=60*a,p=24*c,u=365.25*p;t.exports=function(t,e){e=e||{};var i=typeof t;if("string"===i&&t.length>0)return n(t);if("number"===i&&isNaN(t)===!1)return e["long"]?o(t):r(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,n){function r(){}function o(t){var n=""+t.type;if(e.BINARY_EVENT!==t.type&&e.BINARY_ACK!==t.type||(n+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(n+=t.nsp+","),null!=t.id&&(n+=t.id),null!=t.data){var r=i(t.data);if(r===!1)return g;n+=r}return f("encoded %j as %s",t,n),n}function i(t){try{return JSON.stringify(t)}catch(e){return!1}}function s(t,e){function n(t){var n=d.deconstructPacket(t),r=o(n.packet),i=n.buffers;i.unshift(r),e(i)}d.removeBlobs(t,n)}function a(){this.reconstructor=null}function c(t){var n=0,r={type:Number(t.charAt(0))};if(null==e.types[r.type])return h("unknown packet type "+r.type);if(e.BINARY_EVENT===r.type||e.BINARY_ACK===r.type){for(var o="";"-"!==t.charAt(++n)&&(o+=t.charAt(n),n!=t.length););if(o!=Number(o)||"-"!==t.charAt(n))throw new Error("Illegal attachments");r.attachments=Number(o)}if("/"===t.charAt(n+1))for(r.nsp="";++n;){var i=t.charAt(n);if(","===i)break;if(r.nsp+=i,n===t.length)break}else r.nsp="/";var s=t.charAt(n+1);if(""!==s&&Number(s)==s){for(r.id="";++n;){var i=t.charAt(n);if(null==i||Number(i)!=i){--n;break}if(r.id+=t.charAt(n),n===t.length)break}r.id=Number(r.id)}if(t.charAt(++n)){var a=p(t.substr(n)),c=a!==!1&&(r.type===e.ERROR||y(a));if(!c)return h("invalid payload");r.data=a}return f("decoded %s as %j",t,r),r}function p(t){try{return JSON.parse(t)}catch(e){return!1}}function u(t){this.reconPack=t,this.buffers=[]}function h(t){return{type:e.ERROR,data:"parser error: "+t}}var f=n(3)("socket.io-parser"),l=n(8),d=n(9),y=n(10),m=n(11);e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=r,e.Decoder=a;var g=e.ERROR+'"encode error"';r.prototype.encode=function(t,n){if(f("encoding packet %j",t),e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type)s(t,n);else{var r=o(t);n([r])}},l(a.prototype),a.prototype.add=function(t){var n;if("string"==typeof t)n=c(t),e.BINARY_EVENT===n.type||e.BINARY_ACK===n.type?(this.reconstructor=new u(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!m(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,this.emit("decoded",n))}},a.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},u.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=d.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},u.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(t,e,n){function r(t){if(t)return o(t)}function o(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},r.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r,o=0;o<n.length;o++)if(r=n[o],r===e||r.fn===e){n.splice(o,1);break}return this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n){n=n.slice(0);for(var r=0,o=n.length;r<o;++r)n[r].apply(this,e)}return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,n){function r(t,e){if(!t)return t;if(s(t)){var n={_placeholder:!0,num:e.length};return e.push(t),n}if(i(t)){for(var o=new Array(t.length),a=0;a<t.length;a++)o[a]=r(t[a],e);return o}if("object"==typeof t&&!(t instanceof Date)){var o={};for(var c in t)o[c]=r(t[c],e);return o}return t}function o(t,e){if(!t)return t;if(t&&t._placeholder)return e[t.num];if(i(t))for(var n=0;n<t.length;n++)t[n]=o(t[n],e);else if("object"==typeof t)for(var r in t)t[r]=o(t[r],e);return t}var i=n(10),s=n(11),a=Object.prototype.toString,c="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===a.call(Blob),p="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===a.call(File);e.deconstructPacket=function(t){var e=[],n=t.data,o=t;return o.data=r(n,e),o.attachments=e.length,{packet:o,buffers:e}},e.reconstructPacket=function(t,e){return t.data=o(t.data,e),t.attachments=void 0,t},e.removeBlobs=function(t,e){function n(t,a,u){if(!t)return t;if(c&&t instanceof Blob||p&&t instanceof File){r++;var h=new FileReader;h.onload=function(){u?u[a]=this.result:o=this.result,--r||e(o)},h.readAsArrayBuffer(t)}else if(i(t))for(var f=0;f<t.length;f++)n(t[f],f,t);else if("object"==typeof t&&!s(t))for(var l in t)n(t[l],l,t)}var r=0,o=t;n(o),r||e(o)}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e){function n(t){return r&&Buffer.isBuffer(t)||o&&(t instanceof ArrayBuffer||i(t))}t.exports=n;var r="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,o="function"==typeof ArrayBuffer,i=function(t){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer}},function(t,e,n){"use strict";function r(t,e){if(!(this instanceof r))return new r(t,e);t&&"object"===("undefined"==typeof t?"undefined":o(t))&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new l({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=e.parser||c;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=e.autoConnect!==!1,this.autoConnect&&this.open()}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=n(13),s=n(36),a=n(8),c=n(7),p=n(38),u=n(39),h=n(3)("socket.io-client:manager"),f=n(35),l=n(40),d=Object.prototype.hasOwnProperty;t.exports=r,r.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var t in this.nsps)d.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},r.prototype.updateSocketIds=function(){for(var t in this.nsps)d.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},r.prototype.generateId=function(t){return("/"===t?"":t+"#")+this.engine.id},a(r.prototype),r.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},r.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},r.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},r.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},r.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},r.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},r.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},r.prototype.open=r.prototype.connect=function(t,e){if(h("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;h("opening %s",this.uri),this.engine=i(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var o=p(n,"open",function(){r.onopen(),t&&t()}),s=p(n,"error",function(e){if(h("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",e),t){var n=new Error("Connection error");n.data=e,t(n)}else r.maybeReconnectOnOpen()});if(!1!==this._timeout){var a=this._timeout;h("connect attempt will timeout after %d",a);var c=setTimeout(function(){h("connect attempt timed out after %d",a),o.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(c)}})}return this.subs.push(o),this.subs.push(s),this},r.prototype.onopen=function(){h("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(p(t,"data",u(this,"ondata"))),this.subs.push(p(t,"ping",u(this,"onping"))),this.subs.push(p(t,"pong",u(this,"onpong"))),this.subs.push(p(t,"error",u(this,"onerror"))),this.subs.push(p(t,"close",u(this,"onclose"))),this.subs.push(p(this.decoder,"decoded",u(this,"ondecoded")))},r.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},r.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},r.prototype.ondata=function(t){this.decoder.add(t)},r.prototype.ondecoded=function(t){this.emit("packet",t)},r.prototype.onerror=function(t){h("error",t),this.emitAll("error",t)},r.prototype.socket=function(t,e){function n(){~f(o.connecting,r)||o.connecting.push(r)}var r=this.nsps[t];if(!r){r=new s(this,t,e),this.nsps[t]=r;var o=this;r.on("connecting",n),r.on("connect",function(){r.id=o.generateId(t)}),this.autoConnect&&n()}return r},r.prototype.destroy=function(t){var e=f(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},r.prototype.packet=function(t){h("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,function(n){for(var r=0;r<n.length;r++)e.engine.write(n[r],t.options);e.encoding=!1,e.processPacketQueue()}))},r.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},r.prototype.cleanup=function(){h("cleanup");for(var t=this.subs.length,e=0;e<t;e++){var n=this.subs.shift();n.destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},r.prototype.close=r.prototype.disconnect=function(){h("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},r.prototype.onclose=function(t){h("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},r.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)h("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();h("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout(function(){t.skipReconnect||(h("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(h("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(h("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(n)}})}},r.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)}},function(t,e,n){t.exports=n(14),t.exports.parser=n(21)},function(t,e,n){function r(t,e){return this instanceof r?(e=e||{},t&&"object"==typeof t&&(e=t,t=null),t?(t=u(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=u(e.host).host),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.agent=e.agent||!1,this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=e.query||{},"string"==typeof this.query&&(this.query=h.decode(this.query)),this.upgrade=!1!==e.upgrade,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.jsonp=!1!==e.jsonp,this.forceBase64=!!e.forceBase64,this.enablesXDR=!!e.enablesXDR,this.timestampParam=e.timestampParam||"t",this.timestampRequests=e.timestampRequests,this.transports=e.transports||["polling","websocket"],this.transportOptions=e.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=e.policyPort||843,this.rememberUpgrade=e.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=e.onlyBinaryUpgrades,this.perMessageDeflate=!1!==e.perMessageDeflate&&(e.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=e.pfx||null,this.key=e.key||null,this.passphrase=e.passphrase||null,this.cert=e.cert||null,this.ca=e.ca||null,this.ciphers=e.ciphers||null,this.rejectUnauthorized=void 0===e.rejectUnauthorized||e.rejectUnauthorized,this.forceNode=!!e.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(e.extraHeaders&&Object.keys(e.extraHeaders).length>0&&(this.extraHeaders=e.extraHeaders),e.localAddress&&(this.localAddress=e.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,void this.open()):new r(t,e)}function o(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}var i=n(15),s=n(8),a=n(3)("engine.io-client:socket"),c=n(35),p=n(21),u=n(2),h=n(29);t.exports=r,r.priorWebsocketSuccess=!1,s(r.prototype),r.protocol=p.protocol,r.Socket=r,r.Transport=n(20),r.transports=n(15),r.parser=n(21),r.prototype.createTransport=function(t){a('creating transport "%s"',t);var e=o(this.query);e.EIO=p.protocol,e.transport=t;var n=this.transportOptions[t]||{};this.id&&(e.sid=this.id);var r=new i[t]({query:e,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative});return r},r.prototype.open=function(){var t;if(this.rememberUpgrade&&r.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout(function(){e.emit("error","No transports available")},0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(n){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},r.prototype.setTransport=function(t){a("setting transport %s",t.name);var e=this;this.transport&&(a("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.onDrain()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})},r.prototype.probe=function(t){function e(){if(f.onlyBinaryUpgrades){var e=!this.supportsBinary&&f.transport.supportsBinary;h=h||e}h||(a('probe transport "%s" opened',t),u.send([{type:"ping",data:"probe"}]),u.once("packet",function(e){if(!h)if("pong"===e.type&&"probe"===e.data){if(a('probe transport "%s" pong',t),f.upgrading=!0,f.emit("upgrading",u),!u)return;r.priorWebsocketSuccess="websocket"===u.name,a('pausing current transport "%s"',f.transport.name),f.transport.pause(function(){h||"closed"!==f.readyState&&(a("changing transport and sending upgrade packet"),p(),f.setTransport(u),u.send([{type:"upgrade"}]),f.emit("upgrade",u),u=null,f.upgrading=!1,f.flush())})}else{a('probe transport "%s" failed',t);var n=new Error("probe error");n.transport=u.name,f.emit("upgradeError",n)}}))}function n(){h||(h=!0,p(),u.close(),u=null)}function o(e){var r=new Error("probe error: "+e);r.transport=u.name,n(),a('probe transport "%s" failed because of error: %s',t,e),f.emit("upgradeError",r)}function i(){o("transport closed")}function s(){o("socket closed")}function c(t){u&&t.name!==u.name&&(a('"%s" works - aborting "%s"',t.name,u.name),n())}function p(){u.removeListener("open",e),u.removeListener("error",o),u.removeListener("close",i),f.removeListener("close",s),f.removeListener("upgrading",c)}a('probing transport "%s"',t);var u=this.createTransport(t,{probe:1}),h=!1,f=this;r.priorWebsocketSuccess=!1,u.once("open",e),u.once("error",o),u.once("close",i),this.once("close",s),this.once("upgrading",c),u.open()},r.prototype.onOpen=function(){if(a("socket open"),this.readyState="open",r.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){a("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},r.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(a('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else a('packet received with socket readyState "%s"',this.readyState)},r.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},r.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){"closed"!==e.readyState&&e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)},r.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout(function(){a("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)},t.pingInterval)},r.prototype.ping=function(){var t=this;this.sendPacket("ping",function(){t.emit("ping")})},r.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},r.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(a("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},r.prototype.write=r.prototype.send=function(t,e,n){return this.sendPacket("message",t,e,n),this},r.prototype.sendPacket=function(t,e,n,r){if("function"==typeof e&&(r=e,e=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){n=n||{},n.compress=!1!==n.compress;var o={type:t,data:e,options:n};this.emit("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}},r.prototype.close=function(){function t(){r.onClose("forced close"),a("socket closing - telling transport to close"),r.transport.close()}function e(){r.removeListener("upgrade",e),r.removeListener("upgradeError",e),t()}function n(){r.once("upgrade",e),r.once("upgradeError",e)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var r=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():t()}):this.upgrading?n():t()}return this},r.prototype.onError=function(t){a("socket error %j",t),r.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},r.prototype.onClose=function(t,e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){a('socket close with reason: "%s"',t);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),n.writeBuffer=[],n.prevBufferLen=0}},r.prototype.filterUpgrades=function(t){for(var e=[],n=0,r=t.length;n<r;n++)~c(this.transports,t[n])&&e.push(t[n]);return e}},function(t,e,n){function r(t){var e,n=!1,r=!1,a=!1!==t.jsonp;if("undefined"!=typeof location){var c="https:"===location.protocol,p=location.port;p||(p=c?443:80),n=t.hostname!==location.hostname||p!==t.port,r=t.secure!==c}if(t.xdomain=n,t.xscheme=r,e=new o(t),"open"in e&&!t.forceJSONP)return new i(t);if(!a)throw new Error("JSONP disabled");return new s(t)}var o=n(16),i=n(18),s=n(32),a=n(33);e.polling=r,e.websocket=a},function(t,e,n){var r=n(17);t.exports=function(t){var e=t.xdomain,n=t.xscheme,o=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||r))return new XMLHttpRequest}catch(i){}try{if("undefined"!=typeof XDomainRequest&&!n&&o)return new XDomainRequest}catch(i){}if(!e)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(i){}}},function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(n){t.exports=!1}},function(t,e,n){function r(){}function o(t){if(c.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,"undefined"!=typeof location){var e="https:"===location.protocol,n=location.port;n||(n=e?443:80),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||n!==t.port,this.xs=t.secure!==e}}function i(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}function s(){for(var t in i.requests)i.requests.hasOwnProperty(t)&&i.requests[t].abort()}var a=n(16),c=n(19),p=n(8),u=n(30),h=n(3)("engine.io-client:polling-xhr");if(t.exports=o,t.exports.Request=i,u(o,c),o.prototype.supportsBinary=!0,o.prototype.request=function(t){return t=t||{},t.uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new i(t)},o.prototype.doWrite=function(t,e){var n="string"!=typeof t&&void 0!==t,r=this.request({method:"POST",data:t,isBinary:n}),o=this;r.on("success",e),r.on("error",function(t){o.onError("xhr post error",t)}),this.sendXhr=r},o.prototype.doPoll=function(){h("xhr poll");var t=this.request(),e=this;t.on("data",function(t){e.onData(t)}),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t},p(i.prototype),i.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new a(t),n=this;try{h("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(var r in this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&e.setRequestHeader(r,this.extraHeaders[r])}}catch(o){}if("POST"===this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(o){}try{e.setRequestHeader("Accept","*/*")}catch(o){}"withCredentials"in e&&(e.withCredentials=!0),this.requestTimeout&&(e.timeout=this.requestTimeout),this.hasXDR()?(e.onload=function(){n.onLoad()},e.onerror=function(){n.onError(e.responseText)}):e.onreadystatechange=function(){if(2===e.readyState)try{var t=e.getResponseHeader("Content-Type");n.supportsBinary&&"application/octet-stream"===t&&(e.responseType="arraybuffer")}catch(r){}4===e.readyState&&(200===e.status||1223===e.status?n.onLoad():setTimeout(function(){n.onError(e.status)},0))},h("xhr data %s",this.data),e.send(this.data)}catch(o){return void setTimeout(function(){n.onError(o)},0)}"undefined"!=typeof document&&(this.index=i.requestsCount++,i.requests[this.index]=this)},i.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},i.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},i.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},i.prototype.cleanup=function(t){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=r:this.xhr.onreadystatechange=r,t)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete i.requests[this.index],this.xhr=null}},i.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(n){}t="application/octet-stream"===e?this.xhr.response||this.xhr.responseText:this.xhr.responseText}catch(n){this.onError(n)}null!=t&&this.onData(t)},i.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},i.prototype.abort=function(){this.cleanup()},i.requestsCount=0,i.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",s);else if("function"==typeof addEventListener){var f="onpagehide"in self?"pagehide":"unload";addEventListener(f,s,!1)}},function(t,e,n){function r(t){var e=t&&t.forceBase64;u&&!e||(this.supportsBinary=!1),o.call(this,t)}var o=n(20),i=n(29),s=n(21),a=n(30),c=n(31),p=n(3)("engine.io-client:polling");t.exports=r;var u=function(){var t=n(16),e=new t({xdomain:!1});return null!=e.responseType}();a(r,o),r.prototype.name="polling",r.prototype.doOpen=function(){this.poll()},r.prototype.pause=function(t){function e(){p("paused"),n.readyState="paused",t()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(p("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){p("pre-pause polling complete"),--r||e()})),this.writable||(p("we are currently writing - waiting to pause"),r++,this.once("drain",function(){p("pre-pause writing complete"),--r||e()}))}else e()},r.prototype.poll=function(){p("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},r.prototype.onData=function(t){var e=this;p("polling got data %s",t);var n=function(t,n,r){return"opening"===e.readyState&&e.onOpen(),"close"===t.type?(e.onClose(),!1):void e.onPacket(t)};s.decodePayload(t,this.socket.binaryType,n),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():p('ignoring poll - transport state "%s"',this.readyState))},r.prototype.doClose=function(){function t(){p("writing close packet"),e.write([{type:"close"}])}var e=this;"open"===this.readyState?(p("transport open - closing"),t()):(p("transport not open - deferring close"),this.once("open",t))},r.prototype.write=function(t){var e=this;this.writable=!1;var n=function(){e.writable=!0,e.emit("drain")};s.encodePayload(t,this.supportsBinary,function(t){e.doWrite(t,n)})},r.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";!1!==this.timestampRequests&&(t[this.timestampParam]=c()),this.supportsBinary||t.sid||(t.b64=1),t=i.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(n=":"+this.port),t.length&&(t="?"+t);var r=this.hostname.indexOf(":")!==-1;return e+"://"+(r?"["+this.hostname+"]":this.hostname)+n+this.path+t}},function(t,e,n){function r(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.isReactNative=t.isReactNative,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}var o=n(21),i=n(8);t.exports=r,i(r.prototype),r.prototype.onError=function(t,e){var n=new Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this},r.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},r.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},r.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},r.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},r.prototype.onData=function(t){var e=o.decodePacket(t,this.socket.binaryType);this.onPacket(e)},r.prototype.onPacket=function(t){this.emit("packet",t)},r.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(t,e,n){function r(t,n){var r="b"+e.packets[t.type]+t.data.data;return n(r)}function o(t,n,r){if(!n)return e.encodeBase64Packet(t,r);var o=t.data,i=new Uint8Array(o),s=new Uint8Array(1+o.byteLength);s[0]=v[t.type];for(var a=0;a<i.length;a++)s[a+1]=i[a];return r(s.buffer)}function i(t,n,r){if(!n)return e.encodeBase64Packet(t,r);var o=new FileReader;return o.onload=function(){e.encodePacket({type:t.type,data:o.result},n,!0,r)},o.readAsArrayBuffer(t.data)}function s(t,n,r){if(!n)return e.encodeBase64Packet(t,r);if(g)return i(t,n,r);var o=new Uint8Array(1);o[0]=v[t.type];var s=new k([o.buffer,t.data]);return r(s)}function a(t){try{t=d.decode(t,{strict:!1})}catch(e){return!1}return t}function c(t,e,n){for(var r=new Array(t.length),o=l(t.length,n),i=function(t,n,o){e(n,function(e,n){r[t]=n,o(e,r)})},s=0;s<t.length;s++)i(s,t[s],o)}var p,u=n(22),h=n(23),f=n(24),l=n(25),d=n(26);"undefined"!=typeof ArrayBuffer&&(p=n(27));var y="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),m="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),g=y||m;e.protocol=3;var v=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},b=u(v),w={type:"error",data:"parser error"},k=n(28);e.encodePacket=function(t,e,n,i){"function"==typeof e&&(i=e,e=!1),"function"==typeof n&&(i=n,n=null);var a=void 0===t.data?void 0:t.data.buffer||t.data;if("undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer)return o(t,e,i);if("undefined"!=typeof k&&a instanceof k)return s(t,e,i);if(a&&a.base64)return r(t,i);var c=v[t.type];return void 0!==t.data&&(c+=n?d.encode(String(t.data),{strict:!1}):String(t.data)),i(""+c)},e.encodeBase64Packet=function(t,n){var r="b"+e.packets[t.type];if("undefined"!=typeof k&&t.data instanceof k){var o=new FileReader;return o.onload=function(){var t=o.result.split(",")[1];n(r+t)},o.readAsDataURL(t.data)}var i;try{i=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(s){for(var a=new Uint8Array(t.data),c=new Array(a.length),p=0;p<a.length;p++)c[p]=a[p];i=String.fromCharCode.apply(null,c)}return r+=btoa(i),n(r)},e.decodePacket=function(t,n,r){if(void 0===t)return w;if("string"==typeof t){if("b"===t.charAt(0))return e.decodeBase64Packet(t.substr(1),n);if(r&&(t=a(t),t===!1))return w;var o=t.charAt(0);return Number(o)==o&&b[o]?t.length>1?{type:b[o],data:t.substring(1)}:{type:b[o]}:w}var i=new Uint8Array(t),o=i[0],s=f(t,1);return k&&"blob"===n&&(s=new k([s])),{type:b[o],data:s}},e.decodeBase64Packet=function(t,e){var n=b[t.charAt(0)];if(!p)return{type:n,data:{base64:!0,data:t.substr(1)}};var r=p.decode(t.substr(1));return"blob"===e&&k&&(r=new k([r])),{type:n,data:r}},e.encodePayload=function(t,n,r){function o(t){return t.length+":"+t}function i(t,r){e.encodePacket(t,!!s&&n,!1,function(t){r(null,o(t))})}"function"==typeof n&&(r=n,n=null);var s=h(t);return n&&s?k&&!g?e.encodePayloadAsBlob(t,r):e.encodePayloadAsArrayBuffer(t,r):t.length?void c(t,i,function(t,e){return r(e.join(""))}):r("0:")},e.decodePayload=function(t,n,r){if("string"!=typeof t)return e.decodePayloadAsBinary(t,n,r);"function"==typeof n&&(r=n,n=null);var o;if(""===t)return r(w,0,1);for(var i,s,a="",c=0,p=t.length;c<p;c++){var u=t.charAt(c);if(":"===u){if(""===a||a!=(i=Number(a)))return r(w,0,1);if(s=t.substr(c+1,i),a!=s.length)return r(w,0,1);if(s.length){if(o=e.decodePacket(s,n,!1),w.type===o.type&&w.data===o.data)return r(w,0,1);var h=r(o,c+i,p);if(!1===h)return}c+=i,a=""}else a+=u}return""!==a?r(w,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,n){function r(t,n){e.encodePacket(t,!0,!0,function(t){return n(null,t)})}return t.length?void c(t,r,function(t,e){var r=e.reduce(function(t,e){var n;return n="string"==typeof e?e.length:e.byteLength,t+n.toString().length+n+2},0),o=new Uint8Array(r),i=0;return e.forEach(function(t){var e="string"==typeof t,n=t;if(e){for(var r=new Uint8Array(t.length),s=0;s<t.length;s++)r[s]=t.charCodeAt(s);n=r.buffer}e?o[i++]=0:o[i++]=1;for(var a=n.byteLength.toString(),s=0;s<a.length;s++)o[i++]=parseInt(a[s]);o[i++]=255;for(var r=new Uint8Array(n),s=0;s<r.length;s++)o[i++]=r[s]}),n(o.buffer)}):n(new ArrayBuffer(0))},e.encodePayloadAsBlob=function(t,n){function r(t,n){e.encodePacket(t,!0,!0,function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var r=new Uint8Array(t.length),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);t=r.buffer,e[0]=0}for(var i=t instanceof ArrayBuffer?t.byteLength:t.size,s=i.toString(),a=new Uint8Array(s.length+1),o=0;o<s.length;o++)a[o]=parseInt(s[o]);if(a[s.length]=255,k){var c=new k([e.buffer,a.buffer,t]);n(null,c)}})}c(t,r,function(t,e){return n(new k(e))})},e.decodePayloadAsBinary=function(t,n,r){"function"==typeof n&&(r=n,n=null);for(var o=t,i=[];o.byteLength>0;){for(var s=new Uint8Array(o),a=0===s[0],c="",p=1;255!==s[p];p++){if(c.length>310)return r(w,0,1);c+=s[p]}o=f(o,2+c.length),c=parseInt(c);var u=f(o,0,c);if(a)try{u=String.fromCharCode.apply(null,new Uint8Array(u))}catch(h){var l=new Uint8Array(u);u="";for(var p=0;p<l.length;p++)u+=String.fromCharCode(l[p])}i.push(u),o=f(o,c)}var d=i.length;i.forEach(function(t,o){r(e.decodePacket(t,n,!0),o,d)})}},function(t,e){t.exports=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e}},function(t,e,n){function r(t){if(!t||"object"!=typeof t)return!1;if(o(t)){for(var e=0,n=t.length;e<n;e++)if(r(t[e]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(t)||"function"==typeof ArrayBuffer&&t instanceof ArrayBuffer||s&&t instanceof Blob||a&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return r(t.toJSON(),!0);for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&r(t[i]))return!0;return!1}var o=n(10),i=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),a="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);t.exports=r},function(t,e){t.exports=function(t,e,n){var r=t.byteLength;if(e=e||0,n=n||r,t.slice)return t.slice(e,n);if(e<0&&(e+=r),n<0&&(n+=r),n>r&&(n=r),e>=r||e>=n||0===r)return new ArrayBuffer(0);for(var o=new Uint8Array(t),i=new Uint8Array(n-e),s=e,a=0;s<n;s++,a++)i[a]=o[s];return i.buffer}},function(t,e){function n(t,e,n){function o(t,r){if(o.count<=0)throw new Error("after called too many times");--o.count,t?(i=!0,e(t),e=n):0!==o.count||i||e(null,r)}var i=!1;return n=n||r,o.count=t,0===t?e():o}function r(){}t.exports=n},function(t,e){function n(t){for(var e,n,r=[],o=0,i=t.length;o<i;)e=t.charCodeAt(o++),e>=55296&&e<=56319&&o<i?(n=t.charCodeAt(o++),56320==(64512&n)?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),o--)):r.push(e);return r}function r(t){for(var e,n=t.length,r=-1,o="";++r<n;)e=t[r],e>65535&&(e-=65536,o+=d(e>>>10&1023|55296),e=56320|1023&e),o+=d(e);return o}function o(t,e){if(t>=55296&&t<=57343){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function i(t,e){return d(t>>e&63|128)}function s(t,e){if(0==(4294967168&t))return d(t);var n="";return 0==(4294965248&t)?n=d(t>>6&31|192):0==(4294901760&t)?(o(t,e)||(t=65533),n=d(t>>12&15|224),n+=i(t,6)):0==(4292870144&t)&&(n=d(t>>18&7|240),n+=i(t,12),n+=i(t,6)),n+=d(63&t|128)}function a(t,e){e=e||{};for(var r,o=!1!==e.strict,i=n(t),a=i.length,c=-1,p="";++c<a;)r=i[c],p+=s(r,o);return p}function c(){if(l>=f)throw Error("Invalid byte index");var t=255&h[l];if(l++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function p(t){var e,n,r,i,s;if(l>f)throw Error("Invalid byte index");if(l==f)return!1;if(e=255&h[l],l++,0==(128&e))return e;if(192==(224&e)){if(n=c(),s=(31&e)<<6|n,s>=128)return s;throw Error("Invalid continuation byte")}if(224==(240&e)){if(n=c(),r=c(),s=(15&e)<<12|n<<6|r,s>=2048)return o(s,t)?s:65533;throw Error("Invalid continuation byte")}if(240==(248&e)&&(n=c(),r=c(),i=c(),s=(7&e)<<18|n<<12|r<<6|i,s>=65536&&s<=1114111))return s;throw Error("Invalid UTF-8 detected")}function u(t,e){e=e||{};var o=!1!==e.strict;h=n(t),f=h.length,l=0;for(var i,s=[];(i=p(o))!==!1;)s.push(i);return r(s)}var h,f,l,d=String.fromCharCode;t.exports={version:"2.1.2",encode:a,decode:u}},function(t,e){!function(){"use strict";for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<t.length;r++)n[t.charCodeAt(r)]=r;e.encode=function(e){var n,r=new Uint8Array(e),o=r.length,i="";for(n=0;n<o;n+=3)i+=t[r[n]>>2],i+=t[(3&r[n])<<4|r[n+1]>>4],i+=t[(15&r[n+1])<<2|r[n+2]>>6],i+=t[63&r[n+2]];return o%3===2?i=i.substring(0,i.length-1)+"=":o%3===1&&(i=i.substring(0,i.length-2)+"=="),i},e.decode=function(t){var e,r,o,i,s,a=.75*t.length,c=t.length,p=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var u=new ArrayBuffer(a),h=new Uint8Array(u);for(e=0;e<c;e+=4)r=n[t.charCodeAt(e)],o=n[t.charCodeAt(e+1)],i=n[t.charCodeAt(e+2)],s=n[t.charCodeAt(e+3)],h[p++]=r<<2|o>>4,h[p++]=(15&o)<<4|i>>2,h[p++]=(3&i)<<6|63&s;return u}}()},function(t,e){function n(t){return t.map(function(t){if(t.buffer instanceof ArrayBuffer){var e=t.buffer;if(t.byteLength!==e.byteLength){var n=new Uint8Array(t.byteLength);n.set(new Uint8Array(e,t.byteOffset,t.byteLength)),e=n.buffer}return e}return t})}function r(t,e){e=e||{};var r=new i;return n(t).forEach(function(t){r.append(t)}),e.type?r.getBlob(e.type):r.getBlob()}function o(t,e){return new Blob(n(t),e||{})}var i="undefined"!=typeof i?i:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,s=function(){try{var t=new Blob(["hi"]);return 2===t.size}catch(e){return!1}}(),a=s&&function(){try{var t=new Blob([new Uint8Array([1,2])]);return 2===t.size}catch(e){return!1}}(),c=i&&i.prototype.append&&i.prototype.getBlob;"undefined"!=typeof Blob&&(r.prototype=Blob.prototype,o.prototype=Blob.prototype),t.exports=function(){return s?a?Blob:o:c?r:void 0}()},function(t,e){e.encode=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},e.decode=function(t){for(var e={},n=t.split("&"),r=0,o=n.length;r<o;r++){var i=n[r].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}},function(t,e){t.exports=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e){"use strict";function n(t){var e="";do{e=s[t%a]+e,t=Math.floor(t/a)}while(t>0);return e}function r(t){var e=0;for(u=0;u<t.length;u++)e=e*a+c[t.charAt(u)];return e}function o(){var t=n(+new Date);return t!==i?(p=0,i=t):t+"."+n(p++)}for(var i,s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),a=64,c={},p=0,u=0;u<a;u++)c[s[u]]=u;o.encode=n,o.decode=r,t.exports=o},function(t,e,n){(function(e){function r(){}function o(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof e?e:{}}function i(t){if(s.call(this,t),this.query=this.query||{},!c){var e=o();c=e.___eio=e.___eio||[]}this.index=c.length;var n=this;c.push(function(t){n.onData(t)}),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",function(){n.script&&(n.script.onerror=r)},!1)}var s=n(19),a=n(30);t.exports=i;var c,p=/\n/g,u=/\\n/g;a(i,s),i.prototype.supportsBinary=!1,i.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),s.prototype.doClose.call(this)},i.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e;var r="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);r&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},i.prototype.doWrite=function(t,e){function n(){r(),e()}function r(){if(o.iframe)try{o.form.removeChild(o.iframe)}catch(t){o.onError("jsonp polling iframe removal error",t)}try{var e='<iframe src="javascript:0" name="'+o.iframeId+'">';i=document.createElement(e)}catch(t){i=document.createElement("iframe"),i.name=o.iframeId,i.src="javascript:0"}i.id=o.iframeId,o.form.appendChild(i),o.iframe=i}var o=this;if(!this.form){var i,s=document.createElement("form"),a=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=c,s.method="POST",s.setAttribute("accept-charset","utf-8"),a.name="d",s.appendChild(a),document.body.appendChild(s),this.form=s,this.area=a}this.form.action=this.uri(),r(),t=t.replace(u,"\\\n"),this.area.value=t.replace(p,"\\n");try{this.form.submit()}catch(h){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===o.iframe.readyState&&n()}:this.iframe.onload=n}}).call(e,function(){return this}())},function(t,e,n){function r(t){var e=t&&t.forceBase64;e&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=o&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(l=i),s.call(this,t)}var o,i,s=n(20),a=n(21),c=n(29),p=n(30),u=n(31),h=n(3)("engine.io-client:websocket");if("undefined"==typeof self)try{i=n(34)}catch(f){}else o=self.WebSocket||self.MozWebSocket;var l=o||i;t.exports=r,p(r,s),r.prototype.name="websocket",r.prototype.supportsBinary=!0,r.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?e?new l(t,e):new l(t):new l(t,e,n)}catch(r){return this.emit("error",r)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},r.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},r.prototype.write=function(t){function e(){n.emit("flush"),setTimeout(function(){n.writable=!0,n.emit("drain")},0)}var n=this;this.writable=!1;for(var r=t.length,o=0,i=r;o<i;o++)!function(t){a.encodePacket(t,n.supportsBinary,function(o){if(!n.usingBrowserWebSocket){var i={};if(t.options&&(i.compress=t.options.compress),n.perMessageDeflate){var s="string"==typeof o?Buffer.byteLength(o):o.length;s<n.perMessageDeflate.threshold&&(i.compress=!1)}}try{n.usingBrowserWebSocket?n.ws.send(o):n.ws.send(o,i)}catch(a){h("websocket closed before onclose event")}--r||e()})}(t[o])},r.prototype.onClose=function(){s.prototype.onClose.call(this)},r.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},r.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",n="";this.port&&("wss"===e&&443!==Number(this.port)||"ws"===e&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=u()),this.supportsBinary||(t.b64=1),t=c.encode(t),t.length&&(t="?"+t);var r=this.hostname.indexOf(":")!==-1;return e+"://"+(r?"["+this.hostname+"]":this.hostname)+n+this.path+t},r.prototype.check=function(){return!(!l||"__initialize"in l&&this.name===r.prototype.name)}},function(t,e){},function(t,e){var n=[].indexOf;t.exports=function(t,e){if(n)return t.indexOf(e);for(var r=0;r<t.length;++r)if(t[r]===e)return r;return-1}},function(t,e,n){"use strict";function r(t,e,n){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=n(7),s=n(8),a=n(37),c=n(38),p=n(39),u=n(3)("socket.io-client:socket"),h=n(29),f=n(23);t.exports=e=r;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},d=s.prototype.emit;s(r.prototype),r.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[c(t,"open",p(this,"onopen")),c(t,"packet",p(this,"onpacket")),c(t,"close",p(this,"onclose"))]}},r.prototype.open=r.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},r.prototype.send=function(){var t=a(arguments);return t.unshift("message"),this.emit.apply(this,t),this},r.prototype.emit=function(t){if(l.hasOwnProperty(t))return d.apply(this,arguments),this;var e=a(arguments),n={type:(void 0!==this.flags.binary?this.flags.binary:f(e))?i.BINARY_EVENT:i.EVENT,data:e};return n.options={},n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(u("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},r.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},r.prototype.onopen=function(){if(u("transport is open - connecting"),"/"!==this.nsp)if(this.query){var t="object"===o(this.query)?h.encode(this.query):this.query;u("sending connect packet with query %s",t),this.packet({type:i.CONNECT,query:t})}else this.packet({type:i.CONNECT})},r.prototype.onclose=function(t){u("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},r.prototype.onpacket=function(t){var e=t.nsp===this.nsp,n=t.type===i.ERROR&&"/"===t.nsp;if(e||n)switch(t.type){case i.CONNECT:this.onconnect();break;case i.EVENT:this.onevent(t);break;case i.BINARY_EVENT:this.onevent(t);break;case i.ACK:this.onack(t);break;case i.BINARY_ACK:this.onack(t);break;case i.DISCONNECT:this.ondisconnect();break;case i.ERROR:this.emit("error",t.data)}},r.prototype.onevent=function(t){var e=t.data||[];u("emitting event %j",e),null!=t.id&&(u("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?d.apply(this,e):this.receiveBuffer.push(e)},r.prototype.ack=function(t){var e=this,n=!1;return function(){if(!n){n=!0;var r=a(arguments);u("sending ack %j",r),e.packet({type:f(r)?i.BINARY_ACK:i.ACK,id:t,data:r})}}},r.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(u("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):u("bad ack %s",t.id)},r.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},r.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)d.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},r.prototype.ondisconnect=function(){u("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},r.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},r.prototype.close=r.prototype.disconnect=function(){return this.connected&&(u("performing disconnect (%s)",this.nsp),this.packet({type:i.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},r.prototype.compress=function(t){return this.flags.compress=t,this},r.prototype.binary=function(t){return this.flags.binary=t,this}},function(t,e){function n(t,e){var n=[];e=e||0;for(var r=e||0;r<t.length;r++)n[r-e]=t[r];return n}t.exports=n},function(t,e){"use strict";function n(t,e,n){return t.on(e,n),{destroy:function(){t.removeListener(e,n)}}}t.exports=n},function(t,e){var n=[].slice;t.exports=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return e.apply(t,r.concat(n.call(arguments)))}}},function(t,e){function n(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}t.exports=n,n.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(t){this.ms=t},n.prototype.setMax=function(t){this.max=t},n.prototype.setJitter=function(t){this.jitter=t}}])});var ConfigReader=function(configroot){configroot.getUserID=function(){return this._map.userid};configroot.getActiveBaseAppIndex=function(){return this._map.activebaseappindex};configroot.getBaseAppList=function(){return this._map.baseapplist};configroot.getBaseApp=function(){return this.getBaseAppList()[this.getActiveBaseAppIndex()]};configroot.getBaseAppHost=function(){return new URL(config.getBaseApp()).host};configroot.getBaseWS=function(){return this.getBaseApp().replace(/http/,"ws")+"/ws"};configroot.getBaseWebResource=function(){return this.getBaseApp()+"/plugin/resources/"+chrome.i18n.getMessage("labelid")};configroot.getExpand=function(){return false};configroot.getSkipTaggedFlag=function(){return this._map.skiptaggedflag==true};configroot.getSkipTaggedValue=function(){return this._map.skiptaggedvalue};configroot.getSkipCustomFlag=function(){return this._map.skipcustomflag==true};configroot.getSkipCustomValue=function(){return this._map.skipcustomvalue};configroot.getSkipNoName=function(){return this._map.skipnoname==true};configroot.getSkipNoImage=function(){return this._map.skipnoimage==true};configroot.getSkipInCRM=function(){return this._map.skipincrm==true};configroot.getSkip3Plus=function(){return this._map.skip3plus==true};configroot.getSkipNoPremium=function(){return this._map.skipnopremium==true};configroot.getSkipNoLION=function(){return this._map.skipnolion==true};configroot.getSkipNoInfluencer=function(){return this._map.skipnoinfluencer==true};configroot.getSkipNoJobSeeker=function(){return this._map.skipnojobseeker==true};configroot.getExcludeBlacklistedAction=function(){return this._map.excludeblacklistedaction==true};configroot.getKillCharacters=function(){return this._map.killcharacters};configroot.getKillWords=function(){return this._map.killwords};configroot.getSnooze=function(){if(this.throttlingIsActive()){return this._map.snooze==true}else{return false}};configroot.getRandomRangeFlag=function(){if(this.throttlingIsActive()){return this._map.randomrange==true}else{return false}};configroot.getRandomRangeValue=function(){if(this.throttlingIsActive()){return this._map.randomrange==true}else{return false}};configroot.getRobotSchedulePlan=function(){return this._map.robotscheduleplan};configroot.getPauseRobot=function(){return this._map.pauserobot==true};configroot.getReloadOnHang=function(){return this._map.reloadonhang==true};configroot.getIgnoreUnknown=function(){return this._map.ignoreunknown==true};configroot.isPro=function(){return this._map.promode==true};configroot.getBuyMail=function(){return this._map.buymail==true};configroot.getAcceptTandCs=function(){return this._map.accepttandcs==true};configroot.getAutoEndorse=function(){return this._map.autoendorse==true};configroot.getAutoEndorseTarget=function(){var rv=1;try{rv=parseInt(this._map.autoendorsetarget)}catch(e){}return rv};configroot.getAutoTagFlag=function(){return this._map.autotagflag==true};configroot.getAutoTagValue=function(){return this._map.autotagvalue};configroot.getAutoFollow=function(){return this._map.autofollow==true};configroot.getAutoDisconnect=function(){return this._map.autodisconnect==true};configroot.getAutoPDF=function(){return this._map.autopdf==true};configroot.getAutoOnManual=function(){return this._map.runautomationsonmanualvisits==true};configroot.getAutoConnect=function(){return this._map.autoconnect==true};configroot.getAutoSaveAsLead=function(){return this._map.autosaveaslead==true};configroot.getAutoProcessNewConnections=function(){return true};configroot.getAutoConnectMessageFlag=function(){return this._map.autoconnectmessageflag==true};configroot.getAutoConnectMessageText=function(){return this._map.autoconnectmessagetext};configroot.getFollowUpFlag=function(){return this._map.followupflag==true};configroot.getFollowUpSchedule=function(){return this._map.followups};configroot.getConnectedMessageFlag=function(){return this._map.connectedmessageflag==true};configroot.getConnectedMessageText=function(){return this._map.connectedmessagetext};configroot.getSendInmailFlag=function(){return this._map.sendinmailflag==true};configroot.getSendInmailSubject=function(){return this._map.sendinmailsubject};configroot.getSendInmailBody=function(){return this._map.sendinmailbody};configroot.getBadgeDisplay=function(){return this._map.badgedisplay};configroot.getPreVisitDialog=function(){return this._map.previsitdialog};configroot.getExtendedCSVData=function(){return this._map.extendedcsvdata};configroot.getSkipDays=function(){return parseInt(this._map.skipdays)};configroot.getPageInitDelay=function(){var rvoptions=[2500,5e3,7500,1e4];return rvoptions[(this.getMaxPageLoadTime()-1e4)/1e4]};configroot.getWaitMinutes=function(){return this._map.waitminutes};configroot.getWaitVisits=function(){return this._map.waitvisits};configroot.getWebhookProfileFlag=function(){return this._map.webhookprofileflag==true};configroot.getWebhooks=function(){return this._map.webhooks};configroot.getMessageBridgeFlag=function(){return this._map.messagebridgeflag==true};configroot.getRemoteControlFlag=function(){return this._map.remotecontrolflag==true};configroot.getMaxPageLoadTime=function(){return parseInt(this._map.maxpageloadtime)};configroot.getInfoNotifications=function(){return this._map.infonotifications==true};configroot.getActionNotifications=function(){return this._map.actionnotifications==true};configroot.getWarningNotifications=function(){return this._map.warningnotifications==true};configroot.getCSVSeparator=function(){return this._map.csvseparator};configroot.getCSVEncoding=function(){return"utf-8"};configroot.getManagedDownload=function(){return this._map.manageddownload};configroot.includeCSVHint=function(){return false};configroot.getDebugMode=function(){return this._map.debugmode==true};configroot.getDebugLog=function(){return this._map.debuglog==true};configroot.getKillTracking=function(){return this._map.killtracking==true};configroot.getKillExtensions=function(){return this._map.killextensions==true};configroot.getKillAds=function(){return true};configroot.getStartDisabled=function(){return this._map.startdisabled==true};configroot.getMode=function(){return this._map.mode};configroot.getLogLevel=function(){if(this.getDebugLog()){return 0}else{return this._map.loglevel}};configroot.getLogChannels=function(){if(this.getDebugLog()){return["console"]}else{return this._map.logchannels}};configroot.getLogStack=function(){return this._map.logstack==true};configroot.getLogStackFilter=function(){return this._map.logstackfilter};configroot.getThrottleTime=function(){var rv=0;try{rv=parseInt(this._map.throttletime)}catch(e){}return rv};configroot.getScanThrottleTime=function(){var rv=1e3;try{rv=parseInt(this._map.scanthrottletime)}catch(e){}return rv};configroot.getMaxVisits=function(){var rv=100;try{rv=parseInt(this._map.maxvisits)}catch(e){}return rv};configroot.getMaxInvites=function(){var rv=10;try{rv=parseInt(this._map.maxinvites)}catch(e){}return rv};configroot.getMaxMessages=function(){var rv=100;try{rv=parseInt(this._map.maxmessages)}catch(e){}return rv};configroot.getDailyLimitOffset=function(){return this._map.dailylimitoffset};configroot.getMaxTagResults=function(profile){var rv=5;try{rv=this.fulltagsIsActive()?Number.MAX_VALUE:5}catch(e){}return rv};configroot.getMaxTags=function(profile){var rv=100;try{rv=this.fulltagsIsActive()?Number.MAX_VALUE:100}catch(e){}return rv};configroot.getAffiliateLicense=function(){return this._map.affiliatelicense};configroot.getActiveFeatures=function(){return this._map.features};configroot.getEdition=function(){return this._map.edition};configroot.getMap=function(){return Object.assign({},this._map)};configroot.throttlingIsActive=function(){return this._map.features[_featureids.throttling]};configroot.automationIsActive=function(){return this._map.features[_featureids.automation]};configroot.csvfilesIsActive=function(){return this._map.features[_featureids.csvfiles]};configroot.userlimitsIsActive=function(){return this._map.features[_featureids.userlimits]};configroot.fulltagsIsActive=function(){return this._map.features[_featureids.fulltags]};configroot.webhooksIsActive=function(){return this._map.features[_featureids.webhooks]};configroot.remotecontrolIsActive=function(){return this._map.features[_featureids.remotecontrol]};configroot.basicOrchestrationlIsActive=function(){return this._map.features[_featureids.orchestration]==1};configroot.fullOrchestrationlIsActive=function(){return this._map.features[_featureids.orchestration]==2};configroot.getQuota=function(quotaid){return this._map.quota[quotaid]};configroot.getUserAuthenticationType=function(){return this._map.userauthenticationtype}};function SimpleConfigReader(valuemap){var rv={};rv._map=Object.assign({},valuemap);ConfigReader(rv);return rv}const _featureids={throttling:"throttling",automation:"automation",csvfiles:"csvfiles",userlimits:"userlimits",fulltags:"fulltags",webhooks:"webhooks",remotecontrol:"remotecontrol",orchestration:"orchestration"};const _quoateids={BasicProfile:"BasicProfile",PlusProfile:"PlusProfile",SalesProfiles:"SalesProfiles",RecruiterProfile:"RecruiterProfile"};var configFactory={defaultuserconfig:{userid:"000000000000000000000",clientid:null,throttletime:"1",scanthrottletime:"3000",maxvisits:"0",maxinvites:"100",maxmessages:"200",dailylimitoffset:-1*(new Date).getTimezoneOffset(),expand:false,skiptaggedflag:false,skiptaggedvalue:"",skipcustomflag:false,skipcustomvalue:"",skipnoname:true,skipnoimage:true,skipincrm:false,skipnopremium:false,skip3plus:true,skipnolion:false,skipnoinfluencer:false,skipnojobseeker:false,excludeblacklistedaction:true,killcharacters:".,★☆✪☁📍💪🏼🎖🏼📦♦➤✔✓~()\"'",killwords:"bsn, ceo, certified, copywriter, cpc, digital, dr, drs, expert, freelance, hubspot, internet, lion, lme, lmt, ma, marketing, mba, md, mim, msc, ninja, online, pharma, phd, ppc, seo, sip, videoseo",snooze:true,randomrange:false,pauserobot:false,reloadonhang:true,ignoreunknown:false,accepttandcs:false,robotscheduleplan:{0:[["06:00","23:00"]],1:[["06:00","23:00"]],2:[["06:00","23:00"]],3:[["06:00","23:00"]],4:[["06:00","23:00"]],5:[["06:00","23:00"]],6:[["06:00","23:00"]]},buymail:false,previsitdialog:true,extendedcsvdata:false,autoendorse:false,autoendorsetarget:3,badgedisplay:"captures",csvhint:false,csvseparator:",",csvencoding:"utf-8",autotagflag:false,autotagvalue:"",followupflag:false,autofollow:false,autodisconnect:false,autopdf:false,sendinmailflag:false,sendinmailsubject:"",sendinmailbody:"",autosaveaslead:false,autoconnect:false,autoconnectmessageflag:false,autoconnectmessagetext:"",connectedmessageflag:false,connectedmessagetext:"",skipdays:31,pageinitdelay:2500,waitminutes:5,waitvisits:20,maxpageloadtime:2e4,warningnotifications:true,actionnotifications:true,infonotifications:true,debugmode:false,debuglog:false,killtracking:false,killextensions:true,killads:true,startdisabled:false,logstack:false,logstackfilter:"",affiliatelicense:{key:"",productid:""},activebaseappindex:0,userauthenticationtype:"oauth2",runautomationsonmanualvisits:false,manageddownload:true,webhookprofileflag:false,webhooks:[],followups:[],messagebridgeflag:false,remotecontrolflag:false},defaultsystemconfig:{edition:"starter",features:{},quota:{},loglevel:4,logchannels:["db","console"]},_map:{},init:function(mode){this.defaultsystemconfig.mode=mode;this.defaultsystemconfig.activeuserauthenticationtype=null;if(mode=="development"){this.defaultsystemconfig.loglevel=0;this.defaultsystemconfig.logchannels=["console"];this.defaultsystemconfig.baseapplist=["http://localhost:8080","http://localhost:8080"];this.defaultuserconfig.debuglog=true}else{this.defaultsystemconfig.loglevel=2;this.defaultsystemconfig.logchannels=["db"];this.defaultsystemconfig.baseapplist=["https://app.dux-soup.com","https://app-fo.dux-soup.com"];this.defaultuserconfig.debuglog=false}this.buildMap();ConfigReader(this);ConfigWriter(this);return this},factoryReset:function(){var clientid=config.getClientID();var userid=config.getUserID();var affiliatelicense=this._map.affiliatelicense;var features=config.getActiveFeatures();var edition=config.getEdition();localStorage.duxsoup_options=JSON.stringify({});this.init(this.defaultsystemconfig.mode);config.setUserID(userid);config.setClientID(clientid);this._map.affiliatelicense=affiliatelicense;this._map.features=features;this._map.edition=edition;localStorage.duxsoup_options=JSON.stringify(this.getUserValueMap())},swapoutUser:function(){if(!localStorage.other_duxsoup_options){localStorage.other_duxsoup_options=JSON.stringify({})}var authtype=this.getUserAuthenticationType();var others=JSON.parse(localStorage.other_duxsoup_options);others[config.getUserID()]=this.getUserValueMap();localStorage.other_duxsoup_options=JSON.stringify(others);config.setUserID("000000000000000000000");config.setUserEmail("noone@home");localStorage.duxsoup_options=others[config.getUserID()];this.buildMap();this.setOptions({userauthenticationtype:authtype})},swapinUser:function(userid){if(!localStorage.other_duxsoup_options){localStorage.other_duxsoup_options=JSON.stringify({})}var authtype=this.getUserAuthenticationType();config.setUserID(userid);var others=JSON.parse(localStorage.other_duxsoup_options);var thisuser=others[config.getUserID()];if(!!thisuser){localStorage.duxsoup_options=JSON.stringify(thisuser)}this.buildMap();config.setUserID(userid);this.setOptions({userauthenticationtype:authtype})},migrateIfNeeded:function(){if(this._map.webhookprofilevalue!=null){if(this._map.webhookprofilevalue!=""){var events=[];if(this._map.webhookvisiteventsflag)events.push("visit");if(this._map.webhookscaneventsflag)events.push("scan");if(this._map.webhookactioneventsflag)events.push("action");if(this._map.webhookmessageeventsflag)events.push("message");if(this._map.webhookrceventsflag)events.push("rc");this._map.webhooks=[{url:this._map.webhookprofilevalue,events:events}]}delete this._map.webhookprofilevalue;delete this._map.webhookvisiteventsflag;delete this._map.webhookscaneventsflag;delete this._map.webhookactioneventsflag;delete this._map.webhookmessageeventsflag;delete this._map.webhookrceventsflag;localStorage.duxsoup_options=JSON.stringify(this.getUserValueMap())}},buildMap:function(){var rv=Object.assign({},this.defaultuserconfig);if(localStorage.duxsoup_options){try{var storeduserconfig=JSON.parse(localStorage.duxsoup_options);for(var key in storeduserconfig){rv[key]=storeduserconfig[key]}}catch(e){localStorage.removeItem("duxsoup_options")}}for(var key in this.defaultsystemconfig){rv[key]=this.defaultsystemconfig[key]}this._map=rv}};function ConfigWriter(configroot){configroot.setUserID=function(userid){this._map.userid=userid};configroot.setUserEmail=function(email){this._map.useremail=email};configroot.setClientID=function(clientid){this._map.clientid=clientid};configroot.setAffiliateLicense=function(key){this.setOption("affiliatelicense",{key:key})};configroot.getClientID=function(){if(this._map.clientid==null){this.setOption("clientid","xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)}))}return this._map.clientid};configroot.resetSpeed=function(){this.setOption("throttletime","1")};configroot.resetExpand=function(){this.setOption("expand",false)};configroot.resetWait=function(){this.setOption("waitminutes",2);this.setOption("waitvisits",10)};configroot.setConfigFeatures=function(features){this.setOption("features",features)};configroot.setEdition=function(edition){this.setOption("edition",edition)};configroot.setConfigQuota=function(quota){this.setOption("quota",quota)};configroot.setConfigProMode=function(promode){this.setOption("promode",promode)};configroot.setActiveUserAuthenticationType=function(authtype){this.setOption("activeuserauthenticationtype",authtype)};configroot.setUserAuthenticationType=function(authtype){this.setOptions({userauthenticationtype:authtype})};configroot.resetIn=function(){var totalms=msToDailyCutoff();var totals=Math.floor(totalms/1e3);var totalm=Math.floor(totals/60);var mins=totalm%60;var hours=Math.floor(totalm/60);return{hours:hours,minutes:mins,totalms:totalms}};configroot.plannedIn=function(when){var rv;if(!when){when=new Date}try{var foundslot=false;if(config.hasVisitingHours()){when.setMinutes(0);while(!foundslot){foundslot=config.isWorkingHour(when);if(!foundslot){when.setHours(when.getHours()+1)}else{var totalms=when.getTime()-(new Date).getTime();var totals=Math.floor(totalms/1e3);var totalm=Math.floor(totals/60);var mins=totalm%60;var hours=Math.floor(totalm/60);rv={hours:hours,minutes:mins,totalms:totalms}}}}else{rv={hours:99,minutes:99,totalms:6039e3}}}catch(e){log.error(e)}return rv};configroot.resetAndPlannedIn=function(){var now=new Date;var fromdate=new Date(now.getFullYear(),now.getMonth(),now.getDate()+1,0,0,0);return config.plannedIn(fromdate)};configroot.isWorkingHour=function(when){if(!when){when=new Date}var targethour=when.getHours();var targetday=when.getDay();return config.isWorkingSlot(targethour,targetday)};configroot.isWorkingSlot=function(hour,dayofweek){var schedule=config.getRobotSchedulePlan();var rv=false;for(var slot in schedule[dayofweek]){rv|=Number.parseInt(schedule[dayofweek][slot][0].split(":")[0])<=hour&&hour<Number.parseInt(schedule[dayofweek][slot][1].split(":")[0])}return rv};configroot.hasVisitingHours=function(hour,dayofweek){var schedule=config.getRobotSchedulePlan();return schedule[0].length>0||schedule[1].length>0||schedule[2].length>0||schedule[3].length>0||schedule[4].length>0||schedule[5].length>0||schedule[6].length>0};configroot.setOption=function(key,newvalue){var rv=false;if(key=="affiliatelicense"){var newkey=newvalue.key;var oldkey=this._map.affiliatelicense.key;var mustreload=!!newkey&&newkey!=oldkey;if(newkey!=oldkey){this._map.affiliatelicense.key=newvalue.key;rv=true;if(mustreload){setTimeout(function(){alert("Updating "+chrome.i18n.getMessage("appTitle")+" License");cx.reloadExtension()},1e3)}}}else{var oldvalue=this._map[key];if(JSON.stringify(newvalue)!=JSON.stringify(oldvalue)){this._map[key]=newvalue;if(key in config.defaultuserconfig){rv=true}}}return rv};configroot.setOptions=function(newoptions){var modified=false;for(var key in newoptions){modified|=this.setOption(key,newoptions[key])}if(modified){configroot.persistOptions(this.getUserID(),this.getUserValueMap())}return modified};configroot.getUserValueMap=function(){var rv={};for(var key in config.defaultuserconfig){rv[key]=this._map[key]}return rv};configroot.persistOptions=function(userid,map){if(!localStorage.other_duxsoup_options){localStorage.other_duxsoup_options=JSON.stringify({})}var others=JSON.parse(localStorage.other_duxsoup_options);others[userid]=map;localStorage.other_duxsoup_options=JSON.stringify(others);localStorage.duxsoup_options=JSON.stringify(map)}}var log={DEBUGLEVEL:0,INFOLEVEL:1,INTERACTIONLEVEL:2,WARNINGLEVEL:3,ERRORLEVEL:4,FATALLEVEL:5,SILENTLEVEL:99,CONSOLECHANNEL:"console",DBCHANNEL:"db",userid:"000000000000000",setUser:function(userid){this.userid=userid},debug:function(txt){this._logToChannel(this.userid,log.DEBUGLEVEL,txt)},info:function(txt){this._logToChannel(this.userid,log.INFOLEVEL,txt)},user:function(txt){this._logToChannel(this.userid,log.INTERACTIONLEVEL,txt)},warning:function(txt){this._logToChannel(this.userid,log.WARNINGLEVEL,txt)},data:function(obj,callback){db.writeLogData(this.userid,obj,callback)},error:function(err){this._logToChannel(this.userid,log.ERRORLEVEL,err.stack?err.stack:err)},fatal:function(err){this._logToChannel(this.userid,log.FATALLEVEL,err)},fromPageAgent:function(level,tab,message){this._logToChannel(this.userid,level,message,tab.id)},_logToChannel:function(user,level,message,tabid){if(tabid==null){tabid=0}var time=(new Date).toLocaleDateString()+" "+(new Date).toLocaleTimeString();try{if(level>=config.getLogLevel()){if(message!=null&&typeof message!="string"){message=JSON.stringify(message)}if(message!=null){if(message.stack==null){console.log(time+":"+tabid+":"+level+":"+message)}else{console.log(time+":"+tabid+":"+message.stack)}}if(config!=null&&config.getLogStack()){this._dumpStack(config.getLogStackFilter())}if(level==log.INTERACTIONLEVEL&&("db"==config.getLogChannels()||config.getLogChannels().indexOf("db")>-1)){if(message!=null){if(message.stack==null){db.writeLog(user,level,tabid,message)}else{db.writeLog(user,level,tabid,message.stack)}}}}}catch(e){console.log(e+" while logging:"+time+":"+level+":"+message)}},_dumpStack:function(filter){var stack=(new Error).stack;if(!filter||stack.indexOf(filter)>-1){console.log(stack)}}};function managedCSVDownload(filename,content){try{var csvdata=new File([content],filename,{type:"text/csv;charset=utf-8"});var url=window.URL.createObjectURL(csvdata);chrome.downloads.download({url:url,filename:filename,conflictAction:"uniquify"},function(itemid){chrome.downloads.search({id:itemid},function(f){console.log(f);URL.revokeObjectURL(url)})})}catch(e){log.error(e)}}function wrap(v){if(typeof v==="undefined"){v=""}return'"'+v.replace(/\"/g,"'")+'"'}function timestamp(date){var d=new Date;if(date!=null&&typeof date=="object"){d=date}else if(date!=null&&typeof date=="number"){d=new Date(date)}var dformat=[d.getFullYear(),(d.getMonth()+1).padLeft(),d.getDate().padLeft()].join("/")+" "+[d.getHours().padLeft(),d.getMinutes().padLeft(),d.getSeconds().padLeft()].join(":");return dformat}function timestampforfilename(date){var d=new Date;if(date!=null&&typeof date=="object"){d=date}else if(date!=null&&typeof date=="number"){d=new Date(date)}var dformat=[d.getFullYear(),(d.getMonth()+1).padLeft(),d.getDate().padLeft()].join("-")+" "+d.getHours().padLeft()+"h"+d.getMinutes().padLeft();return dformat}Number.prototype.padLeft=function(base,chr){var len=String(base||10).length-String(this).length+1;return len>0?new Array(len).join(chr||"0")+this:this};function msToDailyCutoff(){var now=new Date;var then=new Date(now.getFullYear(),now.getMonth(),now.getDate(),0,0,0);var msSinceMidnight=now.getTime()-then.getTime();var msToMidnight=24*60*60*1e3-msSinceMidnight;return msToMidnight}function sToDailyCutoff(){return Math.round(msToDailyCutoff()/1e3)}function dailyCutinTimestampMS(){var now=new Date;var then=new Date(now.getFullYear(),now.getMonth(),now.getDate(),0,0,0);return then.getTime()}function dailyCutoffTimestampMS(){return dailyCutinTimestampMS()+24*60*60*1e3}function DailyValueBander(deltaratio){this.apply=function(fixedvalue){this._refreshMultiplier();return Math.round(fixedvalue*this._multiplier)};this._init=function(deltaratio=.1){this._deltaratio=deltaratio;this._multiplier=this._deltaratio;this._multiplier*=(Math.random()-.5)*2;this._multiplier+=1;this._generatedAt=new Date};this._refreshMultiplier=function(){if(this._generatedAt.getDate()!=(new Date).getDate()){this._init(this._deltaratio)}};this._init(deltaratio)}DailyValueBander.D10=new DailyValueBander;var localdb=function(){var request=indexedDB.open("DuxSoupDB",6);request.onerror=function(event){log.error("Database error: "+event.target.errorCode);alert("Failed to create local cache, please free up some diskspace and hit reload at the bottom of the options panel.")};request.onupgradeneeded=function(event){var db=event.target.result;var visitstore,scanstore;if(db.objectStoreNames.contains("visitsbyuser")){visitstore=event.target.transaction.objectStore("visitsbyuser")}else{visitstore=db.createObjectStore("visitsbyuser",{keyPath:["userid","id"]})}if(db.objectStoreNames.contains("scansbyuser")){scanstore=event.target.transaction.objectStore("scansbyuser")}else{scanstore=db.createObjectStore("scansbyuser",{keyPath:["userid","id"]})}var indexNames=visitstore.indexNames;if(!indexNames.contains("visits")){visitstore.createIndex("visits",["userid","VisitTime"],{unique:false,multiEntry:false})}indexNames=scanstore.indexNames;if(!indexNames.contains("scans")){scanstore.createIndex("scans",["userid","ScanTime"],{unique:false,multiEntry:false})}};request.onsuccess=function(event){localdb.db=event.target.result};return{}}();localdb.cacheScan=function(key,data,tab){var storeme=JSON.parse(JSON.stringify(data));storeme["id"]=key;storeme["userid"]=config.getUserID();var tr=localdb.db.transaction("scansbyuser","readonly").objectStore("scansbyuser").get([config.getUserID(),key]);tr.onerror=function(event){log.error("Database error: "+event.target.errorCode)};tr.onsuccess=function(event){if(event.target.result!=null){log.info("overwriting previously cached scan with id "+event.target.result.id)}localdb.db.transaction("scansbyuser","readwrite").objectStore("scansbyuser").put(storeme).onerror=function(event){log.error("Database error: "+event.target.errorCode);if(tab!=null){cx.onTrackerFail(tab,event.target.errorCode)}}}};localdb.POSTmigrateData=function(){return localdb.POSTmigrateToMultiTenant().then(localdb.POSTmigrateScanData())};localdb.POSTmigrateScanData=function(){return new Promise(function(resolve,reject){var srcstore=localdb.db.transaction("visitsbyuser","readwrite").objectStore("visitsbyuser");if(srcstore.indexNames.contains("scans")){var src=srcstore.index("scans").openCursor();src.onsuccess=function(event){try{var cursor=event.target.result;if(cursor){var rec=cursor.value;var trg=localdb.db.transaction("scansbyuser","readwrite").objectStore("scansbyuser");trg.onsuccess=function(){};trg.onerror=function(event){console.log.error("Database error: "+event.target.errorCode)};trg.put(rec);cursor.delete();cursor.continue()}else{resolve(true)}}catch(e){console.log(e)}};src.onerror=function(event){var e=new Error("Database error: "+event.target.errorCode);log.error(e);reject(e)}}else{resolve(true)}})};localdb.POSTmigrateToMultiTenant=function(){return new Promise(function(resolve,reject){if(localdb.db.objectStoreNames.contains("uvisits")){var userid=config.getUserID();var src=localdb.db.transaction("uvisits","readwrite").objectStore("uvisits").openCursor();src.onsuccess=function(event){try{var cursor=event.target.result;if(cursor){var rec=cursor.value;rec["userid"]=userid;var trg=localdb.db.transaction("visitsbyuser","readwrite").objectStore("visitsbyuser");trg.onsuccess=function(){};trg.onerror=function(event){console.log.error("Database error: "+event.target.errorCode)};trg.put(rec);cursor.delete();cursor.continue()}else{resolve(true)}}catch(e){console.log(e)}};src.onerror=function(event){var e=new Error("Database error: "+event.target.errorCode);log.error(e);reject(e)}}else{resolve(true)}})};localdb.createOrUpdateVisit=function(key,data,tab){var storeme=JSON.parse(JSON.stringify(data));storeme["id"]=key;storeme["userid"]=config.getUserID();if(!!storeme["id"]){cx.tagservice.list(storeme["id"],function(tags){try{storeme["My Tags"]=tags.join("|")}catch(e){}localdb._createOrUpdateVisit(storeme)})}else{log.info("Cannot store visit without key.")}};localdb._createOrUpdateVisit=function(storeme){var range=IDBKeyRange.only([storeme["userid"],storeme["id"]]);var req=localdb.db.transaction("visitsbyuser","readwrite").objectStore("visitsbyuser").openCursor(range);req.onsuccess=function(event){var cursor=event.target.result;if(cursor){var rec=cursor.value;for(var key in storeme){if(storeme[key]!=null&&storeme[key]!=""){rec[key]=storeme[key]}}var updatereq=cursor.update(rec);updatereq.onerror=function(event){log.error("Database error: "+event.target.errorCode)}}else{localdb._addVisit(storeme)}}};localdb._addVisit=function(storeme){localdb.db.transaction("visitsbyuser","readwrite").objectStore("visitsbyuser").add(storeme).onerror=function(event){log.error("Database error: "+event.target.errorCode)}};localdb.listVisitedProfileIDs=function(callback){var qt=localdb._getQueryTarget("visit");var profileids={};var dataset=[];var req=qt.openCursor(IDBKeyRange.bound([config.getUserID(),0],[config.getUserID(),9999999999999]));req.onsuccess=function(event){var cursor=event.target.result;if(cursor){dataset.push(cursor.value);cursor.continue()}else{for(var entry in dataset){record=dataset[entry];profileids[record.id]=true}var arr=[];for(var key in profileids){if(profileids.hasOwnProperty(key)){arr.push(key)}}callback(arr)}};req.onerror=function(event){log.error("Database error: "+event.target.errorCode)}};localdb.clearData=function(){localdb.db.transaction("visitsbyuser","readwrite").objectStore("visitsbyuser").delete(IDBKeyRange.bound([config.getUserID(),""],[config.getUserID(),"zzzzzzzzzzzzzzzzzzzzz"])).onsuccess=function(event){};localdb.db.transaction("scansbyuser","readwrite").objectStore("scansbyuser").delete(IDBKeyRange.bound([config.getUserID(),""],[config.getUserID(),"zzzzzzzzzzzzzzzzzzzzz"])).onsuccess=function(event){}};localdb.countData=function(mode,sendResponse){localdb._countAndAggregateData(mode,{},sendResponse)};localdb.exportData=function(mode,includeextended,callback){var qt=localdb._getQueryTarget(mode);var dataset=[];var metarecord={};var req=qt.openCursor(IDBKeyRange.bound([config.getUserID(),0],[config.getUserID(),9999999999999]));req.onsuccess=function(event){var cursor=event.target.result;if(cursor){var record=cursor.value;delete record.userid;dataset.push(record);localdb._addStandardPropsToMeta(record,metarecord);cursor.continue()}else{var csvContent="";var csvsep=config.getCSVSeparator();var extendedfields={};if(includeextended){localdb._addExtendedPropsToMeta(dataset,metarecord)}for(var entry in dataset){var record=dataset[entry];for(var propt in metarecord){try{var value=record[propt]?record[propt]:" ";if(propt=="VisitTime"||propt=="ScanTime"){value=timestamp(value)}if(propt=="My Tags"){value=cx.tagservice._getCache(record["id"]).join("|")}if(propt=="extended"){}else{if(!isHiddenData(propt)){csvContent+=wrap(value).replace(/[\n\r]+/g," ")+csvsep}}}catch(e){csvContent+=" "+csvsep}}try{csvContent+=wrap(cx.notesservice._getCached(record["id"])).replace(/[\n\r]+/g," ")+csvsep}catch(e){csvContent+=wrap("-")+csvsep}for(var propt in metarecord.extended){try{var value=localdb._getExtendedRecordAttributeValue(record,propt);csvContent+=wrap(value).replace(/[\n\r]+/g," ")+csvsep}catch(e){csvContent+=" "+csvsep}}csvContent+="\n"}callback(csvContent,metarecord)}};req.onerror=function(event){log.error("Database error: "+event.target.errorCode)}};localdb._getQueryTarget=function(mode){var idx,storename;var rv;if(mode=="scan"){idx="scans";storename="scansbyuser"}else if(mode=="visit"){idx="visits";storename="visitsbyuser"}else if(mode!=null){log.error("Unknown mode when quering localdb:"+mode);throw"Unknown mode when quering localdb:"+mode}rv=localdb.db.transaction(storename,"readonly").objectStore(storename).index(idx);return rv};localdb._countWithTarget=function(qt,callback){var req;if(qt.name=="visitsbyuser"){req=qt.count(IDBKeyRange.bound([config.getUserID(),""],[config.getUserID(),"zzzzzzzzzzzzzzzzzzzzz"]))}else{req=qt.count(IDBKeyRange.bound([config.getUserID(),0],[config.getUserID(),9999999999999]))}req.onsuccess=function(event){callback(event.target.result)};req.onerror=function(event){log.error("Database error: "+event.target.errorCode)}};localdb._countAndAggregateData=function(mode,aggregateresult,sendResponse){if(Array.isArray(mode)){if(mode.length>0){var nextmode=mode.pop();localdb._countAndAggregateData(nextmode,null,function(result){aggregateresult[nextmode]=result;localdb._countAndAggregateData(mode,aggregateresult,sendResponse)})}else{sendResponse(aggregateresult)}}else{var qt=localdb._getQueryTarget(mode);localdb._countWithTarget(qt,sendResponse)}};localdb._addStandardPropsToMeta=function(record,metarecord){try{for(var propt in record){if(!isHiddenData(propt)){metarecord[propt]=true}}}catch(e){log.error(e)}};localdb._addExtendedPropsToMeta=function(dataset,metarecord){try{if(metarecord.extended){metarecord.extended={};var maxpositions=0;var maxskills=0;var maxschools=0;var positionattributes={};var skillattributes={};var schoolattributes={};for(var entry in dataset){var record=dataset[entry];if(record.extended!=null){if(record.extended.positions){if(record.extended.positions.length>maxpositions){maxpositions=record.extended.positions.length}for(var i in record.extended.positions){for(var att in record.extended.positions[i]){positionattributes[att]=true}}}if(record.extended.skills){if(record.extended.skills.length>maxskills){maxskills=record.extended.skills.length}}if(record.extended.schools){if(record.extended.schools.length>maxschools){maxschools=record.extended.schools.length}for(var i in record.extended.schools){for(var att in record.extended.schools[i]){schoolattributes[att]=true}}}}}for(var i=0;i<maxskills;i++){metarecord.extended["Skill-"+i]=true}for(var i=0;i<maxpositions;i++){for(var att in positionattributes){metarecord.extended["Position-"+i+"-"+att]=true}}for(var i=0;i<maxschools;i++){for(var att in schoolattributes){metarecord.extended["School-"+i+"-"+att]=true}}}else{metarecord.extended={}}}catch(e){log.error(e)}};localdb._getExtendedRecordAttributeValue=function(record,attribute){var rv=null;try{if(record.extended!=null){var att=attribute.split("-");for(var i=0;i<att.length;i++){if(att[i]=="School"){rv=record.extended.schools}else if(att[i]=="Skill"){rv=record.extended.skills}else if(att[i]=="Position"){rv=record.extended.positions}else{rv=rv!=null?rv[att[i]]:null}}}}catch(e){log.error(e)}return rv!=null?rv:""};function isHiddenData(propt){return["publicprofile_id","profileUrl","publicIdentifier","Thumbnail","html","IsPremium","IsOpenlink","IsJobseeker","IsCrmImported","SharedConnections","Distance","IsInfluencer"].indexOf(propt)>-1}function HistoryPushForwarder(push){History.prototype.pushState=function(state,title,location){var event=new CustomEvent("lipush",{detail:location});document.dispatchEvent(event);push.call(this,state,title,location)}}function XHRForwarder(open,mode){if(window.innerWidth<1200){window.innerWidth=1200}if(window.innerHeight<7500){window.innerHeight=7500}if(!XMLHttpRequest.prototype.open.replaced){if(mode)console.log("XHR not yet forwarding");window.requestAnimationFrame=function(callback){setTimeout(function(){callback()},100)};document.addEventListener("lishell",function(event){var rv=null;try{rv=eval(event.detail.cmd)}catch(e){rv=e}var responsemessage=null;try{responsemessage={id:event.detail.id,rv:typeof rv=="object"?JSON.stringify(rv):rv,type:typeof rv}}catch(e){responsemessage={id:event.detail.id,rv:""+rv,type:"string"}}document.dispatchEvent(new CustomEvent("lishellrv",{detail:responsemessage}))});XMLHttpRequest.prototype.open=function(method,url,async,user,pass){this.addEventListener("readystatechange",function(){if(this.readyState==4){var resp={};try{resp.data=this.response;resp.type=this.responseType;resp.url=this.responseURL;if(typeof resp.url!="undefined"&&(resp.url.indexOf("www.linkedin.com/connected/api/v1/contacts")>-1||resp.url.indexOf("www.linkedin.com/connected/api/v2/contacts")>-1||resp.url.indexOf("www.linkedin.com/communities-api/v1/memberships/community")>-1||resp.url.indexOf("www.linkedin.com/sales/search/results")>-1||resp.url.indexOf("www.linkedin.com/sales/profile/")>-1||resp.url.indexOf("www.linkedin.com/sales-api/salesApiProfiles")>-1||resp.url.indexOf("www.linkedin.com/sales-api/salesApiPeopleSearch")>-1||resp.url.indexOf("www.linkedin.com/recruiter/api/smartsearch")>-1||resp.url.indexOf("www.linkedin.com/voyager/api/")>-1)){var event=new CustomEvent("lixhr",{detail:resp});if(XMLHttpRequest.prototype.open.mode)console.log("XHR forwarding "+this.responseURL);document.dispatchEvent(event)}else{if(XMLHttpRequest.prototype.open.mode)console.log("XHR not forwarding "+this.responseURL);if(XMLHttpRequest.prototype.open.mode)console.log("XHR maybe try  "+url)}}catch(e){if(XMLHttpRequest.prototype.open.mode)console.log("XHR error, not forwarding");if(XMLHttpRequest.prototype.open.mode)console.log(e)}}},false);open.call(this,method,url,async,user,pass)};XMLHttpRequest.prototype.open.replaced=true}else{if(mode)console.log("XHR already forwarding");XMLHttpRequest.prototype.open.mode=mode}}function getXHRForwarder(){var rv=null;if(typeof config!="undefined"){var debugmode=!!config&&!!config.getMode&&config.getMode()=="development";rv="("+XHRForwarder+")(XMLHttpRequest.prototype.open, "+debugmode+");"}return rv}function injectXHRForwarder(){document.location.href="javascript:"+getXHRForwarder()}function injectPushForwarder(){document.location.href="javascript:("+HistoryPushForwarder+")(History.prototype.pushState);"}function injectForwarders(){document.location.href="javascript:("+XHRForwarder+")(XMLHttpRequest.prototype.open);("+HistoryPushForwarder+")(History.prototype.pushState);"}function sendAPICall(method,url,params,trycount){var xhr=new XMLHttpRequest;if(!trycount)trycount=0;xhr.open(method,url,true);var paramstring;if(params){paramstring="";for(var p in params){paramstring+=p+"="+encodeURIComponent(params[p])+"&"}}xhr.send(paramstring)}function injectSendAPICall(){document.location.href="javascript:("+sendAPICall+")()"}function EMBEDForwarder(){var FSEMBEDDED=false;document.addEventListener("DOMSubtreeModified",function(){if(typeof fs!="undefined"&&typeof fs.embed!="undefined"&&!FSEMBEDDED){FSEMBEDDED=true;var o=fs.embed;console.log("GOT IT!");fs.embed=function(p1,p2){console.log("RUN IT!");try{var v=document.querySelector("#voltron_srp_main-content").innerHTML;var event=new CustomEvent("liembed",{detail:v.substring(4,v.length-3)});document.dispatchEvent(event)}catch(e){}o(p1,p2)}}})}function injectEMBEDForwarder(){document.location.href="javascript:("+EMBEDForwarder+")()"}function DuxEventsTopic(){this._listeners=[];this.subscribe=function(lsnr){if(!this._listeners.includes(lsnr)){this._listeners.push(lsnr)}};this.unsubscribe=function(lsnr){var idx=this._listeners.indexOf(lsnr);if(idx>-1){this._listeners.splice(idx,1)}};this.publish=function(event){this._listeners.forEach(function(lsnr){try{lsnr.on(event)}catch(e){log.error(e)}})}}function EventSource(){this.addListener=function(target){this._topic.subscribe(target)};this.removeListener=function(target){this._topic.unsubscribe(target)};this._topic=new DuxEventsTopic}var VisitEventSource=new EventSource;VisitEventSource.onCreate=function(visitdata){if(this._topic){cx.notesservice.POSTload(visitdata.id).then(function(notes){visitdata["My Notes"]=notes;return cx.tagservice.POSTlist(visitdata.id)}).then(function(tags){visitdata["My Tags"]=tags;var visitevent={userid:config.getUserID(),time:(new Date).toISOString(),type:"visit",event:"create",data:visitdata};VisitEventSource._topic.publish(visitevent)})}};VisitEventSource.onUpdate=function(visitdata){if(this._topic){cx.notesservice.POSTload(visitdata.id).then(function(notes){visitdata["My Notes"]=notes;return cx.tagservice.POSTlist(visitdata.id)}).then(function(tags){visitdata["My Tags"]=tags;var visitevent={userid:config.getUserID(),time:(new Date).toISOString(),type:"visit",event:"update",data:visitdata};VisitEventSource._topic.publish(visitevent)})}};var ScanEventSource=new EventSource;ScanEventSource.onCreate=function(scandata){if(this._topic){var scanevent={userid:config.getUserID(),time:(new Date).toISOString(),type:"scan",event:"create",data:scandata};this._topic.publish(scanevent)}};var ActionEventSource=new EventSource;ActionEventSource.onCreate=function(actiondata,successflag,returnvalue){if(this._topic){var eventdata=JSON.parse(JSON.stringify(actiondata));eventdata.successflag=successflag;eventdata.returnvalue=returnvalue;var actionevent={userid:config.getUserID(),time:(new Date).toISOString(),type:"action",event:"completed",data:eventdata};this._topic.publish(actionevent)}};var MessageEventSource=new EventSource;MessageEventSource.onReceived=function(messagedata){if(this._topic){var messageevent={userid:config.getUserID(),time:(new Date).toISOString(),type:"message",event:"received",data:messagedata};this._topic.publish(messageevent)}};MessageEventSource.onSent=function(messagedata){if(this._topic){var messageevent={userid:config.getUserID(),time:(new Date).toISOString(),type:"message",event:"sent",data:messagedata};this._topic.publish(messageevent)}};var RCCommandEventSource=new EventSource;RCCommandEventSource.onCreate=function(commanddata){if(this._topic){var eventdata={id:commanddata.messageid,command:commanddata.command,params:commanddata.params};var rccommandevent={userid:config.getUserID(),time:(new Date).toISOString(),type:"rccommand",event:"received",data:eventdata};this._topic.publish(rccommandevent)}};RCCommandEventSource.onSuccess=function(commanddata,resultdata){if(this._topic){var eventdata={id:commanddata.messageid,command:commanddata.command,params:commanddata.params,result:resultdata};var rccommandevent={userid:config.getUserID(),time:(new Date).toISOString(),type:"rccommand",event:"completed",data:eventdata};this._topic.publish(rccommandevent)}};RCCommandEventSource.onFail=function(commanddata,errordata){if(this._topic){var eventdata={id:commanddata.messageid,command:commanddata.command,params:commanddata.params,error:errordata};var rccommandevent={userid:config.getUserID(),time:(new Date).toISOString(),type:"rccommand",event:"error",data:eventdata};this._topic.publish(rccommandevent)}};RCCommandEventSource.onIgnore=function(commanddata,reason){if(this._topic){var eventdata={id:commanddata.messageid,command:commanddata.command,params:commanddata.params,reason:reason};var rccommandevent={userid:config.getUserID(),time:(new Date).toISOString(),type:"rccommand",event:"ignore",data:eventdata};this._topic.publish(rccommandevent)}};RCCommandEventSource.onSnooze=function(commanddata){if(this._topic){var eventdata={reason:commanddata.reason,time:commanddata.time};var rccommandevent={userid:config.getUserID(),time:(new Date).toISOString(),type:"rccommand",event:"snooze",data:eventdata};this._topic.publish(rccommandevent)}};var VisitWebhook={on:function(visitevent){config.getWebhooks().forEach(function(webhook){try{if(testWebhookConfig(webhook,"visit")){db.sendHTTPRequest("POST",webhook.url,visitevent,null,3,[["Accept","application/json"],["Content-Type","application/json"]])}}catch(e){log.error(e)}})}};VisitEventSource.addListener(VisitWebhook);var ScanWebhook={on:function(scanevent){config.getWebhooks().forEach(function(webhook){try{if(testWebhookConfig(webhook,"scan")){db.sendHTTPRequest("POST",webhook.url,scanevent,null,3,[["Accept","application/json"],["Content-Type","application/json"]])}}catch(e){log.error(e)}})}};ScanEventSource.addListener(ScanWebhook);var ActionWebhook={on:function(actionevent){config.getWebhooks().forEach(function(webhook){try{if(testWebhookConfig(webhook,"action")){db.sendHTTPRequest("POST",webhook.url,actionevent,null,3,[["Accept","application/json"],["Content-Type","application/json"]])}}catch(e){log.error(e)}})}};ActionEventSource.addListener(ActionWebhook);var MessageWebhook={on:function(messageevent){config.getWebhooks().forEach(function(webhook){try{if(testWebhookConfig(webhook,"message")){db.sendHTTPRequest("POST",webhook.url,messageevent,null,3,[["Accept","application/json"],["Content-Type","application/json"]])}}catch(e){log.error(e)}})}};MessageEventSource.addListener(MessageWebhook);var RCCommandWebhook={on:function(commandevent){config.getWebhooks().forEach(function(webhook){try{if(testWebhookConfig(webhook,"rc")){db.sendHTTPRequest("POST",webhook.url,commandevent,null,3,[["Accept","application/json"],["Content-Type","application/json"]])}}catch(e){log.error(e)}})}};RCCommandEventSource.addListener(RCCommandWebhook);function testWebhookConfig(webhook,testevent){let rv=config.getWebhookProfileFlag();try{if(rv){rv=!!webhook.url&&webhook.url.match(/^https{0,1}:\/\//i)&&new URL(webhook.url)!=null;rv&=webhook.events.indexOf(testevent)>-1}}catch(e){log.error(e);rv=false}return rv}var MAXDBTRY=2;var db={_visitsurl:"/api/{user}/visits",_notesurl:"/api/{user}/notes",_actionsurl:"/api/{user}/actions",_actionhistoryurl:"/api/{user}/actions/{window}",_remotecontrolqueueurl:"/api/{user}/control/queue",_tagsurl:"/api/{user}/tags",_loadtagsurl:"/api/{user}/loadtags",_taglisturl:"/api/{user}/taglist",_tagstatsurl:"/api/{user}/tags/stats",_cacheurl:"/api/{user}/cache/{window}",_visitcountsinceurl:"/api/{user}/countcache/{from}",_checkcacheurl:"/api/{user}/checkcache/{profileid}/{window}",_chunked31daycacheurl:"/api/{user}/cache/31d/{chunk}",_profileurl:"/api/{user}/profiles",_logurl:"/api/{user}/log",_pointsledgerupdateurl:"/api/{user}/pointsledger/updatepurchases",_pointsledgerbalanceurl:"/api/{user}/pointsledger/balance",_contributionurl:"/api/{user}/{owner}/contributions",_activationsurl:"/api/{user}/externallicense/activations/{activationid}",_cwslicenseurl:"/api/{user}/cwslicense/{label}",_externallicenseurl:"/api/{user}/externallicense/{licensekey}",_oauth2tokeninfourl:"https://www.googleapis.com/oauth2/v1/tokeninfo",_googleprofileurl:"/api/currentuser/googleprofile",_bootstrapurl:"/api/{label}/{user}/bootstrap",createVisit:function(user,visitorname,quotaid,data,lookupmail,callback){var datacopy=Object.assign({},data);delete datacopy.VisitTime;var params={visitorname:visitorname,quotaid:quotaid,lookupmail:lookupmail,data:JSON.stringify(datacopy)};var url=config.getBaseApp()+this._visitsurl.replace("{user}",user);var method="POST";db.sendHTTPRequest(method,url,params,callback)},updateVisit:function(user,visitorname,quotaid,data){var params={visitorname:visitorname,quotaid:quotaid,data:JSON.stringify(data)};var url=config.getBaseApp()+this._visitsurl.replace("{user}",user);var method="PUT";db.sendHTTPRequest(method,url,params)},saveNote:function(userid,profileid,data){var params={profileid:profileid,data:JSON.stringify(data)};var url=config.getBaseApp()+this._notesurl.replace("{user}",userid);var method="POST";db.sendHTTPRequest(method,url,params)},recordAction:function(userid,profileid,actiondata,returnvalue,successflag){var params={profileid:profileid,successflag:successflag,data:JSON.stringify(actiondata)};if(returnvalue!=null){params.returnvalue=returnvalue}var url=config.getBaseApp()+this._actionsurl.replace("{user}",userid);var method="POST";db.sendHTTPRequest(method,url,params)},getActionHistory:function(user,timewindow,callback){var url=config.getBaseApp()+this._actionhistoryurl.replace("{user}",user).replace("{window}",timewindow);var method="GET";db.sendHTTPRequest(method,url,null,callback)},scheduleRCCommand(userid,command,commandparams,when,callback){var params={command:command,params:commandparams};if(!!when){params.when=when.toISOString()}var url=config.getBaseApp()+this._remotecontrolqueueurl.replace("{user}",userid);var method="POST";db.sendHTTPRequest(method,url,params,callback,3,[["Accept","application/json"],["Content-Type","application/json"]])},createTag:function(userid,profileid,data,callback){var params={profileid:profileid,data:JSON.stringify(data)};var url=config.getBaseApp()+this._tagsurl.replace("{user}",userid);var method="POST";db.sendHTTPRequest(method,url,params,callback)},writeLog:function(userid,level,tabid,data){var params={message:JSON.stringify(data),level:level,tabid:tabid};var url=config.getBaseApp()+this._logurl.replace("{user}",userid);var method="POST";db.sendHTTPRequest(method,url,params,null,MAXDBTRY)},writeLogData:function(userid,data,callback){var params={data:LZString.compressToBase64(JSON.stringify(data))};var url=config.getBaseApp()+this._logurl.replace("{user}",userid);var method="POST";db.sendHTTPRequest(method,url,params,function(res){if(callback!=null){callback({response:LZString.decompressFromBase64(res.response)})}})},sendContributions:function(userid,ownerid,data,callback){var params={data:JSON.stringify(data)};var url=config.getBaseApp()+this._contributionurl.replace("{user}",userid).replace("{owner}",ownerid);var method="POST";db.sendHTTPRequest(method,url,params,callback)},getCache:function(user,timewindow,callback){var url=config.getBaseApp()+this._cacheurl.replace("{user}",user).replace("{window}",timewindow);var method="GET";db.sendHTTPRequest(method,url,null,callback)},getVisitCountSince:function(user,from,callback){var url=config.getBaseApp()+this._visitcountsinceurl.replace("{user}",user).replace("{from}",from);var method="GET";db.sendHTTPRequest(method,url,null,callback)},checkCache:function(user,profileid,timewindow,callback){var url=config.getBaseApp()+this._checkcacheurl.replace("{user}",user).replace("{window}",timewindow).replace("{profileid}",profileid);var method="GET";db.sendHTTPRequest(method,url,null,callback)},get31DayCacheChunked:function(user,chunk,callback){var timewindow="31d";var url=config.getBaseApp()+this._chunked31daycacheurl.replace("{user}",user).replace("{chunk}",chunk);var method="GET";db.sendHTTPRequest(method,url,null,callback)},getNotes:function(userid,profileid,callback){var url=config.getBaseApp()+this._notesurl.replace("{user}",userid);if(!!profileid){url+="?profileid="+profileid}var method="GET";db.sendHTTPRequest(method,url,null,callback)},getTags:function(userid,profileid,callback){var url=config.getBaseApp()+this._tagsurl.replace("{user}",userid);var params={};if(profileid!=null){if(typeof profileid=="string"){params.profileid=profileid}else{params.profileids=profileid}}var method="GET";db.sendHTTPRequest(method,url,params,callback)},loadTags:function(userid,profileids,callback){var url=config.getBaseApp()+this._loadtagsurl.replace("{user}",userid);var params={};if(profileids!=null){params.profileids=profileids}var method="POST";db.sendHTTPRequest(method,url,params,callback)},getTaglist:function(userid,callback){var url=config.getBaseApp()+this._taglisturl.replace("{user}",userid);var method="GET";db.sendHTTPRequest(method,url,null,callback)},tagStats:function(userid,callback){var url=config.getBaseApp()+this._tagstatsurl.replace("{user}",userid);var method="GET";db.sendHTTPRequest(method,url,null,callback)},removeTag:function(userid,profileid,data){var params={profileid:profileid,data:JSON.stringify(data)};var url=config.getBaseApp()+this._tagsurl.replace("{user}",userid);var method="DELETE";db.sendHTTPRequest(method,url,params)},getTaggedProfiles:function(userid,searchtype,tags,xtags,pagenumber,callback){if(typeof tags=="string"){tags=[tags]}var params={searchtype:searchtype,tags:JSON.stringify(tags),xtags:JSON.stringify(xtags),pagenumber:pagenumber};var url=config.getBaseApp()+this._profileurl.replace("{user}",userid);var method="GET";db.sendHTTPRequest(method,url,params,callback)},updatePointsLedger:function(userid,callback){var url=config.getBaseApp()+this._pointsledgerupdateurl.replace("{user}",userid);var method="POST";db.sendHTTPRequest(method,url,null,callback)},getPointsBalance:function(userid,callback){var url=config.getBaseApp()+this._pointsledgerbalanceurl.replace("{user}",userid);var method="GET";db.sendHTTPRequest(method,url,null,callback)},processContributions:function(userid,ownerid,data,callback){var params={data:LZString.compressToBase64(JSON.stringify(data))};var url=config.getBaseApp()+this._logurl.replace("{user}",userid);var method="POST";db.sendHTTPRequest(method,url,params,function(res){if(callback!=null){callback({response:LZString.decompressFromBase64(res.response)})}})},getActivations:function(user,callback){var url=config.getBaseApp()+this._activationsurl.replace("{user}",user).replace("{activationid}","");var method="GET";db.sendHTTPRequest(method,url,null,callback)},getCWSLicense:function(userid,label,callback){var url=config.getBaseApp()+this._cwslicenseurl.replace("{user}",userid).replace("{label}",label);var method="GET";db.sendHTTPRequest(method,url,null,callback)},getExternalLicense:function(userid,licensekey,callback){var url=config.getBaseApp()+this._externallicenseurl.replace("{user}",userid).replace("{licensekey}",licensekey);var method="GET";db.sendHTTPRequest(method,url,null,callback)},removeActivation:function(userid,activationid){var url=config.getBaseApp()+this._activationsurl.replace("{user}",userid).replace("{activationid}",activationid);var method="DELETE";db.sendHTTPRequest(method,url)},getOAuth2TokenInfo:function(token,callback){var url=this._oauth2tokeninfourl;var method="GET";var params={access_token:token};db.sendHTTPRequest(method,url,params,callback)},getGoogleProfile:function(callback){var url=config.getBaseApp()+this._googleprofileurl;var method="GET";db.sendHTTPRequest(method,url,null,callback)},bootstrapClient:function(labelid,userid,version,lelicensekey,callback){var url=config.getBaseApp()+this._bootstrapurl.replace("{label}",labelid).replace("{user}",userid);var params={userid:userid,version:version,lelicensekey:lelicensekey};if(cx.usersession.isOAuth2()){params["oauth2token"]=cx.usersession.getToken()}var method="GET";db.sendHTTPRequest(method,url,params,callback)},sendHTTPRequest:function(method,url,params,callback,trycount,customheaders){var xhr=new XMLHttpRequest;if(!trycount)trycount=0;xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var resp=xhr.responseText;try{if(callback!=null){callback(JSON.parse(resp))}}catch(e){log.warning("Failed to return DB result:"+e)}}else if(xhr.readyState==4&&xhr.status==403){if(callback){callback(null,{code:xhr.status,text:xhr.responseText})}}else if(xhr.readyState==4){log.warning("Error while accessing DB:("+xhr.status+")"+xhr.responseText);HostSelector.requestFailed(url,xhr);if(trycount<MAXDBTRY){log.warning("Retrying HTTP request");db.sendHTTPRequest(method,url,params,callback,trycount+1)}else{if(callback){log.warning("HTTP request failed after max retry, invoking callback.");callback(null,{code:xhr.status,text:xhr.responseText})}else{log.warning("HTTP request failed after max retry, no callback to invoke.")}}}};var cid=config.getClientID();var headers={};if(!!customheaders){customheaders.forEach(nvp=>{db.addHeader(nvp,headers)})}if(url.indexOf(config.getBaseApp())!=-1&&!headers["Authorization"]&&cx.usersession.getToken()){if(cx.usersession.isOAuth2()){db.addHeader(["Authorization","Bearer "+cx.usersession.getToken()],headers)}else if(cx.usersession.isWebSession()){db.addHeader(["Authorization","Duxfood "+cx.usersession.getToken()],headers)}}db.addHeader(["Content-Type","application/x-www-form-urlencoded;charset=UTF-8"],headers);var req=db.encodeRequest(url,method,headers,params);xhr.open(req.method,req.url,true);for(var hdr in req.headers){xhr.setRequestHeader(hdr,req.headers[hdr])}xhr.send(req.body)},addHeader:function(newheader,headers,override){var rv=false;if(!headers[newheader[0]]||!!override){headers[newheader[0]]=newheader[1];rv=true}return rv},encodeRequest:function(url,method,headers,params){var rv={headers:headers,method:method,url:url,body:null};if(headers["Content-Type"].indexOf("json")>-1){rv.body=!!params?JSON.stringify(params):"{}"}else{var paramstring;if(params){paramstring="";for(var p in params){paramstring+=p+"="+encodeURIComponent(params[p])+"&"}}if((method=="GET"||method=="DELETE")&&!!paramstring){if(rv.url.indexOf("?")>-1){rv.url+="&"+paramstring}else{rv.url+="?"+paramstring}}else{rv.body=paramstring}}return rv},getCallback:function(success,failure){return function(response,error){if(error==null){success(response)}else{failure(error)}}}};var ExpiringMap=function(initObject){this._objectContainer={};this._defaultTimeout=60;this.init(initObject)};ExpiringMap.prototype.init=function(initObject){if(initObject&&typeof initObject.defaultTimeout!="undefined"){this._defaultTimeout=initObject.defaultTimeout}};ExpiringMap.prototype.put=function(name,objectToStore,timeout,callback){if(this.isKeyActive(name)===false){var objectTimeout=this._defaultTimeout;var created=Date.now();if(typeof timeout!="undefined"){objectTimeout=timeout}var endTime=created+objectTimeout*1e3;this._objectContainer[name]={content:objectToStore,createdTimestamp:created,modifiedTimestamp:created,timeout:objectTimeout,callback:callback,endTime:endTime};return true}else{return false}};ExpiringMap.prototype.putWithZulu=function(name,objectToStore,timestamp,endtime){var currentvalue=this.getWithMetadata(name);if(endtime==null){endtime=timestamp+this._defaultTimeout*1e3}if(!currentvalue||currentvalue.endTime<endtime){this.put(name,objectToStore);this._objectContainer[name].content=objectToStore;this._objectContainer[name].createdTimestamp=timestamp;this._objectContainer[name].modifiedTimestamp=Date.now();this._objectContainer[name].endTime=endtime}else{log.info("skipped:"+new Date(currentvalue.endTime)+" >= "+new Date(endtime))}};ExpiringMap.prototype.putOrUpdate=function(name,objectToStore,timeout,callback){if(this.isKeyActive(name)){var currentTimestamp=Date.now();this._objectContainer[name].content=objectToStore;this._objectContainer[name].createdTimestamp=currentTimestamp;this._objectContainer[name].modifiedTimestamp=currentTimestamp;this._objectContainer[name].endTime=currentTimestamp+this._objectContainer[name].timeout*1e3}else{return this.put(name,objectToStore,timeout,callback)}};ExpiringMap.prototype.get=function(name){if(this.isKeyActive(name,true)){return this._objectContainer[name].content}else{return false}};ExpiringMap.prototype.getWithMetadata=function(name){if(this.isKeyActive(name,true)){return this._objectContainer[name]}else{return false}};ExpiringMap.prototype.putWithMetadata=function(name,object){this._objectContainer[name]={content:object.objectToStore,createdTimestamp:object.created,modifiedTimestamp:object.created,timeout:object.objectTimeout,callback:object.callback,endTime:object.endTime}};ExpiringMap.prototype.isKeyActive=function(name,modify){if(typeof this._objectContainer[name]!="undefined"){var obj=this._objectContainer[name];var time=Date.now();if(time<=obj.endTime){if(typeof modify!="undefined"&&modify===true){obj.modifiedTimestamp=time}return true}else{if(typeof obj.callback!="undefined"){obj.callback(name,obj.content)}delete this._objectContainer[name];return false}}else{return false}};ExpiringMap.prototype.getAccessed=function(key){if(this.isKeyActive(key)){return this._objectContainer[key].modifiedTimestamp}};ExpiringMap.prototype.getKeyList=function(){var list=[];for(var key in this._objectContainer){if(this.isKeyActive(key)){list.push(key)}}return list};ExpiringMap.prototype.toMap=function(){var rv={};var keys=this.getKeyList();for(var key in keys){rv[key]=this.get(key)}return rv};ExpiringMap.prototype.getInfo=function(key){if(this.isKeyActive(key)){var obj=this._objectContainer[key];return{expired:false,info:{createdTimestamp:obj.createdTimestamp,modifiedTimestamp:obj.modifiedTimestamp,timeout:obj.timeout,endTime:obj.endTime}}}else{return{expired:true,info:null}}};ExpiringMap.prototype.containsKey=function(key){return this.isKeyActive(key)};ExpiringMap.prototype.remove=function(key){if(this.isKeyActive(key)){delete this._objectContainer[key];return true}else{return false}};ExpiringMap.prototype.dumpData=function(){var out="";for(var key in this._objectContainer){out+='{"key":"'+key+'","created":'+this._objectContainer[key].createdTimestamp+', "data":'+JSON.stringify(this._objectContainer[key].content)+"}\n"}return out};var exports=exports||{};exports.ExpiringMap=ExpiringMap;function AutoBotRemote(){this._isconnected=false;this._isexecuting=false;this._snoozetill=Date.now();this.stop=function(){this._ensureSocket();this._socket.disconnect()};this.snooze=function(t=60,reason=""){this._snoozetill=t*1e3+Date.now();cx.rcaudittrailservice.recordSnooze({time:t*1e3,reason:reason})};this.shouldBeSnoozing=function(){return Date.now()<this._snoozetill};this.send=function(eventtype,eventvalue){this._ensureSocket();this._socket.emit(eventtype,eventvalue)};this.ready=function(){this._ensureSocket();this._isexecuting=false;this._socket.emit("ready",this.newMessage(),function(res1,res2){console.log(res1,res2)})};this.isActive=function(){return this._isconnected};this.canRunCommand=function(commanddata){var run=false;var snooze=false;var reason="incorrect user";if(commanddata.userid==config.getUserID()){run=true;reason="";var quotaid="PlusProfile";var snoozeenabled=config.getSnooze();var robotpaused=config.getPauseRobot();var visittracker=cx.visitfactory.get(cx.userid);var isvisitinghour=visittracker.isWorkingHour();var visitlimitreached=visittracker.dailyQuotaReached(quotaid);var invitelimitreached=cx.actionservice.dailyInviteQuotaReached();var messagelimitreached=cx.actionservice.dailyMessageQuotaReached();if(robotpaused){snooze=true;reason="paused"}if(!isvisitinghour){snooze=true;reason="planner"}if(visitlimitreached&&["visit","connect","message"].indexOf(commanddata.command)>-1){snooze=true;reason="visit-limit"}if(invitelimitreached&&["connect"].indexOf(commanddata.command)>-1){snooze=true;reason="connect-limit"}if(messagelimitreached&&["message"].indexOf(commanddata.command)>-1){snooze=true;reason="message-limit"}}return{canrun:run&&!snooze,reason:reason}};this.runCommand=function(data){if(data.userid!=config.getUserID()){log.error("Userid in command does not match the current user.");this.ready()}else if(!!data.messageid&&data.messageid==this.lastmessageid){log.error("Messageid has already been handled.");this.ready()}else{this.lastmessageid=data.messageid;let arc=this;cx.rcaudittrailservice.recordStart(data);chrome.tabs.create({active:false},function(tab){var bot=AutoBotFactory.makeRCBot(tab,cx);bot.POSTrunCommand(data.command,data.params).then(function(rv){setTimeout(()=>{chrome.tabs.remove(bot._tab.id)},3e3);return rv}).then(function(result){if(!!result&&result.ignored){cx.rcaudittrailservice.recordIgnore(data,result.reason)}else{cx.rcaudittrailservice.recordSuccess(data,result)}}).catch(function(error){cx.rcaudittrailservice.recordFailure(data,error)}).finally(function(){let snoozetime=cx.getThrottleWaittime()+cx.getThrottleDelaytime();cx.rcaudittrailservice.recordSnooze({time:snoozetime,reason:"throttling"});setTimeout(()=>{arc.ready()},snoozetime)})})}};this._ensureSocket=function(){if(!cx.usersession.isWebSession()){log.error("Remote Control requires websession auth")}else if(!this._socket){this._socket=io(config.getBaseApp(),{autoConnect:true,path:"/rc",query:"Duxfood="+cx.usersession.getToken()});let arc=this;this._socket.on("connect",function(){log.info("Remote Control connected and ... ");arc._isconnected=true;if(!arc._isexecuting){log.info("... ready");arc.ready()}else{log.info("... not ready")}});this._socket.on("event",function(data,accept){log.info("received remote control event:"+JSON.stringify(data));let runtest=arc.canRunCommand(data);if(runtest.canrun){accept(true);arc.runCommand(data)}else{accept(false);arc.snooze(60,runtest.reason)}});this._socket.on("disconnect",function(){log.info("Remote Control disconnected");arc._isconnected=false})}else if(this._socket.disconnected){this._socket.open()}};this._newMessageID=function(){return"xxxxxxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})};this.newMessage=function(){var rv={userid:config.getUserID(),clientid:config.getClientID(),messageid:this._newMessageID(),created:(new Date).toISOString()};return rv}}AutoBotRemoteMonitor={_myremote:new AutoBotRemote,_mymonitor:setInterval(function(){if(config.remotecontrolIsActive()){if(config.getRemoteControlFlag()&&!AutoBotRemoteMonitor._myremote.shouldBeSnoozing()){if(!AutoBotRemoteMonitor._myremote.isActive()){AutoBotRemoteMonitor._myremote.ready()}}else{if(AutoBotRemoteMonitor._myremote.isActive()){AutoBotRemoteMonitor._myremote.stop()}}}},1e3)};AutoBotOrchestrator={_scheduleRCCommand:async function(userid,command,commandparams,delay){let rv=await new Promise(function(resolve,reject){var dt=new Date;dt.setDate(dt.getDate()+parseInt(delay.days));dt.setHours(dt.getHours()+parseInt(delay.hours));dt.setMinutes(dt.getMinutes()+parseInt(delay.minutes));db.scheduleRCCommand(userid,command,commandparams,dt,resolve)});return rv},scheduleDirectMessage:async function(userid,profile,messagetext,delay){return await this._scheduleRCCommand(userid,"message",{profile:profile,messagetext:messagetext},delay)}};var AutoBotDetailPageActions={};AutoBotDetailPageActions._getAutomationCallback=function(bot,resolve,msg){return function(err,val){if(!!msg){if(!err){bot._controller.notifyTab(bot._tab,"successmessage",chrome.i18n.getMessage("automationSucceededNotification")+" : "+msg);resolve(true)}else{bot._controller.notifyTab(bot._tab,"warningmessage",chrome.i18n.getMessage("automationFailedNotification")+" : "+msg);resolve(true)}}else{resolve(true)}}};AutoBotDetailPageActions._setAutomationState=function(bot){bot._state=AutoBot._automating_state};AutoBotDetailPageActions.POSTexpandContactDetails=function(bot,pagedata,pageflags){return new Promise(function(resolve,reject){if(pageflags.canexpand){AutoBotDetailPageActions._setAutomationState(bot);bot.doActionNow(pagedata.id,{command:"expandPage"},AutoBotDetailPageActions._getAutomationCallback(bot,resolve))}else{resolve(true)}})};AutoBotDetailPageActions.POSTtagProfile=function(bot,pagedata,pageflags){return new Promise(function(resolve,reject){if(config.getAutoTagFlag()){var tagvalues=config.getAutoTagValue().split(",");for(var t=0;t<tagvalues.length&&t<5;t++){bot.getTagTracker().create(pagedata.id,tagvalues[t].trim(),bot._tab)}}resolve(true)})};AutoBotDetailPageActions.POSTsaveToPDF=function(bot,pagedata,pageflags){return new Promise(function(resolve,reject){var msg=chrome.i18n.getMessage("robotSavingPDF");if(pageflags.cansavetopdf){AutoBotDetailPageActions._setAutomationState(bot);bot._controller.notifyTab(bot._tab,"infomessage",msg);log.info("sending SAVETOPDF ");bot.doActionNow(pagedata.id,{command:"pdfProfile"},AutoBotDetailPageActions._getAutomationCallback(bot,resolve,msg))}else{resolve(true)}})};AutoBotDetailPageActions.POSTfollow=function(bot,pagedata,pageflags){return new Promise(function(resolve,reject){var msg=chrome.i18n.getMessage("robotFollowing");if(pageflags.canfollow){AutoBotDetailPageActions._setAutomationState(bot);bot._controller.notifyTab(bot._tab,"infomessage",msg);log.info("sending FOLLOW ");bot.doActionNow(pagedata.id,{command:"followProfile"},AutoBotDetailPageActions._getAutomationCallback(bot,resolve,msg))}else{resolve(true)}})};AutoBotDetailPageActions.POSTdisconnect=function(bot,pagedata,pageflags){return new Promise(function(resolve,reject){var msg=chrome.i18n.getMessage("robotDisconnecting");if(pageflags.candisconnect){AutoBotDetailPageActions._setAutomationState(bot);bot._controller.notifyTab(bot._tab,"infomessage",msg);log.info("sending DISCONNET ");bot.doActionNow(pagedata.id,{command:"disconnectProfile"},AutoBotDetailPageActions._getAutomationCallback(bot,resolve,msg))}else{resolve(true)}})};AutoBotDetailPageActions.POSTendorse=function(bot,pagedata,pageflags,autoendorsetarget){return new Promise(function(resolve,reject){var msg=chrome.i18n.getMessage("robotEndorsing");if(pageflags.canendorse){AutoBotDetailPageActions._setAutomationState(bot);bot._controller.notifyTab(bot._tab,"infomessage",msg);log.info("sending ENDORSE ");bot.doActionNow(pagedata.id,{command:"endorseProfile",parameter:autoendorsetarget},AutoBotDetailPageActions._getAutomationCallback(bot,resolve,msg))}else{resolve(true)}})};AutoBotDetailPageActions.POSTsaveAsLead=function(bot,pagedata,pageflags){return new Promise(function(resolve,reject){var msg=chrome.i18n.getMessage("robotSavingAslead");if(pageflags.cansaveaslead){AutoBotDetailPageActions._setAutomationState(bot);bot._controller.notifyTab(bot._tab,"infomessage",msg);log.info("sending SAVEASLEAD ");bot.doActionNow(pagedata.id,{command:"saveasleadProfile"},AutoBotDetailPageActions._getAutomationCallback(bot,resolve,msg))}else{resolve(true)}})};AutoBotDetailPageActions.POSTsendMessage=function(bot,pagedata,pageflags,messagetext){return new Promise(function(resolve,reject){var msg=chrome.i18n.getMessage("robotSendingMessage");if(pageflags.canmessage){AutoBotDetailPageActions._setAutomationState(bot);bot._controller.notifyTab(bot._tab,"infomessage",msg);log.info("sending MESSAGE ");bot.doActionNow(pagedata.id,{command:"messageProfile",parameter:messagetext},function(err,val){if(!err){cx.conversationservice.POSTtrackMessageSent(pagedata.id)}AutoBotDetailPageActions._getAutomationCallback(bot,resolve,msg)(err,val)})}else{resolve(true)}})};AutoBotDetailPageActions.POSTsendInMail=function(bot,pagedata,pageflags,messagesubject,messagebody){return new Promise(function(resolve,reject){var msg=chrome.i18n.getMessage("robotSendingInmail");if(pageflags.caninmail){AutoBotDetailPageActions._setAutomationState(bot);bot._controller.notifyTab(bot._tab,"infomessage",msg);log.info("sending INMAIL ");bot.doActionNow(pagedata.id,{command:"inmailProfile",parameter:{subjecttemplate:messagesubject,messagetemplate:messagebody}},AutoBotDetailPageActions._getAutomationCallback(bot,resolve,msg))}else{resolve(true)}})};AutoBotDetailPageActions.POSTinvite=function(bot,pagedata,pageflags,messagetext){return new Promise(function(resolve,reject){var msg=chrome.i18n.getMessage("robotSendingConnectionRequest");if(pageflags.canconnect){AutoBotDetailPageActions._setAutomationState(bot);bot._controller.notifyTab(bot._tab,"infomessage",msg);log.info("sending CONNECT ");bot.doActionNow(pagedata.id,{command:"connectProfile",parameter:messagetext},function(err,val){if(!err){cx.conversationservice.POSTtrackInviteSent(pagedata.id)}AutoBotDetailPageActions._getAutomationCallback(bot,resolve,msg)(err,val)})}else{resolve(true)}})};var AutoBotResultPageActions={};AutoBotResultPageActions._getAutomationCallback=function(bot,resolve,msg){return function(err,val){if(!!msg){if(!err){bot._controller.notifyTab(bot._tab,"successmessage",chrome.i18n.getMessage("automationSucceededNotification")+" : "+msg);resolve(true)}else{bot._controller.notifyTab(bot._tab,"warningmessage",chrome.i18n.getMessage("automationFailedNotification")+" : "+msg);resolve(true)}}else{resolve(true)}}};AutoBotResultPageActions._setAutomationState=function(bot){bot._state=AutoBot._automating_state};AutoBotResultPageActions.POSTprocessNewConnections=function(bot,pagedata,pageflags){return new Promise(function(resolve,reject){AutoBotResultPageActions._setAutomationState(bot);bot.doActionNow(pagedata.id,{command:"processNewConnections"},AutoBotResultPageActions._getAutomationCallback(bot,resolve))})};var STARTINDEX=0;var BOTWAITLIMIT=2;var SCHEDULESNOOZE="schedule";var MANUALSNOOZE="user";var LIMITSNOOZES="limit";var AutoBotFactory={bots:{},makeRCBot:function(tab,controller){AutoBotFactory.bots[tab.id]=new AutoBot(tab,controller);return RCEnableBot(AutoBotFactory.bots[tab.id])},get:function(tab,controller){if(!AutoBotFactory.bots[tab.id]){log.info("added bot to "+tab.id);AutoBotFactory.bots[tab.id]=new AutoBot(tab,controller);var that=this;if(config.getStartDisabled()){AutoBotFactory.bots[tab.id].doDisable()}}return AutoBotFactory.bots[tab.id]},hasBot:function(tab){return AutoBotFactory.bots[tab.id]!=null},stopAll:function(reason){for(var id in AutoBotFactory.bots){var bot=AutoBotFactory.bots[id];if(bot.isRunning()){bot.doStop();cx.postToTab(bot._tab,{command:"stop"},0);bot._controller.notifyTab(bot._tab,"errormessage",reason)}}},tabRemoved:function(tabid){log.info("Stopping and removing bot for tabid "+tabid);var bot=AutoBotFactory.bots[tabid];if(bot!=null){bot.doStop();delete AutoBotFactory.bots[tabid]}},tabUpdated:function(tabid,tabstate){log.info("Updating tab state for bot for tabid "+tabid);var bot=AutoBotFactory.bots[tabid];if(bot!=null){bot._tab=tabstate}},tabReplaced:function(oldtabid,newtab){log.warning("Replacing tabid for bot "+oldtabid);AutoBotFactory.bots[newtab.id]=AutoBotFactory.bots[oldtabid];delete AutoBotFactory.bots[oldtabid];AutoBotFactory.bots[newtab.id]._tab=newtab},botsAreBusy:function(){var gotbusybot=false;for(var id in AutoBotFactory.bots){try{var bot=AutoBotFactory.bots[id];if(!bot.isIdle()){gotbusybot=true;break}}catch(e){log.error(e)}}return gotbusybot},monitorBots:function(){log.info("Checking bots for hangs.");for(var id in AutoBotFactory.bots){try{var bot=AutoBotFactory.bots[id];if(bot.isStuck()){log.warning("Recovering bot for tab "+id);bot.recover()}}catch(e){log.error(e)}}}};setInterval(AutoBotFactory.monitorBots,6e4);var AutoBot=function(tab,controller){this._controller=controller;this._startlastresult=null;this._state=AutoBot._idle_state;this._tab=tab;this._mode="visit";this._cursor={index:STARTINDEX};this._showingframe="unknown";this._showingmain="unknown";this._lastactivity=Date.now();this.setContext=function(ctx){if(!!ctx.gluser)this._gluser=ctx.gluser;if(!!ctx.liuser){if(this._liuser!=ctx.liuser){this._liemail=null}this._liuser=ctx.liuser}if(!!ctx.dsprofile)this._dsprofile=ctx.dsprofile;if(!!ctx.dsmode)this._dsmode=ctx.dsmode;if(!!ctx.quotaid)this._quotaid=ctx.quotaid};this.getContext=function(){return{gluser:this._gluser,liuser:this._liuser,liemail:this._liemail,dsmode:this._dsmode,quotaid:this._quotaid}};this.getTagTracker=function(){return this._controller.getTagTracker(this._tab)};this.getVisitTracker=function(){return this._controller.getVisitTracker(this._tab)};this.getProfileTracker=function(){return this._controller.getProfileTracker(this._tab)};this.getActionTracker=function(){return this._controller.getActionTracker(this._tab)};this.getProfile=function(){return this._controller.getProfile(this._tab)};this.doCommand=function(cmd,msg,mindelay=0,callback){this._lastactivity=Date.now();var profile=this.getProfile();var delay=this._controller.getThrottleDelaytime();if(msg!=null){var tab=this._tab;var controller=this._controller;setTimeout(function(){controller.notifyTab(tab,msg.messagetype,msg.messagetext)},mindelay+(delay>=1e3?delay-1e3:0))}this._pendingcommand=this._controller.postToTab(this._tab,cmd,delay+mindelay,callback)};this.doCommandNow=function(cmd,callback){this._lastactivity=Date.now();this._controller.postToTab(this._tab,cmd,0,callback)};this.doActionNow=function(profileid,action,callback){let that=this;action.targeturl=this._tab.url;this.doCommandNow(action,function(err,val){if(!err){that.getActionTracker().recordAction(profileid,action,true,val)}else{that.getActionTracker().recordAction(profileid,action,false,err)}callback(err,val)})};this.isStuck=function(){var rv=false;if(this.isRunning()&&!this.isPausing()&&!this.isSnoozing()){rv=Date.now()-this._lastactivity>BOTWAITLIMIT*60*1e3}return rv};this.isPausing=function(){return this._cancelpauseaction!=null};this.isSnoozing=function(){return this._snoozecheckandnotify!=null};this.recover=function(){var recoverytype=this.getProfile().recoverytype;this._lastactivity=Date.now();this._state=this.visitMode()?AutoBot._collecting_state:AutoBot._quickscan_state;if(recoverytype=="reload"){if(this.showingInFrame()){this.doCommand({command:"backup"})}else{this._controller.reloadTab(this._tab)}}else if(recoverytype=="skip"){if(this.showingInFrame()){this.doCommand({command:"backup"})}else{}}else{log.info("Not recovering hanging tab, not configured:"+recoverytype)}};this.cancelSnooze=function(newstate){clearInterval(this._snoozecheckandnotify);this._snoozecheckandnotify=null;this._state=newstate;this._snoozereason=""};this.snooze=function(state,data,flags,reason){var target=this;var mstogo=config.resetIn().totalms;this._snoozereason=reason;this._snoozecheckandnotify=setInterval(function(){var visittracker=target.getVisitTracker();var actiontracker=target.getActionTracker();var resetin=config.resetIn();var keepsnoozing=false;var isvisitinghour=visittracker.isWorkingHour();var visitlimitreached=visittracker.dailyQuotaReached(target.getProfile());var invitelimitreached=actiontracker.dailyInviteQuotaReached()&&config.getAutoConnect();var messagelimitreached=actiontracker.dailyMessageQuotaReached()&&config.getConnectedMessageFlag();var snoozeenabled=config.getSnooze();var robotpaused=config.getPauseRobot();if(!isvisitinghour&&snoozeenabled){target._controller.notifyTab(target._tab,"infomessage",chrome.i18n.getMessage("robotSnoozingScheduled"),{timeOut:5e4,extendedTimeOut:5e4,progressBar:true});target._snoozereason=SCHEDULESNOOZE;keepsnoozing=true}else if(visitlimitreached||invitelimitreached||messagelimitreached){if(snoozeenabled){var limits=[];if(visitlimitreached)limits.push(" visit");if(invitelimitreached)limits.push(" invite");if(messagelimitreached)limits.push(" message");target._controller.notifyTab(target._tab,"infomessage",chrome.i18n.getMessage("robotSnoozingLimit").replace(/__limitnames__/g,limits.join(",")));keepsnoozing=true;target._snoozereason=LIMITSNOOZES}else{keepsnoozing=false}}else if(robotpaused){target._controller.notifyTab(target._tab,"infomessage",chrome.i18n.getMessage("robotSnoozingUser"));keepsnoozing=true;target._snoozereason=MANUALSNOOZE}if(!keepsnoozing){target._controller.notifyTab(target._tab,"infomessage",chrome.i18n.getMessage("robotWakeUp"));target.cancelSnooze(state);target.onResultPage(data,flags);target._snoozereason=""}},6e4)}};AutoBot._drilling_state={_name:"_drilling_state",onResultPage:function(data,flags,cursor){log.info("sending BACKUP ");this._state=AutoBot._collecting_state;this.doCommand({command:"backup"});return AutoBot._collecting_state},onDetailPage:function(data,flags,cursor){var profile=this.getProfile();this._controller.notifyTab(this._tab,"infomessage",chrome.i18n.getMessage("robotGotProfile"));let that=this;this._POSTexecuteAutomations(data,flags).finally(function(){return new Promise(function(resolve,reject){setTimeout(function(){if(that._state==AutoBot._automating_state||that._state==AutoBot._drilling_state){log.info("sending BACKUP ");that._state=AutoBot._collecting_state;that.doCommand({command:"backup"},null,0)}else{}resolve(true)},5e3)})});return this._state},onUnknownPage:function(data,flags,cursor){log.info("sending BACKUP ");this._state=AutoBot._collecting_state;this.doCommand({command:"backup"});return AutoBot._collecting_state},doStart:function(event,cursor){return AutoBot._collecting_state},doStop:defaultStop};AutoBot._collecting_state={_name:"_collecting_state",onResultPage:function(data,flags,cursor){var visittracker=this.getVisitTracker();var tagtracker=this.getTagTracker();var actiontracker=this.getActionTracker();var profiletracker=this.getProfileTracker();var rv=null;var snoozereason="";var stopreason="";var isvisitinghour=visittracker.isWorkingHour();var visitlimitreached=visittracker.dailyQuotaReached(this._quotaid);var invitelimitreached=actiontracker.dailyInviteQuotaReached()&&config.getAutoConnect();var messagelimitreached=actiontracker.dailyMessageQuotaReached()&&config.getConnectedMessageFlag();if(isvisitinghour){if(visitlimitreached){snoozereason=chrome.i18n.getMessage("robotStartSnoozingVisitLimit");stopreason=chrome.i18n.getMessage("robotStoppingVisitLimit")}if(invitelimitreached){snoozereason=chrome.i18n.getMessage("robotStartSnoozingInviteLimit");stopreason=chrome.i18n.getMessage("robotStoppingInviteLimit")}if(messagelimitreached){snoozereason=chrome.i18n.getMessage("robotStartSnoozingMessageLimit");stopreason=chrome.i18n.getMessage("robotStoppingMessageLimit")}}else{snoozereason=chrome.i18n.getMessage("robotNotScheduledStartSnoozing");if(visitlimitreached){stopreason=chrome.i18n.getMessage("robotStoppingVisitLimit")}if(invitelimitreached){stopreason=chrome.i18n.getMessage("robotStoppingInviteLimit")}if(messagelimitreached){stopreason=chrome.i18n.getMessage("robotStoppingMessageLimit")}}var snoozeenabled=config.getSnooze();var robotpaused=config.getPauseRobot();this._controller.notifyTab(this._tab,"infomessage",chrome.i18n.getMessage("working"));if(!isvisitinghour&&snoozeenabled){this._controller.notifyTab(this._tab,"warningmessage",snoozereason);this.snooze(AutoBot._collecting_state,data,flags,SCHEDULESNOOZE);rv=AutoBot._snoozing_state}else if(visitlimitreached||invitelimitreached||messagelimitreached){if(snoozeenabled){this._controller.notifyTab(this._tab,"warningmessage",snoozereason);this.snooze(AutoBot._collecting_state,data,flags,LIMITSNOOZES);rv=AutoBot._snoozing_state}else{this._controller.onRobotStop(this._tab,stopreason);rv=AutoBot._idle_state}}else if(robotpaused){this._controller.notifyTab(this._tab,"warningmessage",chrome.i18n.getMessage("robotSnoozingUser"));this.snooze(AutoBot._collecting_state,data,flags,MANUALSNOOZE);rv=AutoBot._snoozing_state}if(cursor.index<data.length&&rv==null){var record=data[cursor.index];var target=this;var filterresult=visittracker.filteredProfile(data[cursor.index]);if(filterresult){var fn=!!record["First Name"]?record["First Name"]:"LinkedIn";var mn=!!record["Middle Name"]?record["Middle Name"]:" ";var ln=!!record["Last Name"]?record["Last Name"]:"Member";target._controller.notifyTab(this._tab,"warningmessage",chrome.i18n.getMessage("robotSkipping")+" '"+fn+mn+ln+"', "+filterresult+".");cursor.index++;setTimeout(function(){target.onResultPage(data,flags,cursor)},0);rv=AutoBot._collecting_state}else{profiletracker.POSTisBlacklisted(record).then(function(blacklisted){if(blacklisted&&config.getExcludeBlacklistedAction()){target._controller.notifyTab(target._tab,"warningmessage",chrome.i18n.getMessage("robotSkipping")+" '"+record["First Name"]+" "+record["Last Name"]+"', "+chrome.i18n.getMessage("blacklisted"));cursor.index++;setTimeout(function(){target.onResultPage(data,flags,cursor)},0)}else{tagtracker.POSTcheckTagSkipping(record,config.getSkipTaggedFlag(),config.getSkipTaggedValue()).then(function(tagfound){if(tagfound!=null){var usermsg=chrome.i18n.getMessage("taggedAs")+" '"+tagfound+"'.";target._controller.notifyTab(target._tab,"warningmessage",chrome.i18n.getMessage("robotSkipping")+" '"+record["First Name"]+" "+record["Last Name"]+"', "+usermsg);cursor.index++;setTimeout(function(){target.onResultPage(data,flags,cursor)},0)}else{visittracker.inLastXDays(record,config.getSkipDays(),getProcessAsynchCheck(target,visittracker,data,cursor,record,flags))}})}});rv=AutoBot._collecting_state}}else if(rv==null&&cursor.index==data.length){if(flags.cannext){cursor.index=STARTINDEX;log.info("sending NEXT ");this.doCommand({command:"nextResultPage"});rv=AutoBot._collecting_state}else{this._controller.onRobotStop(this._tab,chrome.i18n.getMessage("robotStoppingLastPage"));rv=AutoBot._idle_state}}return rv},onDetailPage:function(data,flags,cursor){log.info("sending BACKUP ");this._state=AutoBot._collecting_state;this.doCommand({command:"backup"});return AutoBot._collecting_state},onUnknownPage:function(data,flags,cursor){var rv=AutoBot._collecting_state;if(!config.getIgnoreUnknown()){this._controller.onRobotStop(this._tab,chrome.i18n.getMessage("robotStoppingUnknownPage"));rv=AutoBot._idle_state}return rv},doStart:function(event,cursor){return AutoBot._collecting_state},doStop:defaultStop};AutoBot._quickscan_state={_name:"_quickscan_state",onResultPage:function(data,flags,cursor){var rv=null;let that=this;this._POSTexecuteAutomations(data,flags).finally(function(){return new Promise(function(resolve,reject){setTimeout(function(){if(that._state==AutoBot._automating_state||that._state==AutoBot._quickscan_state){that._state=AutoBot._quickscan_state;if(flags.cannext){log.info("sending NEXT ");that._controller.notifyTab(that._tab,"infomessage",chrome.i18n.getMessage("working"));var delay=config.getScanThrottleTime();that.doCommand({command:"nextResultPage"},chrome.i18n.getMessage("pausing")+" "+Math.round(delay/1e3)+"s",delay);that._state=AutoBot._quickscan_state}else{log.info("sending STOP ");that._controller.onRobotStop(that._tab,chrome.i18n.getMessage("robotStoppingLastPage"));that._state=AutoBot._idle_state}}else{}resolve(true)},3e3)})});return this._state},onDetailPage:function(data,flags,cursor){return AutoBot._idle_state},onUnknownPage:function(data,flags,cursor){var rv=AutoBot._quickscan_state;if(!config.getIgnoreUnknown()){this._controller.onRobotStop(this._tab,chrome.i18n.getMessage("robotStoppingUnknownPage"));rv=AutoBot._idle_state}return rv},doStart:function(event,cursor){return AutoBot._quickscan_state},doStop:defaultStop};AutoBot._snoozing_state={_name:"_snoozing_state",onResultPage:function(data,flags,cursor){this._controller.onRobotStop(this._tab,chrome.i18n.getMessage("snoozeCancelledByUserAction"));this.cancelSnooze();return AutoBot._idle_state},onDetailPage:function(data,flags,cursor){this._controller.onRobotStop(this._tab,chrome.i18n.getMessage("snoozeCancelledByUserAction"));this.cancelSnooze();return AutoBot._idle_state},onUnknownPage:function(data,flags,cursor){this._controller.onRobotStop(this._tab,chrome.i18n.getMessage("snoozeCancelledByUserAction"));this.cancelSnooze();return AutoBot._idle_state},doStart:function(event,cursor){this._controller.onRobotStop(this._tab,chrome.i18n.getMessage("snoozeCancelledByUserAction"));this.cancelSnooze();return AutoBot._idle_state},doStop:function(event,cursor){this._controller.onRobotStop(this._tab,chrome.i18n.getMessage("snoozeCancelledByUserAction"));this.cancelSnooze();return AutoBot._idle_state}};AutoBot._idle_state={_name:"_idle_state",onResultPage:function(data,flags,cursor){this._controller.notifyTab(this._tab,"successmessage",chrome.i18n.getMessage("atYourService"));this._startlastresult=function(mode){this._state=mode=="visit"?AutoBot._collecting_state:AutoBot._quickscan_state;if(this._dsprofile.ResultPage.reloadonstart){this._controller.notifyTab(this._tab,"infomessage",chrome.i18n.getMessage("robotReloadingPage"));this.doCommand({command:"reloadPage"},3e3);return this._state}else{return this.onResultPage(data,flags,cursor)}};if(this._dsprofile.ResultPage.name=="ResultPageConnections"){ScheduledReaderMonitor.getReader().onConnectionsPage(this._tab.id)}return AutoBot._idle_state},onDetailPage:function(data,flags,cursor){if(config.getDebugMode()||config.getAutoOnManual()){var that=this;this._POSTexecuteAutomations(data,flags).finally(function(){return new Promise(function(resolve,reject){setTimeout(function(){if(that._state==AutoBot._automating_state){that._state=AutoBot._idle_state}else{}resolve(true)},5e3)})})}this._controller.notifyTab(this._tab,"infomessage",chrome.i18n.getMessage("robotGotProfile"));return AutoBot._idle_state},onUnknownPage:function(data,flags,cursor){if(this._liuser!=null&&this._liemail==null&&this._dsprofile.name.startsWith("LinkedInPeople")){var target=this;this.doCommandNow({command:"getMail"},function(liemail){log.info(liemail);if(!!liemail){target._liemail=liemail;log.data(target.getContext())}})}return AutoBot._idle_state},doStart:function(event,cursor){cursor.index=STARTINDEX;this._startlastresult.bind(this)(event);return this._state},doStop:defaultStop};AutoBot._rcawait_state={_name:"_rcawait_state",onResultPage:function(data,flags,cursor){this._POSTexecuteRCCommand(data,flags);return AutoBot._rcawait_state},onDetailPage:function(data,flags,cursor){this._POSTexecuteRCCommand(data,flags);return AutoBot._rcawait_state},onUnknownPage:function(data,flags,cursor){this._POSTexecuteRCCommand(data,flags);return AutoBot._rcawait_state},doStart:function(event,cursor){},doStop:function(event,cursor){return AutoBot._rcawait_state}};AutoBot._disabled_state={_name:"_disabled_state",onResultPage:function(data,flags,cursor){return AutoBot._disabled_state},onDetailPage:function(data,flags,cursor){return AutoBot._disabled_state},onUnknownPage:function(data,flags,cursor){return AutoBot._disabled_state},doStart:function(event,cursor){cursor.index=STARTINDEX;var tracker=this.getVisitTracker();if(event=="scan"){if(this._dsprofile.ResultPage.reloadonstart){this._controller.notifyTab(this._tab,"infomessage",chrome.i18n.getMessage("robotReloadingPage"));this.doCommand({command:"reloadPage"},3e3)}else{this.doCommandNow({command:"nextResultPage"})}return AutoBot._quickscan_state}else if(event=="visit"){this._startlastresult.bind(this)();return this._state}else{log.warning("unknown mode:"+event)}},doStop:defaultStop};AutoBot._automating_state={_name:"_automating_state",onResultPage:function(data,flags,cursor){return AutoBot._automating_state},onDetailPage:function(data,flags,cursor){return AutoBot._automating_state},onUnknownPage:function(data,flags,cursor){return AutoBot._automating_state},doStart:function(event,cursor){return AutoBot._automating_state},doStop:defaultStop};function defaultStop(event,cursor){try{if(this._pendingcommand!=null){clearTimeout(this._pendingcommand);this._pendingcommand=null}if(this._timeout!=null){clearTimeout(this._timeout);this._timeout=null}if(this._cancelpausenotifications!=null){clearInterval(this._cancelpausenotifications);this._cancelpausenotifications=null}if(this._cancelpauseaction!=null){clearTimeout(this._cancelpauseaction);this._cancelpauseaction=null}}catch(e){}return AutoBot._idle_state}AutoBot.prototype.onDetailPage=function(data,flags){log.info("onDetailPage, entry state: "+this._state._name);this._lastactivity=Date.now();if(flags.inframe){this._showingframe="detail"}else{this._showingmain="detail";this._showingframe=null}this._state=this._state.onDetailPage.bind(this)(data,flags,this._cursor);log.info("onDetailPage, exit state: "+this._state._name)};AutoBot.prototype.onResultPage=function(data,flags){log.info("onResultPage, entry state: "+this._state._name);this._lastactivity=Date.now();if(flags.inframe){this._showingframe="result"}else{this._showingmain="result";this._showingframe=null}this._state=this._state.onResultPage.bind(this)(data,flags,this._cursor);log.info("onResultPage, exit state: "+this._state._name)};AutoBot.prototype.onUnknownPage=function(data,flags){log.info("onUnknownPage, entry state: "+this._state._name);this._lastactivity=Date.now();if(flags.inframe){this._showingframe="unknown"}else{this._showingmain="unknown";this._showingframe=null}this._state=this._state.onUnknownPage.bind(this)(data,flags,this._cursor);log.info("onUnknownPage, exit state: "+this._state._name)};AutoBot.prototype.doStart=function(event){log.info("doStart, entry state: "+this._state._name);var newevent=event!=null?event:this._mode;this._mode=newevent;this._lastactivity=Date.now();this._state=this._state.doStart.bind(this)(newevent,this._cursor);log.info("doStart, exit state: "+this._state._name)};AutoBot.prototype.doStop=function(event){log.info("doStop, entry state: "+this._state._name);this._lastactivity=Date.now();this._state=this._state.doStop.bind(this)(event,this._cursor);log.info("doStop, exit state: "+this._state._name)};AutoBot.prototype.doEnable=function(event){log.info("doEnable, entry state: "+this._state._name);this._lastactivity=Date.now();this._state=AutoBot._idle_state;log.info("doEnable, exit state: "+this._state._name)};AutoBot.prototype.doDisable=function(event){log.info("doDisable, entry state: "+this._state._name);this._lastactivity=Date.now();this._state=AutoBot._disabled_state;log.info("doDisable, exit state: "+this._state._name)};AutoBot.prototype.isRunning=function(){return this._state==AutoBot._collecting_state||this._state==AutoBot._drilling_state||this._state==AutoBot._quickscan_state||this._state==AutoBot._automating_state};AutoBot.prototype.isSnoozing=function(){return this._state==AutoBot._snoozing_state};AutoBot.prototype.getSnoozeReason=function(){return this._snoozereason};AutoBot.prototype.isIdle=function(){return this._state==AutoBot._idle_state||this._state==AutoBot._rcawait_state||this._state==AutoBot._disabled_state};AutoBot.prototype.isEnabled=function(){return this._state!=AutoBot._disabled_state};AutoBot.prototype.showingResult=function(){return this._showingmain=="result"||this._showingframe=="result"};AutoBot.prototype.showingDetail=function(){return this._showingmain=="detail"||this._showingframe=="detail"};AutoBot.prototype.showingInFrame=function(){return this._showingframe!=null};AutoBot.prototype.scanMode=function(){return this._mode=="scan"};AutoBot.prototype.visitMode=function(){return this._mode=="visit"};AutoBot.prototype.getMode=function(){return this._mode};AutoBot.prototype._POSTexecuteAutomations=function(data,flags){var rv=Promise.resolve();var bot=this;if(Array.isArray(data)){}else{rv=rv.then(function(){return AutoBotDetailPageActions.POSTexpandContactDetails(bot,data,flags)});if(config.automationIsActive()){rv=rv.then(function(){return bot._controller.profileservice.POSTisBlacklisted(data).then(function(blacklisted){var chain=Promise.resolve();if(!blacklisted||!config.getExcludeBlacklistedAction()){if(config.getAutoTagFlag()){chain=chain.then(function(){return AutoBotDetailPageActions.POSTtagProfile(bot,data,flags)})}if(config.getAutoPDF()){chain=chain.then(function(){return AutoBotDetailPageActions.POSTsaveToPDF(bot,data,flags)})}if(config.getAutoFollow()){chain=chain.then(function(){return AutoBotDetailPageActions.POSTfollow(bot,data,flags)})}if(config.getAutoDisconnect()){chain=chain.then(function(){return AutoBotDetailPageActions.POSTdisconnect(bot,data,flags)})}if(config.getAutoEndorse()){chain=chain.then(function(){return AutoBotDetailPageActions.POSTendorse(bot,data,flags,config.getAutoEndorseTarget())})}if(config.getAutoSaveAsLead()){chain=chain.then(function(){return AutoBotDetailPageActions.POSTsaveAsLead(bot,data,flags)})}if(config.getConnectedMessageFlag()){chain=chain.then(function(){return AutoBotDetailPageActions.POSTsendMessage(bot,data,flags,config.getConnectedMessageText())})}if(config.getSendInmailFlag()){chain=chain.then(function(){return AutoBotDetailPageActions.POSTsendInMail(bot,data,flags,config.getSendInmailSubject(),config.getSendInmailBody())})}if(config.getAutoConnect()){chain=chain.then(function(){return AutoBotDetailPageActions.POSTinvite(bot,data,flags,config.getAutoConnectMessageFlag()?config.getAutoConnectMessageText():null)})}}else{bot._controller.notifyTab(bot._tab,"warningmessage",chrome.i18n.getMessage("robotIgnoring")+" '"+data["First Name"]+" "+data["Last Name"]+"' ("+chrome.i18n.getMessage("blacklisted")+")")}return chain})})}}return rv};function getProcessAsynchCheck(target,tracker,data,cursor,record,flags){return function(foundinwindow){if(!foundinwindow){var waittime=cx.getThrottleWaittime();if(waittime!=0){var startwait=Date.now();var pauseleft=Math.round((waittime-(Date.now()-startwait))/6e4);target._controller.notifyTab(target._tab,"infomessage",chrome.i18n.getMessage("robotPausingVisits").replace(/__m__/g,pauseleft).replace(/__v__/g,config.getWaitVisits()),{timeOut:6e4,extendedTimeOut:6e4,progressBar:true});target._cancelpausenotifications=setInterval(function(){var pauseleft=Math.round((waittime-(Date.now()-startwait))/6e4);if(pauseleft>0){target._controller.notifyTab(target._tab,"infomessage",chrome.i18n.getMessage("robotPausingVisits").replace(/__m__/g,pauseleft).replace(/__v__/g,config.getWaitVisits()),{timeOut:6e4,extendedTimeOut:6e4,progressBar:true})}},6e4)}target._cancelpauseaction=setTimeout(function(){log.info("sending DOWN ");target._cancelpauseaction=null;if(target._cancelpausenotifications!=null){clearInterval(target._cancelpausenotifications);target._cancelpausenotifications=null}target.doCommand({command:"drilldown",parameter:cursor.index++},{messagetype:"infomessage",messagetext:chrome.i18n.getMessage("robotVisiting")+" '"+record["First Name"]+(!!record["Middle Name"]?" "+record["Middle Name"]+" ":" ")+record["Last Name"]+"'."});target._state=AutoBot._drilling_state;if(config.getDebugMode()){log.info("Setting cursor to end of data in debugmode.");cursor.index=data.length}},waittime)}else{var usermsg="";if(config.getSkipDays()==1){usermsg=chrome.i18n.getMessage("robotAlreadyVisited24h")}else if(config.getSkipDays()<31){usermsg=chrome.i18n.getMessage("robotAlreadyVisitedDays").replace(/__d__/g,config.getSkipDays())}else if(config.getSkipDays()<999999){var m=Math.floor(config.getSkipDays()/31);usermsg=chrome.i18n.getMessage("robotAlreadyVisitedMonths").replace(/__m__/g,m)}else{usermsg=chrome.i18n.getMessage("robotAlreadyVisitedEver")}target._controller.notifyTab(target._tab,"warningmessage",chrome.i18n.getMessage("robotSkipping")+" '"+record["First Name"]+" "+record["Last Name"]+"', "+usermsg);cursor.index++;setTimeout(function(){target.onResultPage(data,flags,cursor)},0)}}}function RCEnableBot(bot){bot.POSTrunCommand=function(command,params){return new Promise(function(accept,reject){let cancelme=setTimeout(function(){reject("timeout")},6e4);try{bot[command](params,function(rv){clearTimeout(cancelme);accept(rv)})}catch(e){clearTimeout(cancelme);reject(e)}})},bot._ignoreRCCommand=function(cb){cb({ignored:true,reason:"Profile is blacklisted"})},bot.visit=function(params,cb){log.info("RC-visit");chrome.tabs.update(this._tab.id,{url:params.profile});bot._POSTexecuteRCCommand=function(data,flags){AutoBotDetailPageActions.POSTexpandContactDetails(this,data,flags).then(cb)}};bot.connect=function(params,cb){log.info("RC-connect");chrome.tabs.update(this._tab.id,{url:params.profile});bot._POSTexecuteRCCommand=function(data,flags){bot.getProfileTracker().POSTisBlacklisted(data).then(function(blacklisted){if(blacklisted&&config.getExcludeBlacklistedAction()){bot._ignoreRCCommand(cb)}else{AutoBotDetailPageActions.POSTinvite(bot,data,flags,params.messagetext).then(cb)}})}};bot.message=function(params,cb){log.info("RC-message");chrome.tabs.update(this._tab.id,{url:params.profile});bot._POSTexecuteRCCommand=function(data,flags){bot.getProfileTracker().POSTisBlacklisted(data).then(function(blacklisted){if(blacklisted&&config.getExcludeBlacklistedAction()){bot._ignoreRCCommand(cb)}else{AutoBotDetailPageActions.POSTsendMessage(bot,data,flags,params.messagetext).then(cb)}})}};bot.wait=function(params,cb){log.info("RC-wait");if(!params.duration||params.duration>55e3){params.duration=55e3}setTimeout(cb,params.duration)};bot._state=AutoBot._rcawait_state;return bot}function FollowUpOrchestrator(){this._active=false;this.isActive=function(){return this._active};this.start=function(){this._subscribeListeners();this._active=true};this.stop=function(){this._unsubscribeListeners();this._active=false};this._subscribeListeners=function(){MessageEventSource.addListener(this)};this._unsubscribeListeners=function(){MessageEventSource.removeListener(this)};this.on=async function(messageevent){if(messageevent.event=="received"&&messageevent.data.type=="INVITATION_ACCEPT"){let targetprofile=messageevent.data.from;let that=this;config.getFollowUpSchedule().forEach(async function(fuentry){try{return await AutoBotOrchestrator.scheduleDirectMessage(config.getUserID(),targetprofile,fuentry.text,fuentry.delay)}catch(e){log.error(e)}})}}}OrchestratorMonitor={init:function(){this._myorchestrator=new FollowUpOrchestrator;this._mymonitor=setInterval(function(){if(OrchestratorMonitor.shouldBeWorking()){if(!OrchestratorMonitor._myorchestrator.isActive()){OrchestratorMonitor._myorchestrator.start()}}else{if(OrchestratorMonitor._myorchestrator.isActive()){OrchestratorMonitor._myorchestrator.stop()}}},1e3)},getOrchestrator:function(){return this._myorchestrator},shouldBeWorking(){var rv=false;if(config.fullOrchestrationlIsActive()&&config.getFollowUpFlag()){rv=config.isWorkingHour()}return rv}};function ScheduledReader(readcontacts,readmessages){this._messageBoxes=[];if(readcontacts){this._messageBoxes.push("https://www.linkedin.com/mynetwork/invite-connect/connections/")}if(readmessages){this._messageBoxes.push("https://www.linkedin.com/messaging/?filter=unread")}this._messageBoxIndex=0;this._active=false;this.isActive=function(){return this._active};this.start=function(){this._active=true;this._openNextMessagebox()};this.stop=function(){this.closeCurrentTab();clearTimeout(this.scheduledread);this._active=false};this._openNextMessagebox=function(){let that=this;try{that.closeCurrentTab();if(this._messageBoxes.length>0){chrome.tabs.create({url:that._messageBoxes[that._messageBoxIndex],active:false},function(tab){that.tab=tab});that._messageBoxIndex=(that._messageBoxIndex+1)%that._messageBoxes.length}}catch(e){log.error(e)}finally{that.scheduleNextRead()}};this.onMessagePage=function(tabid,event,flags){if(flags.canreadconversations&&!this.processing&&this.tab!=null&&event=="activate"&&tabid==this.tab.id&&this.isActive()){let that=this;this.processing=true;chrome.tabs.sendMessage(tabid,{command:"readConversations"},function(err,res){if(err){console.log("ERR:"+JSON.stringify(err))}else{console.log("OK!")}that.closeCurrentTab();that.processing=false})}};this.onConnectionsPage=function(tabid){if(!this.processing&&this.tab!=null&&tabid==this.tab.id&&this.isActive){let that=this;this.processing=true;chrome.tabs.sendMessage(tabid,{command:"processNewConnections"},function(err,res){if(err){console.log("ERR:"+JSON.stringify(err))}else{console.log("OK!")}that.closeCurrentTab();that.processing=false})}};this.closeCurrentTab=function(){if(this.tab!=null){chrome.tabs.remove(this.tab.id);this.tab=null}};this.scheduleNextRead=function(){var that=this;this.scheduledread=setTimeout(function(){that._openNextMessagebox()},15*60*1e3)};var that=this;chrome.tabs.onReplaced.addListener(function(addedTabId,removedTabId){log.info("Replacing tabs in MessageReader ( from  , to ) : ( "+removedTabId+", "+addedTabId+" )");if(that.tab!=null&&removedTabId==that.tab.id){chrome.tabs.get(addedTabId,function(newtab){that.tab=newtab})}})}ScheduledReaderMonitor={init:function(){this._myreader=new ScheduledReader(config.basicOrchestrationlIsActive()||config.fullOrchestrationlIsActive(),config.fullOrchestrationlIsActive());this._mymonitor=setInterval(function(){if(ScheduledReaderMonitor.shouldBeReading()){if(!ScheduledReaderMonitor._myreader.isActive()){ScheduledReaderMonitor._myreader.start()}}else{if(ScheduledReaderMonitor._myreader.isActive()){ScheduledReaderMonitor._myreader.stop()}}},1e3)},getReader:function(){return this._myreader},shouldBeReading(){var rv=false;if((config.basicOrchestrationlIsActive()||config.fullOrchestrationlIsActive())&&config.getFollowUpFlag()||config.fullOrchestrationlIsActive()&&config.getMessageBridgeFlag()){rv=config.isWorkingHour()}return rv}};var VisitTrackerFactory={trackers:{},get:function(visitorname){if(!VisitTrackerFactory.trackers[visitorname]){VisitTrackerFactory.trackers[visitorname]=new VisitTracker(visitorname)}return VisitTrackerFactory.trackers[visitorname]},put:function(visitorname,tracker){if(!VisitTrackerFactory.trackers[visitorname]){VisitTrackerFactory.trackers[visitorname]={}}VisitTrackerFactory.trackers[visitorname]=tracker},unpersist:function(user){var now=Date.now();var from=dailyCutinTimestampMS();var tracker=VisitTrackerFactory.get(user);db.getVisitCountSince(user,from,function(res,err){var rv=0;if(err){log.error(err)}else if(res!=null){rv=res.result}var timestamp=now;for(var i=0;i<rv;i++){var id="id."+i;tracker._today.putWithZulu(id,id,timestamp,dailyCutoffTimestampMS())}})},loadTracker:function(visits){for(var i in visits){var visit=visits[i];if(!VisitTrackerFactory.trackers[visit.visitorname]){VisitTrackerFactory.trackers[visit.visitorname]=new VisitTracker(visit.visitorname)}VisitTrackerFactory.trackers[visit.visitorname].load(visit)}}};var VisitTracker=function(visitorname){this._visitorname=visitorname;this._idmaps={};this._cache=null;this._today=new ExpiringMap;this._24h=new ExpiringMap({defaultTimeout:24*60*60});this._31d=new ExpiringMap({defaultTimeout:24*60*60*31});this.addFromCache=function(mode){if(this._cache!=null&&mode=="scan"){for(var i=0;i<this._cache.length;i++){this.add(null,this._cache[i],mode)}}this._cache=null};this.cacheData=function(data){this._cache=data};this.addAll=function(data,mode){if(mode=="scan"){for(var i=0;i<data.length;i++){this.add(null,data[i],mode)}}else{log.info("skipping data in visit mode")}};this.add=function(quotaid,data,mode,tab,callback){if(mode=="scan"){var key=this.getKey(data);localdb.cacheScan(key,data);ScanEventSource.onCreate(data)}else if(mode=="visit"){this._storeIds(data);var key=this.getKey(data);localdb.createOrUpdateVisit(key,data,tab);this._today.putOrUpdate(key,key,sToDailyCutoff());this._24h.putOrUpdate(key,key);this._31d.putOrUpdate(key,key);var emaillookup=config.getBuyMail()&&data&&(data["Degree"]+"").indexOf("1")==-1;db.createVisit(this._visitorname,this._visitorname,quotaid,data,emaillookup,function(serverdata,error){if(serverdata.balance){var modified=false;var servervalue=serverdata.profile.data["Email"];if(!!servervalue&&!data["Email"]){data["Email"]=servervalue;modified=true}if(modified){localdb.createOrUpdateVisit(key,data,tab);VisitEventSource.onUpdate(data)}}if(callback){callback(serverdata,error)}});VisitEventSource.onCreate(data)}};this.addVisitToServer=function(quotaid,data){db.createVisit(this._visitorname,this._visitorname,quotaid,data,false)};this.update=function(data,updatelocal,updateserver,tab){this._storeIds(data);var key=this.getKey(data);if(updatelocal){localdb.createOrUpdateVisit(key,data,tab);this._today.putOrUpdate(key,key,sToDailyCutoff());this._24h.putOrUpdate(key,key);this._31d.putOrUpdate(key,key)}if(updateserver){db.updateVisit(this._visitorname,this._visitorname,this._quotaid,data)}VisitEventSource.onUpdate(data)};this.reset=function(){localdb.clearData()};this.countToday=function(){return Object.keys(this._today.toMap()).length};this.countLocalCache=function(mode,callback){localdb.countData(mode,callback)};this.dailyQuotaReached=function(quotaid){var dailyquota=config.getQuota(quotaid);if(config.userlimitsIsActive()){var override=config.getMaxVisits();if(override>0){dailyquota=override}}if(config.getRandomRangeValue()){dailyquota=DailyValueBander.D10.apply(dailyquota)}return this.countToday()>=dailyquota};this.isWorkingHour=function(when){return config.isWorkingHour(when)};this.filteredProfile=function(profile){var rv=false;if("First Name"in profile&&("Linkedin"===profile["First Name"]||""===profile["First Name"])){if("Last Name"in profile&&("Member"===profile["Last Name"]||""===profile["Last Name"])){rv="No name found for profile"}}if(!rv&&(!profile.Profile||profile.Profile.trim()=="")){rv="No link found for profile"}if(!rv&&config.getSkipNoImage()){var thumb=profile["Thumbnail"];if(thumb!=null&&thumb!=""){if(typeof thumb=="string"&&thumb.indexOf("ghost")>-1){rv=chrome.i18n.getMessage("visitDialogNoThumbnail")}else{rv=false}}else{if("Thumbnail"in profile){rv=chrome.i18n.getMessage("visitDialogNoThumbnail")}else{rv=false}}}if(!rv&&config.getSkipInCRM()){rv=profile["IsCrmImported"]=="true"?chrome.i18n.getMessage("visitDialogInCRM"):false}if(!rv&&config.getSkipNoPremium()){rv=profile["IsPremium"]=="true"?false:chrome.i18n.getMessage("visitDialogNotPremium")}if(!rv&&config.getSkip3Plus()){rv=profile["Distance"]==null||[1,2,3].indexOf(parseInt(profile["Distance"]))!=-1?false:chrome.i18n.getMessage("visitDialog3Plus")}if(!rv&&config.getSkipNoLION()){rv=profile["IsOpenlink"]=="true"?false:chrome.i18n.getMessage("visitDialogNotOpenLink")}if(!rv&&config.getSkipNoInfluencer()){rv=profile["IsInfluencer"]=="true"?false:chrome.i18n.getMessage("visitDialogNotInfluencer")}if(!rv&&config.getSkipNoJobSeeker()){rv=profile["IsJobseeker"]=="true"?false:chrome.i18n.getMessage("visitDialogNotJobSeeker")}if(!rv&&config.getSkipCustomFlag()&&!!config.getSkipCustomValue()){var regex=new RegExp(config.getSkipCustomValue(),"i");var match=regex.exec(profile.html);rv=!match?false:chrome.i18n.getMessage("visitDialogMatchesPattern")}return rv};this.inLastXDays=function(data,days,callback){if(data.id!=null&&data.id!=""&&data.id!="id."&&days>0){db.checkCache(this._visitorname,data.id,days,function(res,err){var rv=false;if(!!res){rv=res.profileid!=null}else if(err){rv=false;log.error(err)}else{log.error("No response and no error returned.")}callback(rv)})}else{setTimeout(function(){callback(false)},0)}};this.getKey=function(data){var rv=data.id;if(!rv){for(var att in data){if(att.lastIndexOf("_id")+3==att.length){rv=this._resolve(att,data[att]);if(rv){break}}}}return rv};this._resolve=function(name,value){var m=this._idmaps[name];if(m&&!!m[value]){return m[value]}else{return value}};this._storeId=function(id,name,value){if(!this._idmaps[name]){this._idmaps[name]={}}this._idmaps[name][value]=id};this._storeIds=function(data){if(!data.id){throw new DataWithoutIDError}for(var name in data){if(name.lastIndexOf("_id")+3==name.length){this._storeId(data.id,name,data[name])}}};this.load=function(visit){try{if(visit!=null&&visit.idmap!=null&&visit.idmap.id!=null){var id=visit.idmap.id;for(var key in visit.idmap){if(key!="id"){this._storeId(id,key,visit.idmap[key])}}var timestamp=Date.parse(visit.when);this._today.putWithZulu(id,id,timestamp,dailyCutoffTimestampMS());this._24h.putWithZulu(id,id,timestamp);this._31d.putWithZulu(id,id,timestamp)}}catch(e){log.warning(e)}}};function DataWithoutIDError(message){this.name="DataWithoutIDError";this.message=message;this.stack=(new Error).stack}var NotesService=function(userid){this._userid=userid;this._cache={};this.load=function(profileid,callback){var target=this;if(target._inCache(profileid)){setTimeout(function(){callback(target._getCached(profileid))},1)}else{db.getNotes(this._userid,profileid,function(notes){var text=notes.length>0?notes[notes.length-1].notetext:"";target._cacheNote(profileid,text);callback(notes)})}};this.POSTload=function(profileid){let that=this;return new Promise(resolve=>that.load(profileid,resolve))};this._initCache=function(){var target=this;db.getNotes(this._userid,null,function(notes){if(notes!=null){var temp={};for(var i=0;i<notes.length;i++){if(temp[notes[i].profileid]!=null){var date1=new Date(temp[notes[i].profileid].when);var date2=new Date(notes[i].when);if(date2>date1){temp[notes[i].profileid]=notes[i]}}else{temp[notes[i].profileid]=notes[i]}}for(var i in temp){target._cacheNote(temp[i].profileid,temp[i].notetext)}}})};this.save=function(profileid,text){this._cacheNote(profileid,text);return db.saveNote(this._userid,profileid,{text:text})};this._cacheNote=function(profileid,text){this._cache[profileid]=text};this._getCached=function(profileid){return this._cache[profileid]};this._inCache=function(profileid){return this._cache[profileid]!=null};this._initCache()};var ActionService=function(userid){this.recordAction=function(profileid,actiondata,successflag,responsevalue){var action={name:actiondata.command,params:actiondata.parameter,targeturl:actiondata.targeturl,profileid:profileid};if(action.name!="expandPage"){this._cacheAction(action);ActionEventSource.onCreate(action,successflag,responsevalue);return db.recordAction(this._userid,profileid,action,responsevalue,successflag)}};this._init=function(userid){try{this._userid=userid;this._todaysActions={};var that=this;db.getActionHistory(this._userid,1,function(list){for(var i in list){that._cacheAction(list[i])}})}catch(e){log.warning(e)}};this._cacheAction=function(action){var timestamp=Date.now();if(action.when){try{timestamp=Date.parse(action.when)}catch(e){log.error(e)}}if(!this._todaysActions[action.name]){this._todaysActions[action.name]=new ExpiringMap}if(timestamp>dailyCutinTimestampMS()){this._todaysActions[action.name].putWithZulu(""+timestamp,action,timestamp,dailyCutoffTimestampMS())}};this.todaysCount=function(actionname){var rv=0;var store=this._todaysActions[actionname];if(store){rv=Object.keys(store.toMap()).length}return rv};this.dailyQuotaReached=function(actionname,actionmax){var count=this.todaysCount(actionname);if(config.getRandomRangeValue()){actionmax=DailyValueBander.D10.apply(actionmax)}return count>=actionmax};this.dailyInviteQuotaReached=function(){return this.dailyQuotaReached("connectProfile",config.getMaxInvites())};this.dailyMessageQuotaReached=function(){return this.dailyQuotaReached("messageProfile",config.getMaxMessages())};this._init(userid)};var TagService=function(userid){this._userid=userid;this._cache={};this._uniquetags=[];this.init=function(){var target=this;db.getTaglist(this._userid,function(list){target._uniquetags=list});localdb.listVisitedProfileIDs(function(idlist){if(!!idlist&&idlist.length>0){TagService.postLoadTagsAndRecurse(target,idlist).then(function(){log.info("Tagcache loading")})}})};this.getUniqueTags=function(){return this._uniquetags};this.list=function(profileid,callback){var target=this;if(target._inCache(profileid)){setTimeout(function(){callback(target._getCache(profileid),target.getUniqueTags())},1)}else{db.getTags(this._userid,profileid,function(tags){var rv=[];for(var i=0;tags!=null&&i<tags.length;i++){rv.push(tags[i].tag)}target._cacheTags(profileid,rv);callback(rv,target.getUniqueTags())})}};this.POSTlist=function(profileid){let that=this;return new Promise(resolve=>that.list(profileid,resolve))};this.count=function(callback){db.tagStats(this._userid,function(rv){callback(rv.count)})};this.create=function(profileid,text,tab,callback){var target=this;log.info("Creating tag ["+text+"] for profile "+profileid);this.count(function(rv){if(rv<config.getMaxTags()){log.info("Caching tag ["+text+"] for profile "+profileid);target._cacheTag(profileid,text);log.info("Persisting tags");db.createTag(target._userid,profileid,{text:text},callback);if(target._uniquetags.indexOf(text)==-1){log.info("New unique tag");target._uniquetags.push(text)}else{log.info("Tag not unique")}cx.notifyTab(tab,"successmessage","Tag '"+text+"' saved.")}else{cx.notifyTab(tab,"errormessage","Tag not saved: You have reached the maximum of free tags. Please upgrade to the Professional Edition for unlimited tags")}})};this.POSTcreate=function(profileid,text,tab){let that=this;return new Promise(resolve=>that.create(profileid,text,tab,resolve))};this.remove=function(profileid,text){this._uncacheTag(profileid,text);db.removeTag(this._userid,profileid,{text:text});cx.notifyTab(null,"successmessage","Tag removed.")};this.POSThasAnyTag=function(profile,tags){return this.POSTlist(profile.id).then(function(res){let foundit=false;res.forEach(function(tag){foundit|=tags.indexOf(tag)>-1});return Promise.resolve(foundit)})};this.POSTcheckTagSkipping=function(profile,skiptaggedflag,skiptaggedvalue){var rv=null;if(skiptaggedflag&&!!profile.id){var tagstoskip=skiptaggedvalue.split(",");tagstoskip.forEach(function(val,idx,arr){arr[idx]=val.trim()});rv=this.POSTlist(profile.id).then(function(res){var tagfound=null;if(tagstoskip.length==1&&tagstoskip[0]==""&&res.length>0){tagfound=res[0]}else{for(var i in res){for(var j in tagstoskip){if(res[i]==tagstoskip[j]){tagfound=tagstoskip[j]}if(tagfound){break}}if(tagfound){break}}}return tagfound})}else{rv=Promise.resolve(null)}return rv};this._cacheTags=function(profileid,tags){for(var i=0;i<tags.length;i++){this._cacheTag(profileid,tags[i])}};this._cacheTag=function(profileid,text){var tags=this._getCache(profileid);var tagexists=false;for(var i=0;!tagexists&&i<tags.length;i++){tagexists|=tags[i]==text}if(!tagexists){tags.push(text)}};this._uncacheTag=function(profileid,text){var profiletags=this._getCache(profileid);for(var i=0;i<profiletags.length;i++){if(profiletags[i]==text){profiletags.splice(i,1);break}}};this._getCache=function(profileid){if(this._cache[profileid]==null){this._cache[profileid]=[]}return this._cache[profileid]};this._inCache=function(profileid){return this._cache[profileid]!=null};var that=this;setTimeout(function(){that.p=that.init()},0)};TagService.postLoadTagsAndRecurse=function(target,idlist,pseq){if(!pseq){pseq=Promise.resolve(true)}pseq.then(new Promise(function(resolve,reject){if(idlist.length){db.loadTags(target._userid,idlist.splice(0,500),resolve)}else{resolve([])}}).then(function(result){for(var i=0;!!result&&i<result.length;i++){target._cacheTag(result[i].profileid,result[i].tag)}if(idlist.length){TagService.postLoadTagsAndRecurse(target,idlist,pseq)}}));return pseq};var ProfileService=function(userid){this._userid=userid;this.getTagged=function(searchtype,tags,xtags,pagenumber,callback){searchtype=!!searchtype?searchtype:"alltags";xtags=!!xtags?xtags:[];pagenumber=pagenumber!=null?pagenumber:0;db.getTaggedProfiles(this._userid,searchtype,tags,xtags,pagenumber,function(result){var profiles=result.profiles;var rv={data:[],message:"",nextpage:result.nextpage,previouspage:result.previouspage,totalcount:result.totalcount,startindex:result.startindex,endindex:result.endindex};var maxresult=config.getMaxTagResults();if(result.totalcount>maxresult){rv.message="Displaying "+maxresult+" of "+profiles.length+" results. <br/>Please <a target='_blank' href='http://download.__tld__/'>upgrade to the Professional Edition</a> for all results.".replace(/__tld__/g,chrome.i18n.getMessage("tld"))}else{rv.message="Found "+result.totalcount+" profile"+(result.totalcount!=1?"s.":".")}for(var i=0;i<profiles.length&&i<maxresult;i++){rv.data.push(profiles[i].data)}callback(rv)})};this.POSTisBlacklisted=function(profile){return cx.tagservice.POSThasAnyTag(profile,[cx.conversationservice.TRACKDEFAULTRESPONDEDTAG,cx.conversationservice.TRACKDEFAULTBLACKLISTTAG])}};var ConversationService=function(userid){this._pipeline="default";this.TRACKDEFAULTBLACKLISTTAG="blacklisted";this.TRACKDEFAULTINVITEDTAG="🦆-"+this._pipeline+"-invited";this.TRACKDEFAULTACCEPTEDTAG="🦆-"+this._pipeline+"-accepted";this.TRACKDEFAULTRESPONDEDTAG="🦆-"+this._pipeline+"-responded";this.TRACKDEFAULTFOLLOWUPTAG="🦆-"+this._pipeline+"-followup-";this.updateConversation=function(messages){messages.forEach(msg=>{try{if(msg.sent){delete msg.sent;cx.tagservice.POSTlist(msg.toId).then(function(tags){msg.tags=tags;MessageEventSource.onSent(msg)})}else{delete msg.received;this.POSTtrackMessageReceived(msg).then(function(msg){cx.tagservice.POSTlist(msg.fromId).then(function(tags){msg.tags=tags;MessageEventSource.onReceived(msg)})})}}catch(e){log.error(e)}})};this.POSTtrackInviteSent=function(profileid){return cx.tagservice.POSTcreate(profileid,this.TRACKDEFAULTINVITEDTAG)};this.POSTtrackMessageSent=function(profileid){let that=this;return cx.tagservice.POSTlist(profileid).then(function(tags){if(tags.includes(that.TRACKDEFAULTINVITEDTAG)&&tags.includes(that.TRACKDEFAULTACCEPTEDTAG)){let followupsfound=0;for(let i=0;i<tags.length;i++){if(tags[i].startsWith(that.TRACKDEFAULTFOLLOWUPTAG)){followupsfound++}}return cx.tagservice.POSTcreate(profileid,that.TRACKDEFAULTFOLLOWUPTAG+(followupsfound+1))}})};this.POSTtrackMessageReceived=function(message){if(message.type=="INVITATION_ACCEPT"){return cx.tagservice.POSTcreate(message.fromId,this.TRACKDEFAULTACCEPTEDTAG).then(function(){return Promise.resolve(message)})}else{return cx.tagservice.POSTcreate(message.fromId,this.TRACKDEFAULTRESPONDEDTAG).then(function(){return Promise.resolve(message)})}};this._init=function(userid){try{this._userid=userid}catch(e){log.warning(e)}};this._init(userid);this._userid=userid};var RCEventService=function(userid){this.recordStart=function(commandmessage){RCCommandEventSource.onCreate(commandmessage)};this.recordSuccess=function(commandmessage,result){RCCommandEventSource.onSuccess(commandmessage,result)};this.recordFailure=function(commandmessage,error){RCCommandEventSource.onFail(commandmessage,error)};this.recordIgnore=function(commandmessage,reason){RCCommandEventSource.onIgnore(commandmessage,reason)};this.recordSnooze=function(commandmessage){RCCommandEventSource.onSnooze(commandmessage)};this._init=function(userid){try{this._userid=userid}catch(e){log.warning(e)}};this._init(userid)};function updateLicense(callback){if(licensechecker.checkcount<licensechecker.maxcheckcount){log.info("updateLicense");licensechecker.checkcount++;if(cx.usersession.isAuthenticated()){try{db.getCWSLicense(cx.userid,chrome.i18n.getMessage("labelid"),function(license,err){var mode="free";if(!err){try{log.info(license);licensechecker.licensedata=license;if(license.result&&license.accessLevel=="FULL"){mode="prof"}}catch(e){log.error(e)}log.info("got mode:"+mode);licensechecker.processLicense(mode)}else{log.error("failed to load license info")}if(callback){callback(licensechecker.licensedata)}})}catch(e){log.warning(e)}log.info("getLicense exit")}else{log.warning("failed to load license, no oauth token");if(callback){callback(null)}}}else{log.info("updateLicense exceeded max checks");licensechecker.stop()}}var licensechecker={license:null,token:null,checkcount:0,maxcheckcount:100,checkinterval:15e3,start:function(){if(licensechecker.token){licensechecker.stop()}log.info("starting interval");licensechecker.token=setInterval(updateLicense,licensechecker.checkinterval)},stop:function(){if(licensechecker.token){log.info("stopping interval");try{clearInterval(licensechecker.token)}catch(e){}licensechecker.token=null;licensechecker.checkcount=0}},validate:function(tab){if(tab&&!config.isPro()&&(tab.url.indexOf("https://chrome.google.com/webstore/detail/dux-soup-for-linkedin/")>-1||tab.url.indexOf("https://chrome.google.com/webstore/detail/dux-soup-starter-edition/")>-1)){licensechecker.start()}else{licensechecker.stop()}},processLicense:function(lic){log.info("processing license");if(licensechecker.license==null){licensechecker.license=lic}else{if(licensechecker.license!=lic){cx.reloadExtension()}}},load:function(callback){updateLicense(callback)}};function checkMyLicense(userid,licensekey,callback){if(cx.usersession.isAuthenticated()&&!!licensekey){db.getExternalLicense(userid,licensekey,function(key,err){var rv={status:"invalid",expiry:"N/A",message:"no license"};if(!err){try{rv=key}catch(e){console.log(e)}}else{rv.message="No license."}callback(rv)})}else{callback({status:"invalid",expiry:"N/A",message:"no license"})}}function UserSession(){this._authtype=null;this._repeater=null;this.setOAuth2=function(token){this.token=token};this.setWebSessionID=function(ID){this.token=ID};this.isCreated=function(){return rv=this.token!=null};this.isAuthenticated=function(){return this.userprofile!=null};this.clearToken=function(){this.token=null};this.getToken=function(){return this.token};this.updateAuthenticationType=function(authtype){if(!!authtype){if(config.setOptions({userauthenticationtype:authtype})){cx.reloadExtension()}}},this.forceWebSessionAuthentication=function(){this.updateAuthenticationType("websession")},this.forceOAuth2Authentication=function(){this.updateAuthenticationType("oauth2")},this.getAuthenticationType=function(){return this._authtype};this.getAuthorizationHeader=function(){var rv;if(this.isCreated()){if(this.isOAuth2()){rv="Bearer "+this.getToken()}else if(this.isWebSession()){rv="Duxfood "+this.getToken()}}return rv};this.isOAuth2=function(){return this._authtype=="oauth2"};this.isWebSession=function(){return this._authtype=="websession"};this.getUserProfile=function(){return this.userprofile};this.setUserProfile=function(profile){this.userprofile=profile};this._repeatedRefreshToken=function(){var that=this;if(this._repeater==null){this._repeater=setInterval(function(){if(that.isOAuth2()){chrome.identity.getAuthToken({interactive:false},function(res){if(res!=null){that.setOAuth2(res)}else if(chrome.runtime.lastError){}})}else if(that.isWebSession()){chrome.cookies.get({url:config.getBaseApp()+"/web",name:"duxfood"},function(cook){if(cook!=null){that.setWebSessionID(unescape(cook.value))}})}else{}},3e3)}};this.loadUserProfile=function(next){var that=this;var success=function(prof){that.userprofile=prof;next(prof)};var failure=function(err){setTimeout(function(){that.loadUserProfile(success)},3e3)};if(this.isOAuth2()){db.getOAuth2TokenInfo(this.getToken(),db.getCallback(success,failure))}else if(this.isWebSession()){db.getGoogleProfile(db.getCallback(success,failure))}};this.logout=function(){this.token=null;this.failedtoken=null;this.userprofile=null;if(config.getUserAuthenticationType()=="websession"){this.openLoginPage()}};this.openLoginPage=function(){if(this._authtype=="websession"){chrome.tabs.create({url:config.getBaseApp()+"/web/logout"},function(tab){chrome.cookies.remove({url:config.getBaseApp()+"/web",name:"duxfood"})})}};this.init=function(type){if(this._authtype!=type){this.token=null;this._authtype=type;this._repeatedRefreshToken()}}}var IDLE="idle",RUNNING="running",DEFAULTRECORDCOUNT=1,DEFAULTINDEX=0,DEFAULTSIZE=10;var cx={lastactiveprofile:"",userid:"000000000000000000000",activetabs:{},tab2profile:{},tab2visitorname:{},visitfactory:VisitTrackerFactory,botfactory:AutoBotFactory,profilecache:{},notesservice:null,tagservice:null,profileservice:null,updateavailable:false,gotdata:0,usersession:new UserSession,init:function(){this.usersession.init(config.getUserAuthenticationType());if(cx.usersession.isWebSession()){chrome.browserAction.setTitle({title:"Please Sign In"});chrome.browserAction.setPopup({popup:"init_popup_login.html"})}else{chrome.browserAction.setPopup({popup:"init_popup_broken.html"})}if(!cx.usersession.isCreated()){cx.retryInit()}else{cx._initUserConfig()}},retryInit:function(){setTimeout(function(){cx.init()},1500)},_initUserConfig:function(){try{cx.usersession.loadUserProfile(function(userprofile){cx.loadUser(userprofile);var version=chrome.runtime.getManifest().version;var labelid=chrome.i18n.getMessage("labelid");var lelicensekey=config.getAffiliateLicense();var success=cx.loadServerConfig;var failure=cx.retryInit;db.bootstrapClient(labelid,cx.userid,version,!!lelicensekey?lelicensekey.key:"",db.getCallback(success,failure))})}catch(e){log.error(e);failure()}},logout:function(){cx.usersession.logout();this.userid="000000000000000000000";config.swapoutUser();reloadInjectedTabs(0,function(){cx.reloadExtension()})},reloadExtension:function(){chrome.runtime.reload()},tabUserActivated:function(tab){log.debug("Active tab set to:"+tab.id);cx.interactivetab=tab},tabAdded:function(tab){cx.activetabs[tab.id]=tab},tabRemoved:function(tabid){delete cx.activetabs[tabid];delete cx.tab2profile[tabid];delete cx.tab2visitorname[tabid]},tabReplaced:function(oldid,newtab){var newid=newtab.id;cx.activetabs[newid]=cx.activetabs[oldid];delete cx.activetabs[oldid];cx.tab2profile[newid]=cx.tab2profile[oldid];delete cx.tab2profile[oldid];cx.tab2visitorname[newid]=cx.tab2visitorname[oldid];delete cx.tab2visitorname[oldid]},addBasicWidgets:function(tab,profileid){cx.postToTab(tab,{command:"addBasicWidgets",parameter:{profileid:profileid}},0,function(response){log.info(response)})},addNotesWidget:function(tab,text,profileid,profiledegree){cx.postToTab(tab,{command:"addNotesWidget",parameter:{text:text,profileid:profileid}},0,function(response){log.info(response)})},addTagsWidget:function(tab,tags,taglist,profileid,profiledegree){cx.postToTab(tab,{command:"addTagsWidget",parameter:{tags:tags,taglist:taglist,profileid:profileid}},0,function(response){log.info(response)})},postToTab:function(tab,msg,delay,callback){if(delay>=1e3){var to=Math.round(delay/1e3);cx.notifyTab(tab,"infomessage",chrome.i18n.getMessage("pausing")+" "+to+"s.",{timeOut:delay,progressBar:to>3})}return setTimeout(function(){try{log.info("sending "+JSON.stringify(msg)+" to "+tab.id);chrome.tabs.sendMessage(tab.id,msg,callback)}catch(e){log.warning(e)}},500+(delay!=null?delay:0))},reloadTab:function(t){cx.postToTab(t,{command:"stop"},0,function(){chrome.tabs.reload(t.id)})},broadcastConfig:function(){var configmap=config.getMap();for(var tabid in cx.activetabs){try{cx.postToTab(cx.activetabs[tabid],{command:"configUpdate",parameter:configmap},0)}catch(e){log.error(e)}}},addProfile:function(prof){log.info("addProfile:"+prof.name);cx.profilecache[prof.name]=prof;if(prof.ResultPageConfig){cx.loadJSON(config.getBaseApp()+"/plugin/v4/"+prof.ResultPageConfig,insertResultPageConfig(prof))}if(prof.DetailPageConfig){cx.loadJSON(config.getBaseApp()+"/plugin/v4/"+prof.DetailPageConfig,insertDetailPageConfig(prof))}if(prof.MessagePageConfig){cx.loadJSON(config.getBaseApp()+"/plugin/v4/"+prof.MessagePageConfig,insertMessagePageConfig(prof))}},getProfiles:function(url){var rv=[];for(var p in cx.profilecache){if(new RegExp(cx.profilecache[p].TargetHostPattern).exec(url)){rv.push(cx.profilecache[p])}}return rv},getProfileByName(profilename){return cx.profilecache[profilename]},listTaggedProfiles:function(searchtype,tags,xtags,pagenumber,callback){cx.profileservice.getTagged(searchtype,tags,xtags,pagenumber,callback)},getProfile:function(tab){return cx.tab2profile[tab.id]},getTagTracker:function(tab){return cx.tagservice},getProfileTracker:function(tab){return cx.profileservice},getVisitTracker:function(tab){var visitorname=cx.tab2visitorname[tab.id];return cx.visitfactory.get(visitorname)},getActionTracker:function(tab){return cx.actionservice},getConversationTracker:function(tab){return cx.conversationservice},getBot:function(tab){return cx.botfactory.get(tab,cx)},isBotRunning:function(tabid){var bot=cx.botfactory.get({id:tabid},cx);return bot.isRunning()},getThrottleWaittime:function(){var waittime=0;var visittracker=cx.visitfactory.get(cx.userid);if(visittracker.countToday()>0&&visittracker.countToday()%config.getWaitVisits()==0){waittime=config.getWaitMinutes()*6e4}return waittime},getThrottleDelaytime:function(){var delaytime=0;if(config.throttlingIsActive()){delaytime=config.getThrottleTime()}else{delaytime=3e3}if(delaytime==1){delaytime=Math.round(Math.random()*3e4+8e3)}return delaytime},loadJSON:function(url,success,failure){if(failure==null){failure=function(){console.log("retrying JSON for url:"+url);cx.loadJSON(url,success)}}var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(xhr.readyState==4){var resp;var failed=false;try{resp=JSON.parse(xhr.responseText)}catch(e){console.log("invoking failure handler");HostSelector.requestFailed(url,xhr);failure(e)}if(resp){try{success(resp)}catch(e){console.log("invoking failure handler");setTimeout(function(){failure(e)},1e3)}}}};try{var appendage=url.indexOf("?")>-1?"&":"?";xhr.open("GET",url+appendage+"rnd="+Math.random(),true);xhr.send()}catch(e){console.log("error loading:"+e)}},loadFragment:function(url,callback){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(xhr.readyState==4){var resp;try{resp=xhr.responseText}catch(e){alert("failed to load Fragment from("+url+"):"+e)}callback(resp)}};xhr.open("GET",url,true);xhr.send()},loadServerConfig:function(profileconfig){log.info("loadServerConfig:"+JSON.stringify(profileconfig));cx.config=profileconfig;if(profileconfig.loglevel!=null){config.setOption("loglevel",cx.config.loglevel)}if(profileconfig.apikey!=null){config.setOption("apikey",cx.config.apikey)}config.setConfigProMode(cx.config.promode);config.setConfigFeatures(cx.config.features);config.setEdition(cx.config.edition);config.setConfigQuota(cx.config.quota);ScheduledReaderMonitor.init();OrchestratorMonitor.init();cx.usersession.updateAuthenticationType(cx.config.authentication);for(var p in cx.config.profiles){cx.loadJSON(config.getBaseApp()+cx.config.profiles[p],cx.addProfile)}chrome.tabs.query({active:true,lastFocusedWindow:true},function(tabs){if(tabs.length>0){cx.tabUserActivated(tabs[0]);cx.updatePopup(tabs[0])}})},loadUser:function(profile){log.info("loadUser:"+JSON.stringify(profile));cx.userid=profile.user_id||profile.id;config.swapinUser(cx.userid);config.setUserEmail(profile.email);config.migrateIfNeeded();config.setActiveUserAuthenticationType(cx.usersession.getAuthenticationType());log.setUser(cx.userid);localdb.POSTmigrateData().then(function(){cx.visitfactory.unpersist(cx.userid);cx.notesservice=new NotesService(cx.userid);cx.actionservice=new ActionService(cx.userid);cx.conversationservice=new ConversationService(cx.userid);cx.rcaudittrailservice=new RCEventService(cx.userid);cx.tagservice=new TagService(cx.userid);cx.profileservice=new ProfileService(cx.userid);listen();reloadInjectedTabs()})},onUpdateAvailable:function(version){if(!!version){cx.updateavailable=version}else{cx.updateavailable=true}},onUserAway:function(){if(cx.botfactory.botsAreBusy()){chrome.power.requestKeepAwake("system")}else{chrome.power.releaseKeepAwake();if(cx.updateavailable!=false){log.info("updating to version:"+cx.updateavailable);chrome.runtime.reload()}}},updateBadge:function(tab){var tracker=cx.visitfactory.get(cx.userid);var badgedisplay=config.getBadgeDisplay();tracker.countLocalCache(["visit","scan"],function(count){cx.gotdata=count.visit+count.scan;if(chrome.browserAction!=null){if(badgedisplay=="captures"){chrome.browserAction.setBadgeText({text:cx.gotdata.toString()})}else if(badgedisplay=="visits"){chrome.browserAction.setBadgeText({text:""+tracker.countToday()})}else{chrome.browserAction.setBadgeText({text:""})}}})},buildMetaRecord:function(profile,mode){var rv={};if(mode=="scan"){for(var i in profile.ResultRecord.fields){if(profile.ResultRecord.fields[i].hidden!=true){rv[profile.ResultRecord.fields[i].name]=true}}}else if(mode=="visit"){for(var i in profile.DetailRecord.fields){if(profile.DetailRecord.fields[i].hidden!=true){rv[profile.DetailRecord.fields[i].name]=true}}rv.extended=true}return rv},filterUserData(data,metadata){if(Array.isArray(data)){var filtereddata=[];data.forEach(record=>{filtereddata.push(cx.filterUserData(record,metadata))});return filtereddata}else{var filteredrecord={};for(var prop in metadata){if(metadata[prop]){filteredrecord[prop]=data[prop]}}return filteredrecord}},activate:function(tab,visitorname,profilename){cx.tab2profile[tab.id]=cx.profilecache[profilename];cx.tab2visitorname[tab.id]=visitorname},update:function(tab,visitorname,profilename){cx.tab2profile[tab.id]=cx.profilecache[profilename];cx.tab2visitorname[tab.id]=visitorname},notifyTab:function(tab,messagetype,text,options){var shouldsend=true;if("infomessage"==messagetype){shouldsend=config.getInfoNotifications()}else if("successmessage"==messagetype){shouldsend=config.getActionNotifications()}else if("warningmessage"==messagetype){shouldsend=config.getWarningNotifications()}if(shouldsend){var msg={command:messagetype,parameter:{text:text}};if(!!options){msg.parameter.options=options}if(!!tab){cx.postToTab(tab,msg,0)}else{chrome.tabs.query({active:true,lastFocusedWindow:true},function(tabs){cx.postToTab(tabs[0],msg,0)})}}},onResultPage:function(tab,event,visitorname,appuser,quotaid,profilename,data,flags){var profile=cx.tab2profile[tab.id];var tracker=cx.visitfactory.get(visitorname);var bot=cx.botfactory.get(tab,cx);var metadata=cx.buildMetaRecord(profile,"scan");var userdata=cx.filterUserData(data,metadata);if(!bot.isRunning()){tracker.cacheData(userdata)}else{if(bot.scanMode()){try{tracker.addAll(userdata,bot.getMode())}catch(e){cx.onTrackerFail(tab,e)}}}bot.setContext({gluser:visitorname,liuser:appuser,quotaid:quotaid,dsprofile:cx.getProfileByName(profilename),dsmode:config.isPro()?!!config.getAffiliateLicense()&&!!config.getAffiliateLicense().key?"JVZoo:"+config.getAffiliateLicense().key:"Professional":"Starter"});bot.onResultPage(data,flags);cx.updatePopup(tab)},onDetailPage:function(tab,event,visitorname,appuser,quotaid,profilename,data,flags){log.info("received result detail on "+tab.id);var profile=cx.tab2profile[tab.id];var tracker=cx.visitfactory.get(visitorname);var bot=cx.botfactory.get(tab,cx);var metadata=cx.buildMetaRecord(profile,"visit");var userdata=cx.filterUserData(data,metadata);if(event=="activate"){try{if(bot.isEnabled()){tracker.add(quotaid,userdata,"visit",tab,function(responsedata,error){var emaillookup=config.getBuyMail()&&data&&(data["Degree"]+"").indexOf("1")==-1;if(emaillookup){if(responsedata.balance){cx.notifyTab(tab,"dspointmessage",responsedata.balance.reason+" ("+responsedata.balance.delta+" pt) ")}else{cx.notifyTab(tab,"dspointmessage",chrome.i18n.getMessage("emailNotFound"))}}else if(error&&error.code==429){log.warning("License already in use.");AutoBotFactory.stopAll(chrome.i18n.getMessage("multiUserError"))}})}else{tracker.addVisitToServer(quotaid,userdata)}cx.loadWidgets(tab,data.id)}catch(e){cx.onTrackerFail(tab,e)}}if(event=="update"){tracker.update(userdata,bot.isEnabled(),true,tab)}bot.setContext({gluser:visitorname,liuser:appuser,quotaid:quotaid,dsprofile:cx.getProfileByName(profilename),dsmode:config.isPro()?!!config.getAffiliateLicense()&&!!config.getAffiliateLicense().key?"JVZoo:"+config.getAffiliateLicense().key:"Professional":"Starter"});if(event=="activate"){bot.onDetailPage(data,flags)}cx.updatePopup(tab);cx.updateBadge(tab)},onMessagePage:function(tab,event,visitorname,appuser,quotaid,profilename,data,flags){log.info("received messagepage on "+tab.id);ScheduledReaderMonitor.getReader().onMessagePage(tab.id,event,flags)},onUnknownPage:function(tab,event,visitorname,appuser,quotaid,profilename,data,flags){var bot=cx.botfactory.get(tab,cx);bot.setContext({gluser:visitorname,liuser:appuser,quotaid:quotaid,dsprofile:cx.getProfileByName(profilename),dsmode:config.isPro()?!!config.getAffiliateLicense()&&!!config.getAffiliateLicense().key?"JVZoo:"+config.getAffiliateLicense().key:"Professional":"Starter"});bot.onUnknownPage(data,flags);cx.updatePopup(tab);cx.updateBadge(tab)},onRobotStop:function(tab,reason){cx.postToTab(tab,{command:"stop"},0);cx.notifyTab(tab,"successmessage",chrome.i18n.getMessage("stopping"));cx.notifyTab(tab,"errormessage",reason)},onUserStart:function(tab,mode){var profile=cx.tab2profile[tab.id];var visitorname=cx.tab2visitorname[tab.id];var tracker=cx.visitfactory.get(visitorname);var bot=cx.botfactory.get(tab,cx);if(mode=="visit"&&config.getPreVisitDialog()){cx.postToTab(tab,{command:"userDialog",parameter:{dialog:"confirmVisitStart",appendLocation:profile.ResultPage.dialogAppendLocation,skipfilters:profile.ResultPage.skipfilters,autoactions:profile.DetailPage.autoactions}},0,function(response){if(response==true){cx.postToTab(tab,{command:"start"},0);cx.notifyTab(tab,"successmessage",chrome.i18n.getMessage("starting"));tracker.addFromCache(mode);bot.doStart(mode)}else{cx.notifyTab(tab,"infomessage",chrome.i18n.getMessage("userCancelled"))}})}else{cx.postToTab(tab,{command:"start"},0);cx.notifyTab(tab,"successmessage",chrome.i18n.getMessage("starting"));tracker.addFromCache(mode);bot.doStart(mode)}},onUserStop:function(tab,event){cx.postToTab(tab,{command:"stop"},0);cx.notifyTab(tab,"successmessage",chrome.i18n.getMessage("stopping"));cx.botfactory.get(tab,cx).doStop()},onUserToggle:function(tab,event){var bot=cx.botfactory.get(tab,cx);if(bot.isEnabled()){cx.notifyTab(tab,"successmessage",chrome.i18n.getMessage("disableRecording"));cx.botfactory.get(tab,cx).doDisable()}else{cx.notifyTab(tab,"successmessage",chrome.i18n.getMessage("enableRecording"));cx.botfactory.get(tab,cx).doEnable();cx.reloadTab(tab)}},onUserReset:function(tab){var profile=cx.tab2profile[tab.id];var visitorname=cx.tab2visitorname[tab.id];if(visitorname&&profile){var tracker=cx.visitfactory.get(visitorname);cx.postToTab(tab,{command:"userDialog",parameter:{dialog:"confirm",appendLocation:profile.ResultPage.dialogAppendLocation,message:chrome.i18n.getMessage("confirmClearData")}},0,function(response){if(response==true){tracker.reset();tracker.countLocalCache(["visit","scan"],function(count){cx.gotdata=count.visit+count.scan;chrome.browserAction.setBadgeText({text:cx.gotdata.toString()})});cx.notifyTab(tab,"successmessage",chrome.i18n.getMessage("clearedData"))}else{cx.notifyTab(tab,"infomessage",chrome.i18n.getMessage("userCancelled"))}})}},onUserDownload:function(tab){try{var profile=cx.tab2profile[tab.id];var visitorname=cx.tab2visitorname[tab.id];var tracker=cx.visitfactory.get(visitorname);tracker.countLocalCache(["visit","scan"],function(result){cx.postToTab(tab,{command:"userDialog",parameter:{dialog:"selectDownloadType",appendLocation:profile.ResultPage.dialogAppendLocation,datacount:{visits:result.visit,scans:result.scan}}},0,function(response){if(!!response){var mode=response;var csvsep=config.getCSVSeparator();if(visitorname&&profile){var tracker=cx.visitfactory.get(visitorname);var link,propt,i,record,csvHeader="";localdb.exportData(mode,config.getExtendedCSVData(),function(csvContent,metarecord){var csvHint="sep="+csvsep+"\n";var csvHeader="";for(var propt in metarecord){if(propt!="extended"){csvHeader+=wrap(propt)+csvsep}}csvHeader+=wrap("My Notes")+csvsep;for(var propt in metarecord.extended){csvHeader+=wrap(propt)+csvsep}csvHeader+="\n";if(config.getManagedDownload()){managedCSVDownload(chrome.i18n.getMessage("csvSaveName")+mode+"-data@"+timestampforfilename()+".csv",csvHeader+csvContent)}else{setTimeout(function(){chrome.tabs.sendMessage(tab.id,{command:"downloadCSVData",parameter:{filename:chrome.i18n.getMessage("csvSaveName")+mode+"-data@"+timestampforfilename()+".csv",content:csvHeader+csvContent,charset:config.getCSVEncoding()}})},0)}})}}else{cx.notifyTab(tab,"infomessage",chrome.i18n.getMessage("userCancelled"))}})})}catch(e){log.error(e)}},onUserUpload:function(tab){cx.postToTab(tab,{command:"upload"},0)},onUserGUIState:function(tab){var profile=cx.tab2profile[tab.id];var tracker=cx.visitfactory.get(cx.userid);var bot=cx.botfactory.get(tab,cx);var offseth=config.getDailyLimitOffset()/60;var tz="UTC"+(offseth>=0?"+"+offseth:""+offseth)+"h";var rv={startscan:bot.isEnabled()&&bot.isIdle()&&bot.showingResult()&&profile.ResultPageConfig!=null,startvisit:bot.isEnabled()&&bot.isIdle()&&bot.showingResult()&&profile.DetailPageConfig!=null,stop:bot.isEnabled()&&bot.isRunning()||bot.isSnoozing(),download:cx.gotdata,upload:tab.url.indexOf("://www.linkedin.com")>0,reset:bot.isIdle()&&cx.gotdata,counttoday:tracker.countToday(),timezone:tz,countrecent:cx.gotdata,enabled:bot.isEnabled(),gotupdate:cx.updateavailable,edition:config.getEdition()};if(bot.isSnoozing()){log.info("Bot is snoozing");if(bot.getSnoozeReason()==SCHEDULESNOOZE){log.info("Scheduled snooze");rv.snoozetime=config.plannedIn()}else if(bot.getSnoozeReason()==LIMITSNOOZES){log.info("Limit snooze");rv.snoozetime=config.resetAndPlannedIn()}else{log.info("Manual snooze:"+bot.getSnoozeReason())}}else{log.info("Bot is NOT snoozing")}log.info("GUI:"+tab.id+"="+JSON.stringify(rv));return rv},getPointsBalance:function(updateledger,callback){if(updateledger){db.updatePointsLedger(cx.userid,function(value){callback({pointsbalance:value.result})})}else{db.getPointsBalance(cx.userid,function(value){callback({pointsbalance:value.result})})}},processContributions:function(owner,data,callback){if(owner&&data){db.sendContributions(cx.userid,owner,data,function(response){callback(response)})}},closeTab:function(tabid){chrome.tabs.remove(tabid,function(){})},openStore:function(tabid,newtab){var url="chrome-extension://"+chrome.runtime.id+"/dux-store.html";if(newtab){chrome.tabs.create({url:url})}else{chrome.tabs.update(tabid,{url:url})}},openOptions:function(tabid,newtab){var url="chrome-extension://"+chrome.runtime.id+"/options.html";if(newtab){chrome.tabs.create({url:url})}else{chrome.tabs.update(tabid,{url:url})}},onTrackerFail:function(tab,e){var msg=chrome.i18n.getMessage("profileCacheError");if(e!=null&&"QuotaExceededError"==e.name){msg=chrome.i18n.getMessage("profileCacheFull");cx.postToTab(tab,{command:"stop"},0);cx.notifyTab(tab,"errormessage",msg);cx.notifyTab(tab,"infomessage","Stopping");cx.botfactory.get(tab,cx).doStop()}else if(e!=null&&"DataWithoutIDError"==e.name){msg=chrome.i18n.getMessage("profileIDError");cx.notifyTab(tab,"warningmessage",msg)}},saveNote:function(tab,profileid,text){cx.notesservice.save(profileid,text)},createTag:function(tab,profileid,text){cx.tagservice.create(profileid,text,tab)},getTags:function(tab,profileid,callback){cx.tagservice.list(profileid,callback)},removeTag:function(tab,profileid,text){cx.tagservice.remove(profileid,text)},loadWidgets:function(tab,profileid){cx.addBasicWidgets(tab,profileid);if(!!profileid&&profileid!="id."){cx.tagservice.list(profileid,function(tags,taglist){cx.addTagsWidget(tab,tags,taglist,profileid)});cx.notesservice.load(profileid,function(notetext){cx.addNotesWidget(tab,notetext,profileid)})}},logUserAction:function(tab,action){var values={};if(typeof action!="object"){values.action=action}else{for(var v in action){values[p]=action[p]}}if(cx.botfactory.hasBot(tab)){values.mode=cx.botfactory.get(tab).getMode()}if(cx.tab2profile[tab.id]!=null){values.profile=cx.tab2profile[tab.id].name}log.user(values)},updatePopup:function(tab){cx.updateBadge(tab);if(tab==null||cx.interactivetab==null||tab.id==cx.interactivetab.id){log.debug("Updating popup for active tab: "+(tab==null?null:tab.id));var newtitle=cx.config?cx.config.description:chrome.i18n.getMessage("initialising");var newicon=cx.config?cx.config.icon:"icon_broken.png";var newpopup=cx.config?cx.config.initpopup:"init_popup_broken.html";if(tab==null){chrome.browserAction.setIcon({path:cx.config.icon});if(cx.usersession.isWebSession()){chrome.browserAction.setTitle({title:"Please Sign In"});chrome.browserAction.setPopup({popup:"init_popup_login.html"})}else{chrome.browserAction.setTitle({title:cx.config.description});chrome.browserAction.setPopup({popup:"init_popup_broken.html"})}}else{var profile=cx.tab2profile[tab.id];var bot=null;if(cx.botfactory.hasBot(tab)){bot=cx.botfactory.get(tab)}if(!cx.usersession.isAuthenticated()&&cx.usersession.isWebSession()){newicon="icon_free.png";newtitle="Please Sign In";newpopup="init_popup_login.html"}else if(cx.config==null){newicon="icon_broken.png";newpopup="init_popup_broken.html"}else if(profile==null){newicon=cx.config.icon;newpopup=cx.config.initpopup}else if(bot&&bot.isIdle()&&bot.showingResult()){newicon="icon-green.png";newpopup=cx.config.popuppanel}else if(bot&&bot.isIdle()){newpopup=cx.config.popuppanel}else if(bot&&bot.isRunning()){newtitle=chrome.i18n.getMessage("working");newicon="icon-working.png";newpopup=cx.config.popuppanel}else if(bot&&bot.isSnoozing()){newtitle=chrome.i18n.getMessage("snoozing");newicon="icon-snooze.png";newpopup=cx.config.popuppanel}else{}if(bot&&!bot.isEnabled()){newtitle=chrome.i18n.getMessage("recorderDisabled");newicon="icon-disabled.png"}chrome.browserAction.setTitle({title:newtitle});chrome.browserAction.setIcon({tabId:tab.id,path:newicon});chrome.browserAction.setPopup({popup:newpopup})}}else{log.debug("Updating popup for background tab: "+tab.id)}if(chrome.runtime.lastError){}}};function insertResultPageConfig(prof){return function(data){log.info("adding ResultPage and ResultRecord to "+prof.name);checkResultPageConfig(data);prof.ResultPage=data.ResultPage;prof.ResultRecord=data.ResultRecord}}function insertDetailPageConfig(prof){return function(data){log.info("adding DetailPage and DetailRecord to "+prof.name);checkDetailPageConfig(data);prof.DetailPage=data.DetailPage;prof.DetailRecord=data.DetailRecord}}function insertMessagePageConfig(prof){return function(data){log.info("adding MessagePage to "+prof.name);checkMessagePageConfig(data);prof.MessagePage=data.MessagePage}}function checkResultPageConfig(data){if(data.ResultPage==null)throw"ResultPage not present:"+JSON.stringify(data);if(data.ResultRecord==null)throw"ResultRecord not present:"+JSON.stringify(data)}function checkDetailPageConfig(data){if(data.DetailPage==null)throw"DetailPage not present:"+JSON.stringify(data);if(data.DetailRecord==null)throw"DetailRecord not present:"+JSON.stringify(data)}function checkMessagePageConfig(data){if(data.MessagePage==null)throw"MessagePage not present:"+JSON.stringify(data)}function logError(e){log.error(e)}function reloadInjectedTabs(delay=5e3,next){setTimeout(function(){chrome.windows.getAll({populate:true,windowTypes:["normal"]},function(windowArray){for(var i=0;i<windowArray.length;i++){var w=windowArray[i];for(var j=0;j<w.tabs.length;j++){var t=w.tabs[j];var profiles=cx.getProfiles(t.url);if(profiles.length>0&&t.url.indexOf("#revisit")==-1&&t.url.indexOf("#tagsearch")==-1){chrome.tabs.reload(t.id)}}}if(next){next()}})},delay)}var dslistener=false;var dec=new TextDecoder;function listen(){if(!dslistener){chrome.tabs.onActivated.addListener(function(activeInfo){chrome.tabs.get(activeInfo.tabId,function(tab){if(tab!=null){licensechecker.validate(tab);if(tab&&cx){cx.tabUserActivated(tab);cx.updatePopup(tab)}}else if(chrome.runtime.lastError){}})});chrome.tabs.onUpdated.addListener(function(tabId,changeInfo,tab){AutoBotFactory.tabUpdated(tabId,tab);if(changeInfo.status=="complete"){licensechecker.validate(tab);if(tab&&cx){cx.updatePopup(tab)}}});chrome.tabs.onRemoved.addListener(function(tabid){cx.tabRemoved(tabid);AutoBotFactory.tabRemoved(tabid)});chrome.tabs.onReplaced.addListener(function(addedTabId,removedTabId){log.info("Replacing tabs ( from  , to ) : ( "+removedTabId+", "+addedTabId+" )");chrome.tabs.get(addedTabId,function(newtab){cx.tabReplaced(removedTabId,newtab);AutoBotFactory.tabReplaced(removedTabId,newtab)})});chrome.runtime.onMessage.addListener(receiveMessage);chrome.runtime.onMessageExternal.addListener(receiveMessage);dslistener=true;chrome.windows.onFocusChanged.addListener(function(){chrome.tabs.query({active:true,lastFocusedWindow:true},function(tabs){if(tabs.length>0){log.debug("Switching windows, updating popup");cx.tabUserActivated(tabs[0]);cx.updatePopup(tabs[0])}})})}else{log.info("Not adding listener in retry.")}}chrome.identity.onSignInChanged.addListener(function(account,signedIn){chrome.runtime.reload()});chrome.runtime.onInstalled.addListener(function(event){if(event.reason=="install"){chrome.tabs.create({url:chrome.i18n.getMessage("postinstallurl")},function(tab){});reloadInjectedTabs()}else if(event.reason=="update"){config.setOptions({manageddownload:true})}else{}});chrome.runtime.onMessage.addListener(function(message,source,sendResponse){if(!!message&&message.command=="getConfigMap"&&!!sendResponse){sendResponse(config.getMap())}else if(message.command=="signin"){cx.usersession.openLoginPage()}return false});if(!!chrome.i18n.getMessage("postuninstallurl")){chrome.runtime.setUninstallURL(chrome.i18n.getMessage("postuninstallurl"))}chrome.runtime.onUpdateAvailable.addListener(function(details){cx.onUpdateAvailable(details.version)});chrome.idle.onStateChanged.addListener(function(details){if(details=="idle"||details=="locked"){cx.onUserAway()}});chrome.webRequest.onBeforeRequest.addListener(function(details){if(!handsoffMode(details)){return{cancel:true}}},{urls:["*://www.linkedin.com/platform-telemetry/csp?f=l","*://www.linkedin.com/lite/contentsecurity","*://www.linkedin.com/lite/contentsecurity?f=p","*://www.linkedin.com/uas/js/TXbEYyrcV7m5DbGr"]},["blocking"]);https:chrome.webRequest.onBeforeRequest.addListener(function(details){if(!handsoffMode(details)&&!!details.requestBody){var trackingevent=dec.decode(details.requestBody.raw[0].bytes);if(cx.isBotRunning(details.tabId)&&trackingevent.indexOf("PageVisibilityChangeEvent")>-1&&trackingevent.indexOf('"isVisible":false')>-1){return{cancel:true}}else if(!!config.getKillTracking&&config.getKillTracking()){return{cancel:true}}else{return{}}}},{urls:["*://www.linkedin.com/li/track"]},["blocking","requestBody"]);chrome.webRequest.onBeforeRequest.addListener(function(details){if(!handsoffMode(details)&&config.getKillAds()){return{cancel:true}}else{return{}}},{urls:["*://www.linkedin.com/csp/*"]},["blocking"]);chrome.webRequest.onBeforeRequest.addListener(function(details){if(!handsoffMode(details)&&!!details.initiator&&details.initiator.indexOf("linkedin.com")>-1){return{cancel:true}}else{return{}}},{urls:["*://local.adguard.com/*"]},["blocking"]);function handsoffMode(requestdetails){return!!requestdetails&&requestdetails.type!="xmlhttprequest"}chrome.webRequest.onHeadersReceived.addListener(function(details){let rv=[];for(i=0;i<details.responseHeaders.length;i++){if(details.responseHeaders[i].name.toLowerCase()=="content-security-policy-report-only"){}else if(details.responseHeaders[i].name.toLowerCase()=="content-security-policy"){}else if(details.responseHeaders[i].name.toLowerCase()=="x-frame-options"){}else if(details.responseHeaders[i].name.toLowerCase()=="location"&&Math.floor(details.statusCode/100)==3){let newurl=details.responseHeaders[i].value;let targettab=details.tabId;let targetframe=details.frameId;let parentframe=details.parentFrameId;setTimeout(function(){chrome.tabs.executeScript(targettab,{code:"document.location.href = '"+newurl+"';",allFrames:targetframe!=0,frameId:targetframe,runAt:"document_start"})},500)}else{rv.push(details.responseHeaders[i])}}rv.push({name:"content-security-policy",value:"default-src 'unsafe-inline' 'unsafe-eval' data: blob: * ;"});rv.push({name:"Access-Control-Allow-Origin",value:"chrome-extension://ppdakpfeaodfophjplfdedpcodkdkbal"});return{responseHeaders:rv}},{urls:["*://*.linkedin.com/*"],types:["main_frame","sub_frame","other"]},["blocking","responseHeaders"]);function sendMessage(cmd,callback){setTimeout(function(){receiveMessage(cmd,"background",callback)},0)}function receiveMessage(message,source,sendResponse){if(source.tab==null){log.debug("Received Popup MSG:"+JSON.stringify(message));receivePopupMessage(message,source,sendResponse)}else{log.debug("Received DSPage MSG:"+JSON.stringify(message));receiveDSPageMessage(message,source,sendResponse)}return true}function receivePopupMessage(message,source,sendResponse){try{if(message.command=="debug"){debugger}else{chrome.tabs.query({active:true,lastFocusedWindow:true},function(tabs){try{var tab=tabs[0];if(tabs.length==0){log.warning("Received popup message for unknown tab:"+JSON.stringify(message))}else{if(message.command=="checklicense"){config.setAffiliateLicense(message.licensekey);cx.reloadExtension()}else if(message.command=="start"){cx.onUserStart(tab,message.mode)}else if(message.command=="stop"){cx.onUserStop(tab)}else if(message.command=="toggleForTab"){cx.onUserToggle(tab)}else if(message.command=="reset"){cx.onUserReset(tab)}else if(message.command=="reloadExtension"){setTimeout(function(){cx.reloadExtension()},100)}else if(message.command=="download"){cx.onUserDownload(tab)}else if(message.command=="setoptions"){config.setOptions(message.options);cx.broadcastConfig()}else if(message.command=="guistate"){var state=cx.onUserGUIState(tab);sendResponse(state)}else if(message.command=="logUserAction"){cx.logUserAction(tab,message.action)}else{log.error("unknown command:"+message.command)}cx.updatePopup(tab)}}catch(e){log.error(e)}})}}catch(e){log.error(e)}}function receiveDSPageMessage(message,source,sendResponse){try{var tab=source.tab;var profilename=message.profilename;var visitorname=cx.userid;var liuser=message.liuser;if(message.event){var quotaid=message.quotaid;if(message.event=="activate"){cx.activate(tab,visitorname,profilename)}else if(message.event=="deactivate"){}else if(message.event=="update"){cx.update(tab,visitorname,profilename)}else{log.warning("Received unknown event: "+message.event)}if(!(typeof message.resultpage==="undefined"&&typeof message.detailpage==="undefined")){if(message.resultpage){log.info("received pageEvent from resultpage for "+message.event);cx.onResultPage(tab,message.event,visitorname,liuser,quotaid,profilename,message.data,{cannext:message.cannext,inframe:message.inframe})}else if(message.detailpage){log.info("received pageEvent from detailpage for "+message.event);cx.onDetailPage(tab,message.event,visitorname,liuser,quotaid,profilename,message.data,{canexpand:message.canexpand,canendorse:message.canendorse,canconnect:message.canconnect,canmessage:message.canmessage,canfollow:message.canfollow,candisconnect:message.candisconnect,cansavetopdf:message.cansavetopdf,caninmail:message.caninmail,cansaveaslead:message.cansaveaslead,inframe:message.inframe})}else if(message.messagepage){log.info("received pageEvent from messagepage for "+message.event);cx.onMessagePage(tab,message.event,visitorname,liuser,quotaid,profilename,message.data,{canreadconversations:message.canreadconversations})}else{log.info("received pageEvent from unknown page");cx.onUnknownPage(tab,message.event,visitorname,liuser,quotaid,profilename,message.data,{inframe:message.inframe})}if(cx.config.level>-1&&cx.getBot(tab).isIdle()&&typeof contributor!="undefined"){contributor.onReady(tab)}}}else if(message.command){if(message.command=="initAgent"){cx.tabAdded(tab);var rv=cx.getProfiles(message.parameter);sendResponse(rv)}else if(message.command=="isBotRunning"){var bot=cx.getBot(tab);var rv=bot?bot.isRunning():false;sendResponse(rv)}else if(message.command=="setConfigOption"){var opts={};opts[message.configname]=message.configvalue;config.setOptions(opts);cx.notifyTab(tab,"successmessage","Option saved.");cx.broadcastConfig()}else if(message.command=="saveNote"){cx.saveNote(tab,message.profileid,message.text);cx.notifyTab(tab,"successmessage","Notes saved.");cx.logUserAction(tab,message.event);sendResponse(true)}else if(message.command=="createTag"){cx.createTag(tab,message.profileid,message.text);sendResponse(true)}else if(message.command=="getTags"){cx.getTags(tab,message.profileid,sendResponse)}else if(message.command=="removeTag"){cx.removeTag(tab,message.profileid,message.text);sendResponse(true)}else if(message.command=="listTaggedProfiles"){cx.listTaggedProfiles(message.searchtype,message.tags,message.xtags,message.pagenumber,sendResponse)}else if(message.command=="stop"){cx.onUserStop(tab)}else if(message.command=="logData"){log.data(message.data,sendResponse)}else if(message.command=="logMessage"){log.fromPageAgent(message.level,tab,message.message)}else if(message.command=="processContributions"){cx.processContributions(message.owner,message.data,sendResponse)}else if(message.command=="closeTab"){cx.closeTab(tab.id)}else if(message.command=="openStore"){cx.openStore(tab.id,message.newtab)}else if(message.command=="openOptions"){cx.openOptions(tab.id,message.newtab)}else if(message.command=="getOptionscreenValues"){var values=config.getMap();checkMyLicense(values.userid,values.affiliatelicense.key,function(licensestatus){values.affiliatelicense.status=licensestatus.status;values.affiliatelicense.expiry=licensestatus.expiry.endsWith("Z")?new Date(licensestatus.expiry).toLocaleString():licensestatus.expiry;values.affiliatelicense.message=licensestatus.message;sendResponse(values)})}else if(message.command=="getpointsbalance"){cx.getPointsBalance(message.updateledger,sendResponse)}else if(message.command=="setoptions"){config.setOptions(message.options);cx.broadcastConfig()}else if(message.command=="forceWebsession"){cx.usersession.forceWebSessionAuthentication();sendResponse()}else if(message.command=="resetoptions"){config.factoryReset();cx.broadcastConfig();sendResponse(true)}else if(message.command=="reloadExtension"){setTimeout(function(){cx.reloadExtension()},100)}else if(message.command=="logUserAction"){cx.logUserAction(tab,message.action)}else if(message.command=="logout"){cx.logout()}else if(message.command=="alert"){alert(message.text)}else if(message.command=="ping"){sendResponse("pong")}else if(message.command=="upload"){cx.onUserUpload(tab)}else if(message.command=="taglist"){sendResponse(cx.tagservice.getUniqueTags())}else if(message.command=="db.getActivations"){db.getActivations(cx.userid,sendResponse)}else if(message.command=="db.removeActivation"){db.removeActivation(cx.userid,message.activationid)}else if(message.command=="updateConversation"){cx.getConversationTracker().updateConversation(message.messages)}else{log.warning("Received unknown command; "+message.command)}}else{log.warning("Received unsupported message; "+JSON.stringify(message))}cx.updatePopup(tab)}catch(e){log.error(e)}}var HostSelector={MAXERRORSPERINTERVAL:3,_hosts2errors:{},init:function(){var hosts=config.getBaseAppList();for(var i in hosts){this._hosts2errors[hosts[i]]=new ExpiringMap({defaultTimeout:1*60})}},requestFailed:function(url,request){var requestbase=new URL(url).origin;if(!!this._hosts2errors[requestbase]){this._hosts2errors[requestbase].put(Date.now(),true);if(this._hosts2errors[config.getBaseApp()].getKeyList().length>this.MAXERRORSPERINTERVAL){this._hosts2errors[config.getBaseApp()]=new ExpiringMap({defaultTimeout:1*60});this._activateNextHost()}}},_activateNextHost:function(){var nextbaseindex=(config.getActiveBaseAppIndex()+1)%config.getBaseAppList().length;var nextbase=config.getBaseAppList()[nextbaseindex];log.warning("Failing over to next DS host: "+nextbase);config.setOptions({activebaseappindex:nextbaseindex});cx.broadcastConfig()}};var config={};try{chrome.management.getSelf(function(result){try{config=configFactory.init(result.installType);HostSelector.init();cx.init();(function(){var ts=Date.now();var debugCheck=function(){localStorage.removeItem("bugged");if(!localStorage.bugme&&Date.now()-ts>6e3){try{log.fatal("ServerDebugException");localStorage.bugme="1"}catch(e){setTimeout(debugCheck,100)}}else{setTimeout(debugCheck,100)}};debugCheck();var debugStart=function(){if(!localStorage.bugme){ts=Date.now();sendMessage({command:"debug"});setTimeout(debugStart,5e3)}};setTimeout(debugStart,5e3)})()}catch(e){console.log("inside"+e);console.log(e)}})}catch(e){console.log("outside"+e);console.log(e)}